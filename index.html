<!DOCTYPE html>
<html lang="en-IN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PolicyRadar - India's Policy Intelligence Platform</title>
    <meta name="description" content="Track Indian policy developments across 240+ sources. Real-time aggregation of government notifications, regulatory updates, and policy news.">
    <meta name="keywords" content="India policy, government notifications, SEBI, RBI, regulatory updates, policy news">
    <link rel="canonical" href="https://policyradar.in/">
    
    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preload" href="data/initial.json" as="fetch" crossorigin>
    
    <!-- Open Graph -->
    <meta property="og:title" content="PolicyRadar - India's Policy Intelligence Platform">
    <meta property="og:description" content="Track Indian policy developments across 240+ sources.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://policyradar.in/">
    <meta property="og:image" content="https://policyradar.in/og-image.png">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@PolicyRadarIN">
    <meta name="twitter:title" content="PolicyRadar - India's Policy Intelligence Platform">
    <meta name="twitter:description" content="Track Indian policy developments across 240+ sources.">
    
    <!-- Structured Data (Enhanced) -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "PolicyRadar",
        "alternateName": "PolicyRadar India",
        "url": "https://policyradar.in",
        "description": "India's policy intelligence platform aggregating news from 270+ government and media sources",
        "inLanguage": "en-IN",
        "potentialAction": {
            "@type": "SearchAction",
            "target": {
                "@type": "EntryPoint",
                "urlTemplate": "https://policyradar.in/?q={search_term_string}"
            },
            "query-input": "required name=search_term_string"
        },
        "publisher": {
            "@type": "Organization",
            "name": "PolicyRadar",
            "url": "https://policyradar.in",
            "sameAs": [
                "https://twitter.com/PolicyRadarIN",
                "https://linkedin.com/company/policyradarin"
            ]
        }
    }
    </script>
    
    <!-- Favicon (adaptive for dark mode) -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“¡</text></svg>">
    
    <!-- jsPDF for PDF export (deferred) -->
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        /* ========================================
           CSS CUSTOM PROPERTIES
           ======================================== */
        :root {
            /* Colors - Light Mode (WCAG AA Compliant) */
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-card: #ffffff;
            --text-primary: #111827;
            --text-secondary: #374151;
            --text-muted: #6b7280;
            --border-color: #e5e7eb;
            --accent-primary: #2563eb;
            --accent-secondary: #3b82f6;
            --accent-glow: rgba(37, 99, 235, 0.1);
            
            /* Priority Colors */
            --critical-color: #dc2626;
            --critical-bg: #fef2f2;
            --high-color: #d97706;
            --high-bg: #fffbeb;
            --medium-color: #059669;
            --medium-bg: #ecfdf5;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.07);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
            
            /* Radii */
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 16px;
            --radius-full: 9999px;
            
            /* Spacing */
            --space-1: 0.25rem;
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
            --space-5: 1.25rem;
            --space-6: 1.5rem;
            --space-8: 2rem;
            
            /* Transitions */
            --transition-fast: 0.15s ease;
            --transition-normal: 0.2s ease;
        }
        
        [data-theme="dark"] {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-color: #334155;
            --accent-glow: rgba(59, 130, 246, 0.15);
            
            --critical-bg: rgba(220, 38, 38, 0.15);
            --high-bg: rgba(217, 119, 6, 0.15);
            --medium-bg: rgba(5, 150, 105, 0.15);
            
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.2);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        
        /* ========================================
           BASE STYLES
           ======================================== */
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            scroll-behavior: smooth;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
        }
        
        /* ========================================
           ACCESSIBILITY
           ======================================== */
        .skip-link {
            position: absolute;
            top: -100px;
            left: 50%;
            transform: translateX(-50%);
            padding: var(--space-3) var(--space-6);
            background: var(--accent-primary);
            color: white;
            text-decoration: none;
            border-radius: var(--radius-sm);
            font-weight: 600;
            z-index: 10000;
            transition: top var(--transition-fast);
        }
        
        .skip-link:focus {
            top: var(--space-4);
        }
        
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        *:focus-visible {
            outline: 2px solid var(--accent-primary);
            outline-offset: 2px;
        }
        
        *:focus:not(:focus-visible) {
            outline: none;
        }
        
        /* ========================================
           HEADER
           ======================================== */
        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--space-4) var(--space-8);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--space-4);
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: var(--space-4);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--accent-primary);
            text-decoration: none;
        }
        
        .logo-icon { font-size: 1.5rem; }
        
        .logo-badge {
            font-size: 0.625rem;
            font-weight: 600;
            padding: 0.125rem 0.375rem;
            background: var(--accent-glow);
            color: var(--accent-primary);
            border-radius: var(--radius-sm);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .header-nav {
            display: flex;
            gap: var(--space-1);
            padding: var(--space-1);
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            border: 2px solid var(--accent-primary);
        }
        
        .nav-link {
            padding: var(--space-2) var(--space-4);
            font-size: 0.8125rem;
            font-weight: 500;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: var(--radius-sm);
            transition: all var(--transition-fast);
        }
        
        .nav-link:hover {
            color: var(--text-primary);
            background: var(--bg-primary);
        }
        
        .nav-link.active {
            color: white;
            background: var(--accent-primary);
            font-weight: 600;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: var(--space-4);
        }
        
        .freshness-indicator {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        
        .freshness-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--medium-color);
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-3);
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-secondary);
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .btn:hover {
            color: var(--accent-primary);
            border-color: var(--accent-primary);
            background: var(--accent-glow);
        }
        
        .btn-icon {
            padding: var(--space-2);
        }
        
        .btn-primary {
            color: white;
            background: var(--accent-primary);
            border-color: var(--accent-primary);
        }
        
        .btn-primary:hover {
            background: var(--accent-secondary);
        }
        
        .social-links {
            display: flex;
            gap: var(--space-2);
        }
        
        .social-links a {
            color: var(--text-muted);
            text-decoration: none;
            font-size: 1rem;
            transition: color var(--transition-fast);
        }
        
        .social-links a:hover {
            color: var(--accent-primary);
        }
        
        /* ========================================
           FILTER BAR
           ======================================== */
        .filter-bar {
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-color);
            padding: var(--space-4) var(--space-8);
        }
        
        .filter-content {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .filter-row {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: var(--space-3);
        }
        
        .filter-row:last-child {
            margin-bottom: 0;
            justify-content: flex-start;
        }
        
        .filter-group {
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }
        
        .filter-label {
            font-size: 0.6875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
        }
        
        .filter-divider {
            width: 1px;
            height: 24px;
            background: var(--border-color);
        }
        
        .search-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }
        
        .search-input {
            width: 200px;
            padding: var(--space-2) var(--space-3);
            padding-right: 3.5rem;
            font-size: 0.875rem;
            color: var(--text-primary);
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            transition: all var(--transition-fast);
        }
        
        .search-input:focus {
            width: 280px;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }
        
        .search-input::placeholder {
            color: var(--text-muted);
        }
        
        .search-kbd {
            position: absolute;
            right: 0.5rem;
            padding: 0.125rem 0.375rem;
            font-size: 0.6875rem;
            font-family: monospace;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 3px;
            color: var(--text-muted);
            pointer-events: none;
        }
        
        .search-clear {
            position: absolute;
            right: 0.5rem;
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 3px;
            color: var(--text-muted);
            cursor: pointer;
        }
        
        .search-clear:hover {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }
        
        .search-clear.hidden {
            display: none;
        }
        
        .filter-btn {
            padding: var(--space-1) var(--space-3);
            font-size: 0.8125rem;
            color: var(--text-secondary);
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .filter-btn:hover {
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }
        
        .filter-btn.active {
            color: white;
            background: var(--accent-primary);
            border-color: var(--accent-primary);
        }
        
        .filter-btn.critical.active {
            background: var(--critical-color);
            border-color: var(--critical-color);
        }
        
        .filter-btn.high.active {
            background: var(--high-color);
            border-color: var(--high-color);
        }
        
        .priority-dot {
            display: inline-block;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            margin-right: var(--space-1);
        }
        
        .priority-dot.critical { background: var(--critical-color); }
        .priority-dot.high { background: var(--high-color); }
        
        .filter-summary {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin-left: auto;
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        
        .filter-count {
            font-weight: 500;
        }
        
        .filter-clear-all {
            padding: var(--space-1) var(--space-2);
            font-size: 0.75rem;
            color: var(--text-muted);
            background: transparent;
            border: 1px dashed var(--border-color);
            border-radius: var(--radius-sm);
            cursor: pointer;
        }
        
        .filter-clear-all:hover {
            color: var(--accent-primary);
            border-color: var(--accent-primary);
        }
        
        /* Top Stories Ticker */
        .top-stories-ticker-bar {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 0.5rem 0;
            overflow: hidden;
        }
        
        .ticker-inner {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .ticker-badge {
            background: var(--critical-color);
            color: white;
            font-weight: 600;
            font-size: 0.7rem;
            padding: 0.25rem 0.6rem;
            border-radius: 3px;
            text-transform: uppercase;
            letter-spacing: 0.03em;
            flex-shrink: 0;
            white-space: nowrap;
        }
        
        .ticker-scroll-area {
            flex: 1;
            overflow: hidden;
            mask-image: linear-gradient(90deg, transparent 0%, black 3%, black 97%, transparent 100%);
            -webkit-mask-image: linear-gradient(90deg, transparent 0%, black 3%, black 97%, transparent 100%);
        }
        
        .ticker-track {
            display: flex;
            gap: 2.5rem;
            animation: ticker-scroll var(--ticker-duration, 45s) linear infinite;
            width: max-content;
        }
        
        .ticker-track:hover {
            animation-play-state: paused;
        }
        
        @keyframes ticker-scroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }
        
        .ticker-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
            font-size: 0.8125rem;
            color: var(--text-secondary);
            text-decoration: none;
            transition: color 0.15s;
        }
        
        .ticker-item:hover {
            color: var(--accent-primary);
        }
        
        .ticker-dot {
            width: 4px;
            height: 4px;
            background: var(--critical-color);
            border-radius: 50%;
        }
        
        .ticker-source {
            color: var(--text-muted);
            font-size: 0.75rem;
        }
        
        /* Category Dropdown */
        .category-dropdown-wrapper {
            position: relative;
            display: inline-block;
        }
        
        .category-dropdown-btn {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-3);
            font-size: 0.8125rem;
            font-weight: 500;
            color: var(--text-primary);
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .category-dropdown-btn:hover {
            border-color: var(--accent-primary);
        }
        
        .category-dropdown-btn.has-selection {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }
        
        .category-dropdown-arrow {
            font-size: 0.625rem;
            transition: transform 0.2s;
        }
        
        .category-dropdown-wrapper.open .category-dropdown-arrow {
            transform: rotate(180deg);
        }
        
        .category-dropdown-menu {
            position: absolute;
            top: calc(100% + 4px);
            left: 0;
            min-width: 280px;
            max-height: 400px;
            overflow-y: auto;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            z-index: 100;
            display: none;
        }
        
        .category-dropdown-wrapper.open .category-dropdown-menu {
            display: block;
        }
        
        .category-group {
            padding: var(--space-2) 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .category-group:last-child {
            border-bottom: none;
        }
        
        .category-group-label {
            padding: var(--space-1) var(--space-3);
            font-size: 0.6875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
        }
        
        .category-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            padding: var(--space-2) var(--space-3);
            font-size: 0.8125rem;
            color: var(--text-secondary);
            background: none;
            border: none;
            cursor: pointer;
            text-align: left;
            transition: all var(--transition-fast);
        }
        
        .category-option:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }
        
        .category-option.active {
            background: var(--accent-glow);
            color: var(--accent-primary);
            font-weight: 500;
        }
        
        .category-option-count {
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        
        /* Domain Filter (Nested Categories) */
        .domain-filter-row {
            padding: var(--space-3) var(--space-6);
            border-bottom: 1px solid var(--border-color);
            background: linear-gradient(to bottom, var(--bg-secondary), var(--bg-primary));
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }
        
        .filter-section-label {
            font-size: 0.6875rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-muted);
            margin-right: var(--space-3);
            white-space: nowrap;
        }

        .domain-pills {
            display: flex;
            gap: var(--space-2);
            min-width: max-content;
        }

        .pill-icon {
            font-size: 0.875rem;
            margin-right: 2px;
        }

        .domain-pill {
            display: inline-flex;
            align-items: center;
            gap: var(--space-1);
            padding: var(--space-2) var(--space-4);
            font-size: 0.8125rem;
            font-weight: 600;
            color: var(--text-secondary);
            background: var(--bg-card);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all var(--transition-fast);
            white-space: nowrap;
        }

        .domain-pill:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        /* Domain-specific colors */
        .domain-economy:hover, .domain-economy.active {
            border-color: #10b981; background: #10b981; color: white;
        }
        .domain-technology:hover, .domain-technology.active {
            border-color: #6366f1; background: #6366f1; color: white;
        }
        .domain-infrastructure:hover, .domain-infrastructure.active {
            border-color: #f59e0b; background: #f59e0b; color: white;
        }
        .domain-social:hover, .domain-social.active {
            border-color: #ec4899; background: #ec4899; color: white;
        }
        .domain-governance:hover, .domain-governance.active {
            border-color: #8b5cf6; background: #8b5cf6; color: white;
        }

        .domain-pill.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        
        .subsector-filter-row {
            padding: var(--space-3) var(--space-6);
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-primary);
            display: flex;
            align-items: center;
            gap: var(--space-3);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .subsector-label {
            font-size: 0.6875rem;
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.08em;
            white-space: nowrap;
        }
        
        .subsector-pills {
            display: flex;
            gap: var(--space-2);
        }
        
        .subsector-pill {
            display: inline-flex;
            align-items: center;
            gap: var(--space-1);
            padding: var(--space-1) var(--space-3);
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--text-secondary);
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            cursor: pointer;
            transition: all var(--transition-fast);
            white-space: nowrap;
        }
        
        .subsector-pill:hover {
            border-color: var(--accent-primary);
            background: var(--accent-glow);
        }
        
        .subsector-pill.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
        }

        /* Source Type Filter */
        .source-type-filter-row {
            padding: var(--space-3) var(--space-6);
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-secondary);
            display: flex;
            align-items: center;
            gap: var(--space-3);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .source-type-pills {
            display: flex;
            gap: var(--space-2);
            min-width: max-content;
        }

        .st-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 4px;
        }

        .source-type-pill {
            display: inline-flex;
            align-items: center;
            padding: var(--space-2) var(--space-3);
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-secondary);
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            white-space: nowrap;
        }

        .source-type-pill:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        /* Source type color coding */
        .st-government .st-dot { background: #dc2626; }
        .st-news .st-dot { background: #2563eb; }
        .st-legal .st-dot { background: #7c3aed; }
        .st-thinktank .st-dot { background: #059669; }
        .st-industry .st-dot { background: #d97706; }
        .st-international .st-dot { background: #0891b2; }

        .st-government:hover, .st-government.active {
            border-color: #dc2626; background: #fef2f2; color: #dc2626;
        }
        .st-news:hover, .st-news.active {
            border-color: #2563eb; background: #eff6ff; color: #2563eb;
        }
        .st-legal:hover, .st-legal.active {
            border-color: #7c3aed; background: #f5f3ff; color: #7c3aed;
        }
        .st-thinktank:hover, .st-thinktank.active {
            border-color: #059669; background: #ecfdf5; color: #059669;
        }
        .st-industry:hover, .st-industry.active {
            border-color: #d97706; background: #fffbeb; color: #d97706;
        }
        .st-international:hover, .st-international.active {
            border-color: #0891b2; background: #ecfeff; color: #0891b2;
        }

        .source-type-pill.active {
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
            font-weight: 700;
        }

        [data-theme="dark"] .st-government.active { background: rgba(220, 38, 38, 0.2); }
        [data-theme="dark"] .st-news.active { background: rgba(37, 99, 235, 0.2); }
        [data-theme="dark"] .st-legal.active { background: rgba(124, 58, 237, 0.2); }
        [data-theme="dark"] .st-thinktank.active { background: rgba(5, 150, 105, 0.2); }
        [data-theme="dark"] .st-industry.active { background: rgba(217, 119, 6, 0.2); }
        [data-theme="dark"] .st-international.active { background: rgba(8, 145, 178, 0.2); }

        /* Source Name Filter (within source type) */
        .source-name-filter-row {
            padding: var(--space-2) var(--space-6);
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-primary);
            display: flex;
            align-items: center;
            gap: var(--space-3);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .source-name-pills {
            display: flex;
            gap: var(--space-2);
            flex-wrap: wrap;
        }

        .source-name-pill {
            display: inline-flex;
            align-items: center;
            gap: var(--space-1);
            padding: var(--space-1) var(--space-2);
            font-size: 0.7rem;
            font-weight: 500;
            color: var(--text-secondary);
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
            white-space: nowrap;
        }

        .source-name-pill:hover {
            border-color: var(--accent-primary);
            background: var(--accent-glow);
        }

        .source-name-pill.active {
            background: var(--accent-secondary);
            border-color: var(--accent-secondary);
            color: white;
        }

        .source-name-pill .source-count {
            font-size: 0.65rem;
            opacity: 0.7;
            margin-left: 2px;
        }

        /* Category bar - keep for flat display on mobile */
        .category-bar {
            display: flex;
            gap: var(--space-2);
            margin-top: var(--space-3);
            overflow-x: auto;
            padding-bottom: var(--space-2);
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
        }
        
        .category-bar::-webkit-scrollbar {
            height: 4px;
        }
        
        .category-bar::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 2px;
        }
        
        .category-chip {
            padding: var(--space-1) var(--space-3);
            font-size: 0.75rem;
            white-space: nowrap;
            color: var(--text-secondary);
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .category-chip:hover {
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }
        
        .category-chip.active {
            color: white;
            background: var(--accent-primary);
            border-color: var(--accent-primary);
        }
        
        .category-chip .count {
            margin-left: var(--space-1);
            opacity: 0.7;
        }
        
        /* New articles banner */
        .new-articles-banner {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-3);
            padding: var(--space-2) var(--space-4);
            background: var(--accent-glow);
            border: 1px solid var(--accent-primary);
            border-radius: var(--radius-sm);
            margin-bottom: var(--space-3);
            font-size: 0.875rem;
            color: var(--accent-primary);
        }
        
        .new-articles-banner button {
            padding: var(--space-1) var(--space-2);
            font-size: 0.75rem;
            background: var(--accent-primary);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
        }
        
        .new-articles-banner .close-banner {
            background: transparent;
            color: var(--text-muted);
            font-size: 1rem;
            padding: 0;
            margin-left: auto;
        }
        
        /* ========================================
           MAIN LAYOUT
           ======================================== */
        .main {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--space-8);
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: var(--space-8);
        }
        
        @media (max-width: 1024px) {
            .main {
                grid-template-columns: 1fr;
                padding: var(--space-4);
            }
            
            .sidebar {
                order: 2;
            }
            
            .articles-section {
                order: 1;
            }
        }
        
        /* ========================================
           SIDEBAR
           ======================================== */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: var(--space-6);
        }
        
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: var(--space-5);
            box-shadow: var(--shadow-sm);
        }
        
        .card-title {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: var(--space-4);
        }
        
        /* Stats Grid with trends */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-3);
        }
        
        .stat-item {
            padding: var(--space-4);
            text-align: center;
            background: var(--bg-secondary);
            border-radius: var(--radius-sm);
            position: relative;
            overflow: hidden;
        }
        
        .stat-item.critical::before,
        .stat-item.high::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
        }
        
        .stat-item.critical::before { background: var(--critical-color); }
        .stat-item.high::before { background: var(--high-color); }
        
        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.2;
        }
        
        .stat-separator {
            font-size: 1.25rem;
            color: var(--text-muted);
            margin: 0 0.15rem;
            font-weight: 400;
        }
        
        .stat-secondary {
            font-size: 1.25rem;
            font-weight: 500;
            color: var(--text-muted);
        }
        
        .stat-label {
            font-size: 0.6875rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-top: var(--space-1);
        }
        
        .stat-trend {
            font-size: 0.6875rem;
            margin-top: var(--space-2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-1);
        }
        
        .stat-trend.up { color: var(--medium-color); }
        .stat-trend.down { color: var(--critical-color); }
        
        /* Story Clusters */
        .story-clusters-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }
        
        .story-cluster {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            overflow: hidden;
        }
        
        .story-cluster-header {
            padding: var(--space-3);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
            transition: background var(--transition-fast);
        }
        
        .story-cluster-header:hover {
            background: var(--border-color);
        }
        
        .story-cluster-headline {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-primary);
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .story-cluster-meta {
            display: flex;
            gap: var(--space-2);
            flex-wrap: wrap;
            align-items: center;
        }
        
        .story-cluster-badge {
            font-size: 0.6875rem;
            padding: 0.125rem var(--space-2);
            border-radius: var(--radius-full);
            background: var(--accent-primary);
            color: white;
            font-weight: 500;
        }
        
        .story-cluster-entities {
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        
        .story-cluster-entities span {
            background: var(--border-color);
            padding: 0.125rem var(--space-2);
            border-radius: 4px;
            margin-right: var(--space-1);
        }
        
        .story-cluster-expand {
            font-size: 0.75rem;
            color: var(--accent-primary);
            margin-left: auto;
            transition: transform var(--transition-fast);
        }
        
        .story-cluster.expanded .story-cluster-expand {
            transform: rotate(180deg);
        }
        
        .story-cluster-perspectives {
            display: none;
            border-top: 1px solid var(--border-color);
            padding: var(--space-3);
            background: var(--bg-card);
        }
        
        .story-cluster.expanded .story-cluster-perspectives {
            display: block;
        }
        
        .perspective-item {
            padding: var(--space-2) 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .perspective-item:last-child {
            border-bottom: none;
        }
        
        .perspective-source {
            font-size: 0.75rem;
            color: var(--text-muted);
            font-weight: 500;
        }
        
        .perspective-title {
            font-size: 0.8125rem;
            color: var(--accent-primary);
            text-decoration: none;
            display: block;
            margin-top: var(--space-1);
        }
        
        .perspective-title:hover {
            text-decoration: underline;
        }
        
        .perspective-unique {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: var(--space-1);
            font-style: italic;
        }
        
        /* Newsletter CTA */
        .newsletter-cta {
            text-align: center;
        }
        
        .newsletter-cta p {
            font-size: 0.8125rem;
            color: var(--text-secondary);
            margin-bottom: var(--space-3);
        }
        
        .newsletter-cta .btn {
            width: 100%;
        }
        
        /* ========================================
           ARTICLE CARDS
           ======================================== */
        .articles-section {
            min-height: 500px;
        }
        
        .articles-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-4);
        }
        
        .articles-header h2 {
            font-size: 1.125rem;
            font-weight: 600;
        }
        
        .articles-grid {
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
        }
        
        /* Virtual scroller container */
        .virtual-scroller {
            position: relative;
        }
        
        .article-card {
            --priority-color: var(--medium-color);
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: var(--space-5);
            position: relative;
            transition: transform var(--transition-fast), box-shadow var(--transition-fast);
        }
        
        .article-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--priority-color);
            border-radius: var(--radius-md) 0 0 var(--radius-md);
        }
        
        .article-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .article-card.critical { --priority-color: var(--critical-color); }
        .article-card.high { --priority-color: var(--high-color); }
        
        .article-card.keyboard-focus {
            outline: 2px solid var(--accent-primary);
            outline-offset: 2px;
            box-shadow: 0 0 0 4px var(--accent-glow);
        }
        
        .article-card.new::after {
            content: 'NEW';
            position: absolute;
            top: var(--space-2);
            right: var(--space-2);
            font-size: 0.625rem;
            font-weight: 600;
            padding: 0.125rem var(--space-2);
            background: var(--accent-primary);
            color: white;
            border-radius: var(--radius-sm);
        }
        
        .article-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-3);
            gap: var(--space-4);
        }
        
        .article-meta {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--space-2);
            font-size: 0.8125rem;
            color: var(--text-muted);
        }
        
        .article-source {
            color: var(--accent-primary);
            font-weight: 500;
            text-decoration: none;
        }
        
        .article-source:hover {
            text-decoration: underline;
        }
        
        .article-separator {
            opacity: 0.5;
        }
        
        .article-date,
        .article-read-time {
            color: var(--text-muted);
        }
        
        .article-priority {
            font-size: 0.6875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: var(--space-1) var(--space-2);
            border-radius: 4px;
            background: color-mix(in srgb, var(--priority-color) 12%, transparent);
            color: var(--priority-color);
            white-space: nowrap;
        }
        
        /* Add visual pattern for colorblind users */
        .article-card.critical .article-priority::before {
            content: '!! ';
        }
        
        .article-card.high .article-priority::before {
            content: '! ';
        }
        
        .article-title {
            font-size: 1.0625rem;
            font-weight: 600;
            line-height: 1.4;
            margin-bottom: var(--space-2);
        }
        
        .article-title a {
            color: var(--text-primary);
            text-decoration: none;
        }
        
        .article-title a:hover {
            color: var(--accent-primary);
        }
        
        .article-summary {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.6;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .article-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: var(--space-4);
            padding-top: var(--space-3);
            border-top: 1px solid var(--border-color);
        }
        
        .article-category {
            font-size: 0.75rem;
            color: var(--text-muted);
            background: var(--bg-secondary);
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-full);
        }
        
        .article-actions {
            display: flex;
            gap: var(--space-1);
            opacity: 0;
            transition: opacity var(--transition-fast);
        }
        
        .article-card:hover .article-actions {
            opacity: 1;
        }
        
        .article-action {
            padding: var(--space-2);
            background: transparent;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            color: var(--text-muted);
            transition: all var(--transition-fast);
        }
        
        .article-action:hover {
            background: var(--bg-secondary);
            color: var(--accent-primary);
        }
        
        .article-action.bookmarked {
            color: var(--accent-primary);
        }
        
        /* ========================================
           PAGINATION
           ======================================== */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-8) 0;
        }
        
        .pagination-btn {
            padding: var(--space-2) var(--space-4);
            font-size: 0.875rem;
            color: var(--text-primary);
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .pagination-btn:hover:not(:disabled) {
            color: white;
            background: var(--accent-primary);
            border-color: var(--accent-primary);
        }
        
        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .pagination-btn.active {
            color: white;
            background: var(--accent-primary);
            border-color: var(--accent-primary);
        }
        
        .pagination-info {
            color: var(--text-muted);
            font-size: 0.875rem;
        }
        
        /* ========================================
           LOADING & EMPTY STATES
           ======================================== */
        .loading-state {
            text-align: center;
            padding: var(--space-12) var(--space-8);
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-color);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto var(--space-4);
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .skeleton-cards {
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
        }
        
        .skeleton-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: var(--space-5);
        }
        
        .skeleton-line {
            height: 1rem;
            background: linear-gradient(
                90deg,
                var(--bg-secondary) 25%,
                var(--border-color) 50%,
                var(--bg-secondary) 75%
            );
            background-size: 200% 100%;
            animation: shimmer 1.5s ease-in-out infinite;
            border-radius: 4px;
            margin-bottom: var(--space-2);
        }
        
        .skeleton-line:last-child { margin-bottom: 0; }
        .skeleton-line.w-20 { width: 20%; }
        .skeleton-line.w-30 { width: 30%; }
        .skeleton-line.w-50 { width: 50%; }
        .skeleton-line.w-70 { width: 70%; }
        .skeleton-line.w-90 { width: 90%; }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        .empty-state {
            text-align: center;
            padding: var(--space-12) var(--space-8);
        }
        
        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: var(--space-4);
        }
        
        .empty-state-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--space-2);
        }
        
        .empty-state-description {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: var(--space-6);
        }
        
        .empty-state-actions {
            display: flex;
            justify-content: center;
            gap: var(--space-3);
            flex-wrap: wrap;
        }
        
        /* ========================================
           MODALS
           ======================================== */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: var(--space-4);
        }
        
        .modal-overlay.visible {
            display: flex;
        }
        
        .modal-content {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-5);
            border-bottom: 1px solid var(--border-color);
        }
        
        .modal-title {
            font-size: 1.125rem;
            font-weight: 600;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-muted);
            cursor: pointer;
            padding: var(--space-1);
            line-height: 1;
        }
        
        .modal-close:hover {
            color: var(--text-primary);
        }
        
        .modal-body {
            padding: var(--space-5);
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: var(--space-3);
            padding: var(--space-5);
            border-top: 1px solid var(--border-color);
        }
        
        /* Shortcuts modal */
        .shortcuts-modal {
            max-width: 600px;
        }
        
        .shortcuts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: var(--space-6);
        }
        
        .shortcut-group h4 {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            margin-bottom: var(--space-3);
        }
        
        .shortcut {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin-bottom: var(--space-2);
            font-size: 0.875rem;
        }
        
        .shortcut kbd {
            display: inline-block;
            padding: 0.125rem var(--space-2);
            font-size: 0.75rem;
            font-family: monospace;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            min-width: 1.5rem;
            text-align: center;
        }
        
        .shortcut span {
            color: var(--text-secondary);
        }
        
        /* ========================================
           MOBILE BOTTOM NAVIGATION
           ======================================== */
        .mobile-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-card);
            border-top: 1px solid var(--border-color);
            padding: var(--space-2);
            padding-bottom: calc(var(--space-2) + env(safe-area-inset-bottom));
            z-index: 100;
        }
        
        @media (max-width: 768px) {
            .mobile-nav {
                display: flex;
                justify-content: space-around;
                padding-bottom: env(safe-area-inset-bottom);
            }

            .main {
                padding-bottom: 80px;
                padding-left: var(--space-3);
                padding-right: var(--space-3);
                padding-top: var(--space-3);
            }

            .header-nav {
                display: none;
            }

            .header-content {
                padding: var(--space-3) var(--space-4);
            }

            .logo {
                font-size: 1.125rem;
            }

            /* === MOBILE FILTER REDESIGN === */
            /* Hide the entire filter bar on mobile - use bottom sheet instead */
            .filter-bar {
                display: none;
            }

            /* Mobile Filter Bottom Sheet */
            .mobile-filter-sheet {
                display: block !important;
                position: fixed;
                bottom: calc(56px + env(safe-area-inset-bottom)); /* Above mobile nav */
                left: 0;
                right: 0;
                background: var(--bg-card);
                border-radius: var(--radius-lg) var(--radius-lg) 0 0;
                box-shadow: 0 -4px 30px rgba(0, 0, 0, 0.15);
                z-index: 999;
                transform: translateY(100%); /* Hidden by default */
                transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                max-height: 60vh;
                overflow: hidden;
            }

            .mobile-filter-sheet.expanded {
                transform: translateY(0);
                box-shadow: 0 -8px 40px rgba(0, 0, 0, 0.2);
            }

            .mobile-filter-backdrop {
                display: none;
                position: fixed;
                inset: 0;
                background: rgba(0, 0, 0, 0.4);
                z-index: 998;
            }

            .mobile-filter-backdrop.visible {
                display: block;
            }

            .mobile-filter-sheet-handle {
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: var(--space-3) var(--space-4);
                cursor: pointer;
                border-bottom: 1px solid var(--border-color);
                -webkit-tap-highlight-color: transparent;
            }

            .mobile-filter-sheet-handle::before {
                content: '';
                position: absolute;
                top: 6px;
                left: 50%;
                transform: translateX(-50%);
                width: 32px;
                height: 3px;
                background: var(--border-color);
                border-radius: 2px;
            }

            .mobile-filter-handle-left {
                display: flex;
                align-items: center;
                gap: var(--space-2);
                font-weight: 600;
                font-size: 0.875rem;
            }

            .mobile-filter-handle-left svg {
                width: 20px;
                height: 20px;
            }

            .mobile-filter-count {
                background: var(--accent-primary);
                color: white;
                font-size: 0.6875rem;
                font-weight: 700;
                padding: 2px 8px;
                border-radius: var(--radius-full);
            }

            .mobile-filter-clear {
                font-size: 0.75rem;
                color: var(--accent-primary);
                background: none;
                border: none;
                padding: var(--space-2);
                cursor: pointer;
            }

            .mobile-filter-sheet-content {
                padding: var(--space-4);
                overflow-y: auto;
                max-height: calc(60vh - 60px);
                padding-bottom: var(--space-4);
            }

            .mobile-filter-section {
                margin-bottom: var(--space-5);
            }

            .mobile-filter-section:last-child {
                margin-bottom: 0;
            }

            .mobile-filter-section-title {
                font-size: 0.6875rem;
                font-weight: 700;
                text-transform: uppercase;
                letter-spacing: 0.08em;
                color: var(--text-muted);
                margin-bottom: var(--space-3);
            }

            .mobile-filter-options {
                display: flex;
                flex-wrap: wrap;
                gap: var(--space-2);
            }

            .mobile-filter-chip {
                display: inline-flex;
                align-items: center;
                gap: var(--space-1);
                padding: var(--space-2) var(--space-3);
                font-size: 0.8125rem;
                font-weight: 500;
                color: var(--text-secondary);
                background: var(--bg-secondary);
                border: 1px solid var(--border-color);
                border-radius: var(--radius-md);
                cursor: pointer;
                transition: all var(--transition-fast);
                min-height: 44px;
            }

            .mobile-filter-chip:active {
                transform: scale(0.97);
            }

            .mobile-filter-chip.active {
                background: var(--accent-primary);
                border-color: var(--accent-primary);
                color: white;
            }

            .mobile-filter-apply {
                width: 100%;
                padding: var(--space-4);
                margin-top: var(--space-4);
                background: var(--accent-primary);
                color: white;
                font-size: 1rem;
                font-weight: 600;
                border: none;
                border-radius: var(--radius-md);
                cursor: pointer;
                min-height: 50px;
            }

            .mobile-filter-apply:active {
                opacity: 0.9;
                transform: scale(0.99);
            }

            /* Mobile Search Bar - Always visible at top */
            .mobile-search-bar {
                display: flex;
                padding: var(--space-3) var(--space-4);
                background: var(--bg-secondary);
                border-bottom: 1px solid var(--border-color);
                gap: var(--space-2);
                position: sticky;
                top: 0;
                z-index: 50;
            }

            .mobile-search-bar .search-input {
                flex: 1;
                font-size: 16px;
                padding: var(--space-3);
                min-height: 44px;
                border-radius: var(--radius-md);
            }

            .mobile-active-filters {
                display: flex;
                gap: var(--space-2);
                padding: var(--space-2) var(--space-4);
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                background: var(--bg-primary);
                border-bottom: 1px solid var(--border-color);
            }

            .mobile-active-filter-chip {
                display: inline-flex;
                align-items: center;
                gap: var(--space-1);
                padding: var(--space-1) var(--space-2);
                font-size: 0.75rem;
                font-weight: 500;
                color: var(--accent-primary);
                background: var(--accent-glow);
                border: 1px solid var(--accent-primary);
                border-radius: var(--radius-full);
                white-space: nowrap;
                cursor: pointer;
            }

            .mobile-active-filter-chip .remove {
                font-size: 0.875rem;
                margin-left: 2px;
            }

            /* Hide desktop elements */
            .filter-section-label {
                display: none;
            }

            /* Mobile Article Cards */
            .articles-section {
                padding-top: 0;
            }

            .articles-header {
                padding: var(--space-3) 0;
            }

            .articles-header h2 {
                font-size: 1rem;
            }

            .articles-grid {
                gap: var(--space-3);
            }

            .article-card {
                padding: var(--space-4);
                border-radius: var(--radius-md);
            }

            .article-title {
                font-size: 0.9375rem;
                line-height: 1.4;
            }

            .article-summary {
                font-size: 0.8125rem;
                -webkit-line-clamp: 3;
            }

            .article-meta {
                font-size: 0.75rem;
                flex-wrap: wrap;
                gap: var(--space-2);
            }

            .article-actions {
                opacity: 1;
                position: relative;
                margin-top: var(--space-3);
                padding-top: var(--space-3);
                border-top: 1px solid var(--border-color);
                justify-content: space-around;
            }

            .article-action {
                min-width: 48px;
                min-height: 48px;
                font-size: 1.125rem;
            }

            /* Mobile Sidebar - Hidden */
            .sidebar {
                display: none;
            }

            /* Mobile Pagination */
            .pagination {
                gap: var(--space-1);
                flex-wrap: wrap;
                justify-content: center;
                padding: var(--space-4) 0;
            }

            .pagination-btn {
                min-width: 44px;
                min-height: 44px;
                font-size: 0.875rem;
            }

            .freshness-indicator {
                display: none;
            }

            /* Mobile Footer */
            .footer {
                padding: var(--space-6) var(--space-4);
                padding-bottom: calc(var(--space-8) + 60px + env(safe-area-inset-bottom));
            }

            .footer-content {
                flex-direction: column;
                text-align: center;
            }

            .footer-links {
                flex-wrap: wrap;
                justify-content: center;
                gap: var(--space-4);
            }
        }

        /* Mobile-only elements - hidden by default on desktop */
        .mobile-filter-sheet,
        .mobile-filter-backdrop {
            display: none;
        }

        .mobile-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-card);
            border-top: 1px solid var(--border-color);
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            padding-bottom: env(safe-area-inset-bottom);
        }

        .mobile-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 2px;
            padding: var(--space-2) var(--space-3);
            min-height: 56px;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 0.625rem;
            font-weight: 500;
            text-decoration: none;
            cursor: pointer;
            position: relative;
            transition: all var(--transition-fast);
            -webkit-tap-highlight-color: transparent;
        }

        .mobile-nav-item:active {
            transform: scale(0.95);
            background: var(--accent-glow);
        }

        .mobile-nav-item.active {
            color: var(--accent-primary);
        }

        .mobile-nav-item.active::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 32px;
            height: 3px;
            background: var(--accent-primary);
            border-radius: 0 0 3px 3px;
        }

        .mobile-nav-item svg {
            width: 22px;
            height: 22px;
            stroke-width: 2.5;
        }

        .mobile-nav-item.active svg {
            stroke-width: 2.5;
        }

        .mobile-nav-badge {
            position: absolute;
            top: 4px;
            right: 50%;
            transform: translateX(12px);
            background: var(--critical-color);
            color: white;
            font-size: 0.5625rem;
            font-weight: 700;
            min-width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 4px;
            border-radius: var(--radius-full);
            box-shadow: 0 2px 4px rgba(220, 38, 38, 0.3);
        }
        
        /* ========================================
           FOOTER
           ======================================== */
        .footer {
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            padding: var(--space-8);
            margin-top: var(--space-12);
        }
        
        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--space-4);
        }
        
        .footer-text {
            font-size: 0.875rem;
            color: var(--text-muted);
        }
        
        .footer-links {
            display: flex;
            gap: var(--space-6);
        }
        
        .footer-links a {
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-decoration: none;
        }
        
        .footer-links a:hover {
            color: var(--accent-primary);
        }
        
        /* ========================================
           TOAST NOTIFICATIONS
           ======================================== */
        .toast-container {
            position: fixed;
            bottom: 100px;
            right: var(--space-4);
            z-index: 1001;
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }
        
        .toast {
            padding: var(--space-3) var(--space-4);
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow-lg);
            font-size: 0.875rem;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* Loaded indicator */
        .loaded-indicator {
            font-size: 0.75rem;
            color: var(--medium-color);
            animation: fadeOut 3s ease forwards;
        }
        
        @keyframes fadeOut {
            0%, 70% { opacity: 1; }
            100% { opacity: 0; }
        }
        
        /* ========================================
           UI/UX FIXES - P0 & P1 PRIORITY
           ======================================== */
        
        /* Fix #1: Mobile Filter Bar Stacking (P0) */
        @media (max-width: 480px) {
            .main {
                padding-left: var(--space-2);
                padding-right: var(--space-2);
            }

            .filter-row {
                flex-direction: column;
                align-items: stretch;
                gap: var(--space-3);
            }

            .filter-group {
                flex-wrap: wrap;
                justify-content: flex-start;
                gap: var(--space-2);
            }

            .filter-divider {
                display: none;
            }

            .filter-summary {
                margin-left: 0;
                justify-content: space-between;
                width: 100%;
            }

            .filter-count {
                font-size: 0.75rem;
            }

            .search-input {
                width: 100%;
            }

            .search-input:focus {
                width: 100%;
            }

            /* Compact Domain Pills on Small Screens */
            .domain-pill {
                padding: var(--space-2);
                font-size: 0.6875rem;
            }

            .domain-pill .pill-icon {
                margin-right: 0;
            }

            /* Hide text, show only icons on very small screens */
            .domain-pill span:not(.pill-icon) {
                display: none;
            }

            .domain-pill .pill-icon {
                font-size: 1.25rem;
            }

            /* Compact Source Type Pills */
            .source-type-pill {
                padding: var(--space-2);
                font-size: 0.6875rem;
            }

            /* Article Cards - Full Width */
            .article-card {
                padding: var(--space-3);
                margin: 0 calc(-1 * var(--space-2));
                border-radius: 0;
                border-left: none;
                border-right: none;
            }

            .article-title {
                font-size: 0.875rem;
            }

            .article-summary {
                font-size: 0.75rem;
                -webkit-line-clamp: 2;
            }

            .article-category {
                font-size: 0.625rem;
                padding: 2px 6px;
            }

            /* Simplified Article Actions */
            .article-actions {
                gap: var(--space-2);
            }

            .article-action span {
                display: none;
            }

            /* Compact Header */
            .header-content {
                padding: var(--space-2) var(--space-3);
            }

            .logo {
                font-size: 1rem;
            }

            .logo-emoji {
                font-size: 1.25rem;
            }

            /* Pagination - Compact */
            .pagination-btn {
                min-width: 40px;
                min-height: 40px;
                padding: var(--space-2);
                font-size: 0.75rem;
            }

            .pagination-ellipsis {
                padding: 0 var(--space-1);
            }

            /* Story Clusters - Compact */
            .story-cluster-headline {
                font-size: 0.8125rem;
            }

            .story-cluster-badge {
                font-size: 0.625rem;
                padding: 2px 6px;
            }
        }
        
        /* Fix #2: Touch Target Sizes (P0) - Minimum 44x44px */
        @media (hover: none) and (pointer: coarse) {
            .filter-btn {
                min-height: 44px;
                min-width: 44px;
                padding: var(--space-3) var(--space-4);
            }
            
            .category-chip {
                min-height: 44px;
                padding: var(--space-3) var(--space-4);
            }
            
            .btn-icon {
                min-width: 44px;
                min-height: 44px;
            }
            
            .nav-link {
                min-height: 44px;
                padding: var(--space-3) var(--space-4);
            }
            
            .article-action {
                min-width: 44px;
                min-height: 44px;
            }
            
            .pagination-btn {
                min-height: 44px;
                min-width: 44px;
            }
            
            .mobile-nav-item {
                min-height: 44px;
            }
        }
        
        /* Fix #7: Show Article Actions on Touch Devices (P1) */
        @media (hover: none) {
            .article-actions {
                opacity: 1;
            }
        }
        
        /* Alternative: Show on focus-within */
        .article-card:focus-within .article-actions {
            opacity: 1;
        }
        
        /* Fix #8: Priority Badge Fallback for older browsers (P1) */
        .article-priority {
            /* Fallback for browsers without color-mix */
            background: rgba(5, 150, 105, 0.12);
        }
        
        .article-card.critical .article-priority {
            background: rgba(220, 38, 38, 0.12);
        }
        
        .article-card.high .article-priority {
            background: rgba(217, 119, 6, 0.12);
        }
        
        @supports (background: color-mix(in srgb, red 50%, blue)) {
            .article-priority {
                background: color-mix(in srgb, var(--priority-color) 12%, transparent);
            }
        }
        
        /* Fix #5: Category Bar Scrollbar Visibility (P1) */
        .category-bar::-webkit-scrollbar {
            height: 6px;
        }
        
        .category-bar::-webkit-scrollbar-thumb {
            background: var(--text-muted);
            border-radius: 3px;
        }
        
        .category-bar::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 3px;
        }
        
        /* Fix #12: Toast Container Safe Area (P2) */
        .toast-container {
            bottom: calc(100px + env(safe-area-inset-bottom));
        }
        
        /* Fix #13: Main Grid Gap on Medium Screens (P2) */
        @media (max-width: 1024px) and (min-width: 769px) {
            .main {
                gap: var(--space-6);
            }
        }
        
        /* Fix #41: Standardized Focus Indicators (P1) */
        *:focus-visible {
            outline: 2px solid var(--accent-primary);
            outline-offset: 2px;
        }
        
        .btn:focus-visible,
        .filter-btn:focus-visible,
        .category-chip:focus-visible,
        .nav-link:focus-visible {
            outline: 2px solid var(--accent-primary);
            outline-offset: 2px;
            box-shadow: 0 0 0 4px var(--accent-glow);
        }
        
        /* Fix #42: Reduced Motion Support (P1) */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
            
            .loading-spinner {
                animation: none;
                border-style: solid;
            }
            
            .skeleton-line {
                animation: none;
            }
        }
        
        /* Fix: Disabled button states (Quick Win) */
        .btn:disabled,
        .back-btn:disabled,
        .filter-btn:disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }
        
        /* Fix #11: Story Cluster Expand Animation (P2) */
        .story-cluster-expand {
            transition: transform 0.2s ease;
        }
    </style>
</head>
<body>
    <!-- Skip Link for Accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Screen reader announcements -->
    <div class="sr-only" aria-live="polite" id="announcements"></div>
    
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="header-left">
                <a href="/" class="logo">
                    <span class="logo-icon">ðŸ“¡</span>
                    <span>PolicyRadar</span>
                    <span class="logo-badge">Beta</span>
                </a>
                
                <nav class="header-nav" role="navigation" aria-label="Main navigation">
                    <a href="index.html" class="nav-link active" aria-current="page">Dashboard</a>
                    <a href="topic-explorer.html" class="nav-link">Topics</a>
                    <a href="knowledge-graph.html" class="nav-link">Graph</a>
                </nav>
            </div>
            
            <div class="header-right">
                <div class="freshness-indicator" aria-live="polite">
                    <span class="freshness-dot"></span>
                    <span id="last-updated">Loading...</span>
                </div>
                
                <div class="social-links">
                    <a href="https://twitter.com/PolicyRadarIN" target="_blank" rel="noopener" aria-label="Follow on X/Twitter">ð•</a>
                    <a href="https://linkedin.com/company/policyradarin" target="_blank" rel="noopener" aria-label="Follow on LinkedIn">in</a>
                </div>
                
                <div class="header-actions">
                    <button class="btn btn-icon" onclick="showReadingListModal()" aria-label="Reading List" title="Reading List (r)">
                        ðŸ”–
                    </button>
                    <button class="btn btn-icon" onclick="showPdfModal()" aria-label="Export as PDF" title="Export PDF (p)">
                        ðŸ“„
                    </button>
                    <button class="btn btn-icon" onclick="toggleTheme()" aria-label="Toggle theme" title="Toggle theme">
                        ðŸŒ“
                    </button>
                    <button class="btn btn-icon" onclick="showShortcutsHelp()" aria-label="Keyboard shortcuts" title="Keyboard shortcuts (?)">
                        âŒ¨ï¸
                    </button>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Filter Bar -->
    <div class="filter-bar">
        <div class="filter-content">
            <div class="filter-row">
                <!-- Search -->
                <div class="filter-group">
                    <div class="search-wrapper">
                        <input type="search" 
                               id="search-input" 
                               class="search-input" 
                               placeholder="Search articles..."
                               aria-label="Search articles"
                               oninput="handleSearch(this.value)">
                        <kbd class="search-kbd" id="search-kbd">/</kbd>
                        <button class="search-clear hidden" id="clear-search-btn" onclick="clearSearch()" aria-label="Clear search">Ã—</button>
                    </div>
                </div>
                
                <div class="filter-divider"></div>
                
                <!-- Time filter -->
                <div class="filter-group">
                    <span class="filter-label">Time</span>
                    <div role="radiogroup" aria-label="Time filter">
                        <button class="filter-btn active" data-time="all" onclick="setTimeFilter('all', this)" role="radio" aria-checked="true">All</button>
                        <button class="filter-btn" data-time="today" onclick="setTimeFilter('today', this)" role="radio" aria-checked="false">Today</button>
                        <button class="filter-btn" data-time="week" onclick="setTimeFilter('week', this)" role="radio" aria-checked="false">Week</button>
                    </div>
                </div>
                
                <div class="filter-divider"></div>
                
                <!-- Priority filter -->
                <div class="filter-group">
                    <span class="filter-label">Priority</span>
                    <div role="radiogroup" aria-label="Priority filter">
                        <button class="filter-btn active" data-priority="all" onclick="setPriorityFilter('all', this)" role="radio" aria-checked="true">All</button>
                        <button class="filter-btn critical" data-priority="critical" onclick="setPriorityFilter('critical', this)" role="radio" aria-checked="false">
                            <span class="priority-dot critical"></span>Critical
                        </button>
                        <button class="filter-btn high" data-priority="high" onclick="setPriorityFilter('high', this)" role="radio" aria-checked="false">
                            <span class="priority-dot high"></span>High+
                        </button>
                    </div>
                </div>
                
                <!-- Filter summary -->
                <div class="filter-summary">
                    <span class="filter-count" id="filter-count">Loading...</span>
                    <button class="filter-clear-all" id="clear-all-filters" onclick="resetFilters()" style="display: none;">
                        Clear all
                    </button>
                </div>
            </div>
            
            <!-- Domain Filter (5 Main Categories) -->
            <div class="domain-filter-row">
                <span class="filter-section-label">Policy Domain</span>
                <div class="domain-pills" role="radiogroup" aria-label="Domain filter">
                    <button class="domain-pill active" data-domain="" onclick="setDomainFilter('', this)">
                        <span class="pill-icon">ðŸ“‹</span> All
                    </button>
                    <button class="domain-pill domain-economy" data-domain="economy" onclick="setDomainFilter('economy', this)">
                        <span class="pill-icon">ðŸ’°</span> Economy
                    </button>
                    <button class="domain-pill domain-technology" data-domain="technology" onclick="setDomainFilter('technology', this)">
                        <span class="pill-icon">ðŸ’»</span> Technology
                    </button>
                    <button class="domain-pill domain-infrastructure" data-domain="infrastructure" onclick="setDomainFilter('infrastructure', this)">
                        <span class="pill-icon">ðŸ—ï¸</span> Infrastructure
                    </button>
                    <button class="domain-pill domain-social" data-domain="social" onclick="setDomainFilter('social', this)">
                        <span class="pill-icon">ðŸ‘¥</span> Social
                    </button>
                    <button class="domain-pill domain-governance" data-domain="governance" onclick="setDomainFilter('governance', this)">
                        <span class="pill-icon">ðŸ›ï¸</span> Governance
                    </button>
                </div>
            </div>

            <!-- Subsector Filter (shown when domain selected) -->
            <div class="subsector-filter-row" id="subsector-row" style="display: none;">
                <span class="filter-section-label">Category</span>
                <div class="subsector-pills" id="subsector-pills">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Source Type Filter -->
            <div class="source-type-filter-row">
                <span class="filter-section-label">Source Type</span>
                <div class="source-type-pills" role="radiogroup" aria-label="Source type filter">
                    <button class="source-type-pill active" data-source-type="" onclick="setSourceTypeFilter('', this)">All Sources</button>
                    <button class="source-type-pill st-government" data-source-type="Government" onclick="setSourceTypeFilter('Government', this)">
                        <span class="st-dot"></span> Government
                    </button>
                    <button class="source-type-pill st-news" data-source-type="News" onclick="setSourceTypeFilter('News', this)">
                        <span class="st-dot"></span> News Media
                    </button>
                    <button class="source-type-pill st-legal" data-source-type="Legal" onclick="setSourceTypeFilter('Legal', this)">
                        <span class="st-dot"></span> Legal
                    </button>
                    <button class="source-type-pill st-thinktank" data-source-type="Think Tank" onclick="setSourceTypeFilter('Think Tank', this)">
                        <span class="st-dot"></span> Think Tank
                    </button>
                    <button class="source-type-pill st-industry" data-source-type="Industry" onclick="setSourceTypeFilter('Industry', this)">
                        <span class="st-dot"></span> Industry
                    </button>
                    <button class="source-type-pill st-international" data-source-type="International" onclick="setSourceTypeFilter('International', this)">
                        <span class="st-dot"></span> International
                    </button>
                </div>
            </div>

            <!-- Source Name Filter (shown when source type selected) -->
            <div class="source-name-filter-row" id="source-name-row" style="display: none;">
                <span class="filter-section-label">Publication</span>
                <div class="source-name-pills" id="source-name-pills">
                    <!-- Populated by JS based on selected source type -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Top Stories Ticker -->
    <div class="top-stories-ticker-bar" id="ticker-bar" style="display: none;">
        <div class="ticker-inner">
            <span class="ticker-badge">ðŸ“Œ Latest</span>
            <div class="ticker-scroll-area">
                <div class="ticker-track" id="ticker-track">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <main class="main" id="main-content">
        <!-- Sidebar -->
        <aside class="sidebar">
            <!-- Stats -->
            <div class="card">
                <h2 class="card-title">ðŸ“Š Today's Overview</h2>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="stat-total">-</div>
                        <div class="stat-label">Total Articles</div>
                        <div class="stat-trend" id="stat-total-trend"></div>
                    </div>
                    <div class="stat-item critical">
                        <div class="stat-value" id="stat-critical">-</div>
                        <div class="stat-label">Critical</div>
                    </div>
                    <div class="stat-item high">
                        <div class="stat-value" id="stat-high">-</div>
                        <div class="stat-label">High Priority</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">
                            <span id="stat-sources-cited">-</span>
                            <span class="stat-separator">/</span>
                            <span id="stat-sources-monitored" class="stat-secondary">-</span>
                        </div>
                        <div class="stat-label">Sources Cited / Monitored</div>
                    </div>
                </div>
            </div>
            
            <!-- Story Clusters -->
            <div class="card">
                <h2 class="card-title">ðŸ“° Multi-Source Stories</h2>
                <div class="story-clusters-list" id="story-clusters-list">
                    <!-- Populated by JS -->
                </div>
            </div>
            
            <!-- Newsletter CTA -->
            <div class="card newsletter-cta">
                <h2 class="card-title">ðŸ“¬ Stay Updated</h2>
                <p>Get daily policy briefings delivered to your inbox.</p>
                <a href="https://policyradar.beehiiv.com/subscribe" target="_blank" rel="noopener" class="btn btn-primary">
                    Subscribe Free
                </a>
            </div>
        </aside>
        
        <!-- Articles Section -->
        <section class="articles-section" aria-label="Policy articles">
            <div class="articles-header">
                <h2>ðŸ“‹ Policy Feed</h2>
                <span id="articles-showing" class="filter-count"></span>
            </div>
            
            <div class="articles-grid" id="articles-grid" role="feed" aria-busy="true">
                <!-- Loading skeleton -->
                <div class="skeleton-cards" id="loading-skeleton">
                    <div class="skeleton-card">
                        <div class="skeleton-line w-30"></div>
                        <div class="skeleton-line w-90"></div>
                        <div class="skeleton-line w-70"></div>
                        <div class="skeleton-line w-50"></div>
                    </div>
                    <div class="skeleton-card">
                        <div class="skeleton-line w-20"></div>
                        <div class="skeleton-line w-90"></div>
                        <div class="skeleton-line w-70"></div>
                        <div class="skeleton-line w-50"></div>
                    </div>
                    <div class="skeleton-card">
                        <div class="skeleton-line w-30"></div>
                        <div class="skeleton-line w-90"></div>
                        <div class="skeleton-line w-70"></div>
                        <div class="skeleton-line w-50"></div>
                    </div>
                </div>
            </div>
            
            <div class="pagination" id="pagination">
                <!-- Populated by JS -->
            </div>
        </section>
    </main>
    
    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-text">
                Â© 2026 PolicyRadar. Aggregating policy intelligence from 240+ sources.
            </div>
            <div class="footer-links">
                <a href="https://twitter.com/PolicyRadarIN" target="_blank" rel="noopener">Twitter</a>
                <a href="https://linkedin.com/company/policyradarin" target="_blank" rel="noopener">LinkedIn</a>
                <a href="https://policyradar.beehiiv.com/subscribe" target="_blank" rel="noopener">Newsletter</a>
            </div>
        </div>
    </footer>
    
    <!-- Mobile Filter Backdrop -->
    <div class="mobile-filter-backdrop" id="mobile-filter-backdrop" onclick="toggleMobileFilters()"></div>

    <!-- Mobile Filter Bottom Sheet -->
    <div class="mobile-filter-sheet" id="mobile-filter-sheet">
        <div class="mobile-filter-sheet-handle" onclick="toggleMobileFilters()">
            <div class="mobile-filter-handle-left">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                    <path d="M22 3H2l8 9.46V19l4 2v-8.54L22 3z"/>
                </svg>
                <span>Filters</span>
                <span class="mobile-filter-count" id="mobile-filter-count" style="display: none;">0</span>
            </div>
            <button class="mobile-filter-clear" id="mobile-filter-clear" onclick="event.stopPropagation(); clearAllFilters();" style="display: none;">Clear all</button>
        </div>
        <div class="mobile-filter-sheet-content">
            <!-- Domain Filter -->
            <div class="mobile-filter-section">
                <div class="mobile-filter-section-title">Policy Domain</div>
                <div class="mobile-filter-options" id="mobile-domain-filters">
                    <button class="mobile-filter-chip active" data-domain="" onclick="setMobileDomainFilter('', this)">All</button>
                    <button class="mobile-filter-chip" data-domain="economy" onclick="setMobileDomainFilter('economy', this)">ðŸ’° Finance</button>
                    <button class="mobile-filter-chip" data-domain="technology" onclick="setMobileDomainFilter('technology', this)">ðŸ’» Digital</button>
                    <button class="mobile-filter-chip" data-domain="infrastructure" onclick="setMobileDomainFilter('infrastructure', this)">ðŸ—ï¸ Infrastructure</button>
                    <button class="mobile-filter-chip" data-domain="social" onclick="setMobileDomainFilter('social', this)">ðŸ‘¥ Social</button>
                    <button class="mobile-filter-chip" data-domain="governance" onclick="setMobileDomainFilter('governance', this)">ðŸ›ï¸ Governance</button>
                </div>
            </div>

            <!-- Subcategory Filter (shown when domain selected) -->
            <div class="mobile-filter-section" id="mobile-subcategory-section" style="display: none;">
                <div class="mobile-filter-section-title">Category</div>
                <div class="mobile-filter-options" id="mobile-subcategory-filters">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Source Type Filter -->
            <div class="mobile-filter-section">
                <div class="mobile-filter-section-title">Source Type</div>
                <div class="mobile-filter-options" id="mobile-source-type-filters">
                    <button class="mobile-filter-chip active" data-source-type="" onclick="setMobileSourceTypeFilter('', this)">All</button>
                    <button class="mobile-filter-chip" data-source-type="Government" onclick="setMobileSourceTypeFilter('Government', this)">
                        <span class="st-dot" style="background: #dc2626;"></span> Government
                    </button>
                    <button class="mobile-filter-chip" data-source-type="News" onclick="setMobileSourceTypeFilter('News', this)">
                        <span class="st-dot" style="background: #2563eb;"></span> News
                    </button>
                    <button class="mobile-filter-chip" data-source-type="Legal" onclick="setMobileSourceTypeFilter('Legal', this)">
                        <span class="st-dot" style="background: #7c3aed;"></span> Legal
                    </button>
                    <button class="mobile-filter-chip" data-source-type="Think Tank" onclick="setMobileSourceTypeFilter('Think Tank', this)">
                        <span class="st-dot" style="background: #059669;"></span> Think Tank
                    </button>
                    <button class="mobile-filter-chip" data-source-type="Industry" onclick="setMobileSourceTypeFilter('Industry', this)">
                        <span class="st-dot" style="background: #d97706;"></span> Industry
                    </button>
                    <button class="mobile-filter-chip" data-source-type="International" onclick="setMobileSourceTypeFilter('International', this)">
                        <span class="st-dot" style="background: #0891b2;"></span> International
                    </button>
                </div>
            </div>

            <!-- Time Filter -->
            <div class="mobile-filter-section">
                <div class="mobile-filter-section-title">Time Range</div>
                <div class="mobile-filter-options" id="mobile-time-filters">
                    <button class="mobile-filter-chip active" data-time="" onclick="setMobileTimeFilter('', this)">All Time</button>
                    <button class="mobile-filter-chip" data-time="today" onclick="setMobileTimeFilter('today', this)">Today</button>
                    <button class="mobile-filter-chip" data-time="week" onclick="setMobileTimeFilter('week', this)">This Week</button>
                </div>
            </div>

            <!-- Apply Button -->
            <button class="mobile-filter-apply" onclick="applyMobileFilters()">
                Show Results
            </button>
        </div>
    </div>

    <!-- Mobile Bottom Navigation -->
    <nav class="mobile-nav" aria-label="Mobile navigation">
        <a href="index.html" class="mobile-nav-item active">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
            </svg>
            <span>Feed</span>
        </a>
        <button class="mobile-nav-item" onclick="toggleMobileFilters()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 3H2l8 9.46V19l4 2v-8.54L22 3z"/>
            </svg>
            <span>Filter</span>
            <span class="mobile-nav-badge" id="active-filter-count" style="display: none;">0</span>
        </button>
        <a href="topic-explorer.html" class="mobile-nav-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"/>
                <path d="m21 21-4.35-4.35"/>
            </svg>
            <span>Topics</span>
        </a>
        <button class="mobile-nav-item" onclick="showPdfModal()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7 10 12 15 17 10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
            <span>Export</span>
        </button>
    </nav>
    
    <!-- PDF Export Modal -->
    <div class="modal-overlay" id="pdf-modal" role="dialog" aria-labelledby="pdf-modal-title" aria-modal="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="pdf-modal-title">ðŸ“„ Export PDF Briefing</h3>
                <button class="modal-close" onclick="closePdfModal()" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <p>Download a PDF briefing with <strong id="pdf-article-count">0</strong> articles matching your current filters.</p>
                <p style="font-size: 0.875rem; color: var(--text-muted); margin-top: 1rem;">
                    The PDF will include article titles, sources, publication dates, and direct links.
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closePdfModal()">Cancel</button>
                <button class="btn btn-primary" onclick="downloadPdf()">Download PDF</button>
            </div>
        </div>
    </div>
    
    <!-- Shortcuts Help Modal -->
    <div class="modal-overlay" id="shortcuts-modal" role="dialog" aria-labelledby="shortcuts-modal-title" aria-modal="true">
        <div class="modal-content shortcuts-modal">
            <div class="modal-header">
                <h3 class="modal-title" id="shortcuts-modal-title">âŒ¨ï¸ Keyboard Shortcuts</h3>
                <button class="modal-close" onclick="closeShortcutsModal()" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="shortcuts-grid">
                    <div class="shortcut-group">
                        <h4>Navigation</h4>
                        <div class="shortcut"><kbd>j</kbd> / <kbd>k</kbd> <span>Next / Prev article</span></div>
                        <div class="shortcut"><kbd>o</kbd> <span>Open article</span></div>
                        <div class="shortcut"><kbd>/</kbd> <span>Focus search</span></div>
                    </div>
                    <div class="shortcut-group">
                        <h4>Filters</h4>
                        <div class="shortcut"><kbd>t</kbd> <span>Today only</span></div>
                        <div class="shortcut"><kbd>h</kbd> <span>High priority+</span></div>
                        <div class="shortcut"><kbd>Esc</kbd> <span>Clear filters</span></div>
                    </div>
                    <div class="shortcut-group">
                        <h4>Actions</h4>
                        <div class="shortcut"><kbd>p</kbd> <span>Export PDF</span></div>
                        <div class="shortcut"><kbd>r</kbd> <span>Reading List</span></div>
                        <div class="shortcut"><kbd>?</kbd> <span>This help</span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>
    
    <script>
        // ========================================
        // STATE MANAGEMENT
        // ========================================
        const CONFIG = {
            dataUrl: 'data/public_data.json',
            initialUrl: 'data/initial.json',
            pageSize: 25,
        };
        
        const state = {
            allArticles: [],
            filteredArticles: [],
            storyClusters: [],
            currentPage: 1,
            totalPages: 1,
            filters: {
                time: 'all',
                priority: 'all',
                category: null,
                domain: null,
                subcategory: null,
                search: '',
            },
            lastVisit: null,
            focusedArticleIndex: -1,
            isFullyLoaded: false,
            sourcesInspected: 0,
        };
        
        // Expose state globally for enhancement modules
        window.state = state;
        
        // ========================================
        // INITIALIZATION
        // ========================================
        document.addEventListener('DOMContentLoaded', async () => {
            initTheme();
            initReadingList();
            loadFiltersFromURL();
            checkNewArticles();
            await loadDataProgressively();
            setupKeyboardShortcuts();
        });
        
        // ========================================
        // PROGRESSIVE DATA LOADING
        // ========================================
        async function loadDataProgressively() {
            try {
                // Try to load initial data first (faster)
                try {
                    const initialResponse = await fetch(CONFIG.initialUrl);
                    if (initialResponse.ok) {
                        const initial = await initialResponse.json();
                        
                        // Render initial data immediately
                        if (initial.stats) {
                            updateStatsFromData(initial.stats);
                        }
                        if (initial.top_articles) {
                            state.allArticles = initial.top_articles;
                            applyFiltersAndRender();
                        }
                        
                        updateLastUpdated(initial.last_updated);
                    }
                } catch (e) {
                    console.log('Initial data not available, loading full data...');
                }
                
                // Load full dataset
                const response = await fetch(CONFIG.dataUrl);
                if (!response.ok) throw new Error('Failed to load data');
                
                const data = await response.json();
                
                state.allArticles = data.articles || [];
                state.storyClusters = data.story_clusters || [];
                state.isFullyLoaded = true;
                if (data.sources_inspected) {
                    state.sourcesInspected = data.sources_inspected;
                }
                
                updateStats();
                renderStoryClusters();
                renderTopCategoryBar();
                applyFiltersAndRender();
                updateLastUpdated(data.last_updated);
                
                // Mark articles as new since last visit
                markNewArticles();
                
                // Show fully loaded indicator
                showFullyLoadedIndicator();
                
            } catch (error) {
                console.error('Error loading data:', error);
                showError('Failed to load data. Please refresh the page.');
            }
        }
        
        function showFullyLoadedIndicator() {
            const indicator = document.createElement('span');
            indicator.className = 'loaded-indicator';
            indicator.textContent = ' âœ“ All data loaded';
            document.querySelector('.filter-summary')?.appendChild(indicator);
        }
        
        // ========================================
        // NEW ARTICLES TRACKING
        // ========================================
        function checkNewArticles() {
            state.lastVisit = localStorage.getItem('policyradar_last_visit');
            localStorage.setItem('policyradar_last_visit', new Date().toISOString());
        }
        
        function markNewArticles() {
            if (!state.lastVisit) return;
            
            const lastVisitDate = new Date(state.lastVisit);
            let newCount = 0;
            
            state.allArticles.forEach(article => {
                if (article.publication_date) {
                    const articleDate = new Date(article.publication_date);
                    article.isNew = articleDate > lastVisitDate;
                    if (article.isNew) newCount++;
                }
            });
            
            if (newCount > 0) {
                showNewArticlesBanner(newCount);
            }
        }
        
        function showNewArticlesBanner(count) {
            const existing = document.querySelector('.new-articles-banner');
            if (existing) return;
            
            const banner = document.createElement('div');
            banner.className = 'new-articles-banner';
            banner.innerHTML = `
                <span>âœ¨ ${count} new article${count > 1 ? 's' : ''} since your last visit</span>
                <button onclick="filterNewArticles()">Show new only</button>
                <button class="close-banner" onclick="this.parentElement.remove()">Ã—</button>
            `;
            
            const filterContent = document.querySelector('.filter-content');
            filterContent.insertBefore(banner, filterContent.firstChild);
        }
        
        function filterNewArticles() {
            state.filters.newOnly = true;
            state.currentPage = 1;
            applyFiltersAndRender();
            document.querySelector('.new-articles-banner')?.remove();
        }
        
        // ========================================
        // URL-BASED FILTER PERSISTENCE
        // ========================================
        function loadFiltersFromURL() {
            const params = new URLSearchParams(window.location.search);
            
            if (params.has('time')) {
                state.filters.time = params.get('time');
                updateFilterButtonState('time', state.filters.time);
            }
            if (params.has('priority')) {
                state.filters.priority = params.get('priority');
                updateFilterButtonState('priority', state.filters.priority);
            }
            if (params.has('category')) {
                state.filters.category = params.get('category');
            }
            if (params.has('q')) {
                state.filters.search = params.get('q');
                document.getElementById('search-input').value = state.filters.search;
                document.getElementById('clear-search-btn').classList.remove('hidden');
                document.getElementById('search-kbd').style.display = 'none';
            }
        }
        
        function updateURLParams() {
            const params = new URLSearchParams();
            
            if (state.filters.time !== 'all') params.set('time', state.filters.time);
            if (state.filters.priority !== 'all') params.set('priority', state.filters.priority);
            if (state.filters.category) params.set('category', state.filters.category);
            if (state.filters.search) params.set('q', state.filters.search);
            
            const newURL = params.toString() 
                ? `${window.location.pathname}?${params}` 
                : window.location.pathname;
            
            window.history.replaceState({}, '', newURL);
        }
        
        function updateFilterButtonState(type, value) {
            document.querySelectorAll(`.filter-btn[data-${type}]`).forEach(btn => {
                const isActive = btn.dataset[type] === value;
                btn.classList.toggle('active', isActive);
                btn.setAttribute('aria-checked', isActive);
            });
        }
        
        // ========================================
        // FILTERING
        // ========================================
        function applyFiltersAndRender() {
            let articles = [...state.allArticles];
            
            // Time filter
            if (state.filters.time !== 'all') {
                const now = new Date();
                const cutoff = new Date();
                if (state.filters.time === 'today') {
                    cutoff.setHours(0, 0, 0, 0);
                } else if (state.filters.time === 'week') {
                    cutoff.setDate(now.getDate() - 7);
                }
                articles = articles.filter(a => new Date(a.publication_date) >= cutoff);
            }
            
            // Priority filter
            if (state.filters.priority !== 'all') {
                if (state.filters.priority === 'critical') {
                    articles = articles.filter(a => a.priority_class === 'critical');
                } else if (state.filters.priority === 'high') {
                    articles = articles.filter(a => 
                        a.priority_class === 'critical' || a.priority_class === 'high'
                    );
                }
            }
            
            // Category filter
            if (state.filters.category) {
                articles = articles.filter(a => a.category === state.filters.category);
            }
            
            // Domain filter (filters by category groups)
            if (state.filters.domain && DOMAIN_CATEGORIES[state.filters.domain]) {
                const domainCategories = DOMAIN_CATEGORIES[state.filters.domain];
                articles = articles.filter(a => domainCategories.includes(a.category));
            }
            
            // Subcategory filter (filters by specific category)
            if (currentSelectedCategory) {
                articles = articles.filter(a => a.category === currentSelectedCategory);
            }

            // Source type filter
            if (state.filters.sourceType) {
                articles = articles.filter(a => a.source_type === state.filters.sourceType);
            }

            // Source name filter (specific publication)
            if (state.filters.sourceName) {
                articles = articles.filter(a => a.source_name === state.filters.sourceName);
            }

            // Search filter
            if (state.filters.search) {
                articles = searchArticles(articles, state.filters.search);
            }
            
            // New only filter
            if (state.filters.newOnly) {
                articles = articles.filter(a => a.isNew);
            }
            
            state.filteredArticles = articles;
            state.totalPages = Math.ceil(articles.length / CONFIG.pageSize);
            state.currentPage = Math.min(state.currentPage, Math.max(1, state.totalPages));
            
            renderArticles();
            renderPagination();
            updateFilterCount();
            updateURLParams();
            
            // Announce to screen readers
            announce(`Showing ${articles.length} articles`);
        }
        
        function searchArticles(articles, query) {
            if (!query) return articles;
            const terms = query.toLowerCase().split(/\s+/).filter(t => t.length > 0);
            return articles.filter(article => {
                const searchText = `${article.title || ''} ${article.summary || ''} ${article.source_name || ''} ${article.category || ''}`.toLowerCase();
                return terms.every(term => searchText.includes(term));
            });
        }
        
        function setTimeFilter(value, element) {
            document.querySelectorAll('.filter-btn[data-time]').forEach(btn => {
                btn.classList.remove('active');
                btn.setAttribute('aria-checked', 'false');
            });
            element.classList.add('active');
            element.setAttribute('aria-checked', 'true');
            state.filters.time = value;
            state.currentPage = 1;
            applyFiltersAndRender();
        }
        
        function setPriorityFilter(value, element) {
            document.querySelectorAll('.filter-btn[data-priority]').forEach(btn => {
                btn.classList.remove('active');
                btn.setAttribute('aria-checked', 'false');
            });
            element.classList.add('active');
            element.setAttribute('aria-checked', 'true');
            state.filters.priority = value;
            state.currentPage = 1;
            applyFiltersAndRender();
        }
        
        let searchTimeout = null;
        function handleSearch(query) {
            clearTimeout(searchTimeout);
            
            const clearBtn = document.getElementById('clear-search-btn');
            const kbd = document.getElementById('search-kbd');
            
            if (query.length > 0) {
                clearBtn.classList.remove('hidden');
                kbd.style.display = 'none';
            } else {
                clearBtn.classList.add('hidden');
                kbd.style.display = 'block';
            }
            
            searchTimeout = setTimeout(() => {
                state.filters.search = query.toLowerCase().trim();
                state.currentPage = 1;
                applyFiltersAndRender();
            }, 200);
        }
        
        function clearSearch() {
            const input = document.getElementById('search-input');
            input.value = '';
            document.getElementById('clear-search-btn').classList.add('hidden');
            document.getElementById('search-kbd').style.display = 'block';
            state.filters.search = '';
            state.currentPage = 1;
            applyFiltersAndRender();
        }
        
        function resetFilters() {
            state.filters = {
                time: 'all',
                priority: 'all',
                category: null,
                domain: null,
                subcategory: null,
                sourceType: null,
                sourceName: null,
                search: '',
                newOnly: false,
            };
            currentSelectedCategory = null;
            state.currentPage = 1;
            state.focusedArticleIndex = -1;

            // Reset UI
            document.querySelectorAll('.filter-btn[data-time]').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.time === 'all');
            });
            document.querySelectorAll('.filter-btn[data-priority]').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.priority === 'all');
            });
            // Reset domain pills
            document.querySelectorAll('.domain-pill').forEach(pill => {
                pill.classList.toggle('active', !pill.dataset.domain);
            });
            // Reset source type pills
            document.querySelectorAll('.source-type-pill').forEach(pill => {
                pill.classList.toggle('active', !pill.dataset.sourceType);
            });
            // Hide subsector row
            const subsectorRow = document.getElementById('subsector-row');
            if (subsectorRow) subsectorRow.style.display = 'none';
            // Hide source name row
            const sourceNameRow = document.getElementById('source-name-row');
            if (sourceNameRow) sourceNameRow.style.display = 'none';

            document.getElementById('search-input').value = '';
            document.getElementById('clear-search-btn').classList.add('hidden');
            document.getElementById('search-kbd').style.display = 'block';
            document.querySelector('.new-articles-banner')?.remove();

            applyFiltersAndRender();
        }

        function setSourceTypeFilter(sourceType, element) {
            // Update UI
            document.querySelectorAll('.source-type-pill').forEach(pill => {
                pill.classList.remove('active');
            });
            element.classList.add('active');

            // Update state
            state.filters.sourceType = sourceType || null;
            state.filters.sourceName = null; // Reset source name when type changes
            state.currentPage = 1;

            // Show/hide source name filter row
            const sourceNameRow = document.getElementById('source-name-row');
            if (sourceType) {
                // Populate source names for this type
                populateSourceNames(sourceType);
                sourceNameRow.style.display = 'flex';
            } else {
                sourceNameRow.style.display = 'none';
            }

            applyFiltersAndRender();
        }

        function populateSourceNames(sourceType) {
            const container = document.getElementById('source-name-pills');
            if (!container) return;

            // Get unique sources of this type with counts
            const sourceCounts = {};
            state.allArticles.forEach(article => {
                if (article.source_type === sourceType) {
                    const name = article.source_name;
                    sourceCounts[name] = (sourceCounts[name] || 0) + 1;
                }
            });

            // Sort by count descending
            const sortedSources = Object.entries(sourceCounts)
                .sort((a, b) => b[1] - a[1]);

            // Generate pills
            let html = `<button class="source-name-pill active" data-source-name="" onclick="setSourceNameFilter('', this)">All</button>`;
            sortedSources.forEach(([name, count]) => {
                // Shorten long names
                const displayName = name.length > 25 ? name.substring(0, 22) + '...' : name;
                html += `<button class="source-name-pill" data-source-name="${name}" onclick="setSourceNameFilter('${name.replace(/'/g, "\\'")}', this)" title="${name}">${displayName} <span class="source-count">(${count})</span></button>`;
            });

            container.innerHTML = html;
        }

        function setSourceNameFilter(sourceName, element) {
            // Update UI
            document.querySelectorAll('.source-name-pill').forEach(pill => {
                pill.classList.remove('active');
            });
            element.classList.add('active');

            // Update state
            state.filters.sourceName = sourceName || null;
            state.currentPage = 1;
            applyFiltersAndRender();
        }
        
        function updateFilterCount() {
            const count = state.filteredArticles.length;
            const total = state.allArticles.length;
            
            const countEl = document.getElementById('filter-count');
            const showingEl = document.getElementById('articles-showing');
            const clearAllBtn = document.getElementById('clear-all-filters');
            
            const text = count === total 
                ? `${count} articles` 
                : `${count} of ${total} articles`;
            
            countEl.textContent = text;
            showingEl.textContent = text;
            
            // Show clear all button if any filter is active
            const hasActiveFilters =
                state.filters.time !== 'all' ||
                state.filters.priority !== 'all' ||
                state.filters.category ||
                state.filters.sourceType ||
                state.filters.sourceName ||
                state.filters.search ||
                state.filters.newOnly;

            clearAllBtn.style.display = hasActiveFilters ? 'block' : 'none';

            // Update mobile badge
            const activeCount = [
                state.filters.time !== 'all',
                state.filters.priority !== 'all',
                state.filters.category,
                state.filters.sourceType,
                state.filters.sourceName,
                state.filters.search,
            ].filter(Boolean).length;
            
            const mobileBadge = document.getElementById('active-filter-count');
            if (activeCount > 0) {
                mobileBadge.textContent = activeCount;
                mobileBadge.style.display = 'block';
            } else {
                mobileBadge.style.display = 'none';
            }
        }
        
        // ========================================
        // RENDERING
        // ========================================
        function renderArticles() {
            const container = document.getElementById('articles-grid');
            const articles = state.filteredArticles;
            
            // Remove loading skeleton
            document.getElementById('loading-skeleton')?.remove();
            container.setAttribute('aria-busy', 'false');
            
            if (articles.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ðŸ“­</div>
                        <h3 class="empty-state-title">No articles match your filters</h3>
                        <p class="empty-state-description">
                            Try adjusting your search terms or removing some filters to see more results.
                        </p>
                        <div class="empty-state-actions">
                            <button class="btn btn-primary" onclick="resetFilters()">Clear all filters</button>
                        </div>
                    </div>
                `;
                return;
            }
            
            // Paginate
            const start = (state.currentPage - 1) * CONFIG.pageSize;
            const end = start + CONFIG.pageSize;
            const pageArticles = articles.slice(start, end);
            
            container.innerHTML = pageArticles.map((article, index) => {
                const globalIndex = start + index;
                return renderArticleCard(article, globalIndex);
            }).join('');
            
            // Update bookmark button states
            updateBookmarkButtons();
        }
        
        function renderArticleCard(article, index) {
            const priorityClass = article.priority_class || 'medium';
            const priorityLabel = priorityClass === 'critical' ? 'Critical' : 
                                  priorityClass === 'high' ? 'High' : '';
            const isNew = article.isNew ? 'new' : '';
            
            return `
                <article class="article-card ${priorityClass} ${isNew}" 
                         data-index="${index}"
                         tabindex="0"
                         aria-labelledby="article-title-${index}">
                    <div class="article-header">
                        <div class="article-meta">
                            <a href="${escapeHtml(article.url)}" 
                               class="article-source" 
                               target="_blank" 
                               rel="noopener">
                                ${escapeHtml(article.source_name || 'Unknown')}
                            </a>
                            <span class="article-separator">â€¢</span>
                            <time class="article-date" datetime="${article.publication_date}">
                                ${formatDate(article.publication_date)}
                            </time>
                        </div>
                        ${priorityLabel ? `
                            <span class="article-priority" aria-label="${priorityLabel} priority">
                                ${priorityLabel}
                            </span>
                        ` : ''}
                    </div>
                    
                    <h3 class="article-title" id="article-title-${index}">
                        <a href="${escapeHtml(article.url)}" target="_blank" rel="noopener">
                            ${escapeHtml(article.title)}
                        </a>
                    </h3>
                    
                    ${article.summary ? `
                        <p class="article-summary">${escapeHtml(truncate(article.summary, 200))}</p>
                    ` : ''}
                    
                    <div class="article-footer">
                        <span class="article-category">${escapeHtml(article.category || 'Policy News')}</span>
                        <div class="article-actions">
                            <button class="article-action bookmark-btn" 
                                    onclick="toggleReadingList(event, '${escapeHtml(article.url)}', '${escapeHtml(article.title)}', '${escapeHtml(article.source_name || '')}')"
                                    aria-label="Save to reading list"
                                    title="Save to reading list"
                                    data-url="${escapeHtml(article.url)}">
                                ðŸ“‘
                            </button>
                            <button class="article-action" 
                                    onclick="shareArticle(event, '${escapeHtml(article.url)}', '${escapeHtml(article.title)}')"
                                    aria-label="Share article"
                                    title="Share">
                                ðŸ“¤
                            </button>
                        </div>
                    </div>
                </article>
            `;
        }
        
        function estimateReadTime(text) {
            if (!text) return 1;
            const words = text.split(/\s+/).length;
            return Math.max(1, Math.ceil(words / 200));
        }
        
        function renderPagination() {
            const container = document.getElementById('pagination');
            if (state.totalPages <= 1) {
                container.innerHTML = '';
                return;
            }
            
            let html = `
                <button class="pagination-btn" 
                        onclick="goToPage(${state.currentPage - 1})" 
                        ${state.currentPage === 1 ? 'disabled' : ''}
                        aria-label="Previous page">
                    â† Prev
                </button>
            `;
            
            const maxVisible = 5;
            let startPage = Math.max(1, state.currentPage - Math.floor(maxVisible / 2));
            let endPage = Math.min(state.totalPages, startPage + maxVisible - 1);
            if (endPage - startPage < maxVisible - 1) {
                startPage = Math.max(1, endPage - maxVisible + 1);
            }
            
            if (startPage > 1) {
                html += `<button class="pagination-btn" onclick="goToPage(1)">1</button>`;
                if (startPage > 2) html += `<span class="pagination-info">...</span>`;
            }
            
            for (let i = startPage; i <= endPage; i++) {
                html += `
                    <button class="pagination-btn ${i === state.currentPage ? 'active' : ''}" 
                            onclick="goToPage(${i})"
                            ${i === state.currentPage ? 'aria-current="page"' : ''}>
                        ${i}
                    </button>
                `;
            }
            
            if (endPage < state.totalPages) {
                if (endPage < state.totalPages - 1) html += `<span class="pagination-info">...</span>`;
                html += `<button class="pagination-btn" onclick="goToPage(${state.totalPages})">${state.totalPages}</button>`;
            }
            
            html += `
                <button class="pagination-btn" 
                        onclick="goToPage(${state.currentPage + 1})" 
                        ${state.currentPage === state.totalPages ? 'disabled' : ''}
                        aria-label="Next page">
                    Next â†’
                </button>
            `;
            
            container.innerHTML = html;
        }
        
        function goToPage(page) {
            if (page < 1 || page > state.totalPages) return;
            state.currentPage = page;
            state.focusedArticleIndex = -1;
            renderArticles();
            renderPagination();
            document.querySelector('.articles-section').scrollIntoView({ behavior: 'smooth' });
        }
        
        // 5 Main Domains mapped to article categories
        const DOMAIN_CATEGORIES = {
            'economy': ['Finance', 'Trade'],
            'technology': ['Telecom', 'Data Privacy', 'Fintech', 'DeepTech'],
            'infrastructure': ['Infrastructure', 'Energy', 'Environment', 'Urban'],
            'social': ['Health', 'Education', 'Welfare', 'Agriculture', 'Labour'],
            'governance': ['Governance', 'Legal', 'Foreign', 'Defence', 'Politics']
        };

        // Category-based subcategories (matches article.category field)
        const SUBCATEGORIES = {
            'economy': ['Finance', 'Trade'],
            'technology': ['Telecom', 'Data Privacy', 'Fintech', 'DeepTech'],
            'infrastructure': ['Infrastructure', 'Energy', 'Environment', 'Urban'],
            'social': ['Health', 'Education', 'Welfare', 'Agriculture', 'Labour'],
            'governance': ['Governance', 'Legal', 'Foreign', 'Defence', 'Politics']
        };
        
        // Store current selected category for filtering
        let currentSelectedCategory = null;

        function renderTopCategoryBar() {
            // No longer renders category bar - domains handle filtering
            renderTicker();
        }

        function setDomainFilter(domain, element) {
            // Update domain pill states
            document.querySelectorAll('.domain-pill').forEach(el => {
                el.classList.remove('active');
            });
            element.classList.add('active');

            // Store selected domain
            state.filters.domain = domain || null;
            state.filters.category = null;
            state.filters.subcategory = null;
            currentSelectedCategory = null;

            // Show/hide subsector row
            const subsectorRow = document.getElementById('subsector-row');
            const subsectorPills = document.getElementById('subsector-pills');

            if (domain && SUBCATEGORIES[domain]) {
                const categories = SUBCATEGORIES[domain];

                // Count articles per category
                const counts = {};
                categories.forEach(cat => {
                    counts[cat] = state.allArticles.filter(a => a.category === cat).length;
                });

                subsectorPills.innerHTML = `
                    <button class="subsector-pill active" data-category="" onclick="selectSubcategory('', this)">
                        All
                    </button>
                    ${categories.map(cat => `
                        <button class="subsector-pill" data-category="${escapeHtml(cat)}" onclick="selectSubcategory('${escapeHtml(cat)}', this)">
                            ${escapeHtml(cat)} <span style="opacity: 0.7">(${counts[cat] || 0})</span>
                        </button>
                    `).join('')}
                `;
                subsectorRow.style.display = 'flex';
            } else {
                subsectorRow.style.display = 'none';
            }

            state.currentPage = 1;
            applyFiltersAndRender();
        }
        
        function selectSubcategory(category, element) {
            // Update subsector pill states
            document.querySelectorAll('.subsector-pill').forEach(el => {
                el.classList.remove('active');
            });
            element.classList.add('active');

            if (!category || !state.filters.domain) {
                // "All" selected
                state.filters.subcategory = null;
                currentSelectedCategory = null;
            } else {
                // Filter by specific category
                state.filters.subcategory = category;
                currentSelectedCategory = category;
            }

            state.currentPage = 1;
            applyFiltersAndRender();
        }
        
        // Legacy function for backwards compatibility
        function filterByCategory(element) {
            const category = element?.dataset?.category || '';
            state.filters.category = category || null;
            state.currentPage = 1;
            applyFiltersAndRender();
        }
        
        // Top Stories Ticker
        function renderTicker() {
            const bar = document.getElementById('ticker-bar');
            const track = document.getElementById('ticker-track');
            
            // Get breaking/high-impact articles
            const breakingArticles = state.allArticles.filter(a => 
                a.is_breaking || a.is_high_impact || a.priority_class === 'critical'
            ).slice(0, 10);
            
            if (breakingArticles.length < 3) {
                bar.style.display = 'none';
                return;
            }
            
            bar.style.display = 'block';
            
            // Duplicate for seamless loop
            const items = [...breakingArticles, ...breakingArticles];
            track.innerHTML = items.map(article => `
                <a class="ticker-item" href="${escapeHtml(article.url)}" target="_blank" rel="noopener">
                    <span class="ticker-dot"></span>
                    <span>${escapeHtml((article.title || '').substring(0, 70))}${(article.title || '').length > 70 ? '...' : ''}</span>
                    <span class="ticker-source">${escapeHtml(article.source_name || '')}</span>
                </a>
            `).join('');
            
            // Set animation duration based on content
            const duration = Math.max(35, breakingArticles.length * 5);
            track.style.setProperty('--ticker-duration', `${duration}s`);
        }
        
        function renderStoryClusters() {
            const container = document.getElementById('story-clusters-list');
            const clusters = state.storyClusters;
            
            if (!clusters || clusters.length === 0) {
                container.innerHTML = '<p style="color: var(--text-muted); font-size: 0.8125rem;">No multi-source stories detected today</p>';
                return;
            }
            
            container.innerHTML = clusters.slice(0, 8).map((cluster, index) => {
                const headline = cluster.headline || 'Untitled Story';
                const sourceCount = cluster.source_count || cluster.perspectives?.length || 0;
                const entities = (cluster.key_entities || []).slice(0, 3);
                const perspectives = cluster.perspectives || [];
                
                const entitiesHtml = entities.length > 0 
                    ? `<div class="story-cluster-entities">${entities.map(e => `<span>${escapeHtml(e)}</span>`).join('')}</div>`
                    : '';
                
                const perspectivesHtml = perspectives.slice(0, 5).map(p => `
                    <div class="perspective-item">
                        <div class="perspective-source">${escapeHtml(p.source || 'Unknown')}</div>
                        <a href="${escapeHtml(p.url || '#')}" target="_blank" rel="noopener" class="perspective-title">
                            ${escapeHtml(p.title || 'Untitled')}
                        </a>
                        ${p.unique_angle ? `<div class="perspective-unique">ðŸ’¡ ${escapeHtml(p.unique_angle)}</div>` : ''}
                    </div>
                `).join('');
                
                return `
                    <div class="story-cluster" data-index="${index}">
                        <div class="story-cluster-header" onclick="toggleStoryCluster(${index})">
                            <div class="story-cluster-headline">${escapeHtml(headline)}</div>
                            <div class="story-cluster-meta">
                                <span class="story-cluster-badge">${sourceCount} sources</span>
                                ${entitiesHtml}
                                <span class="story-cluster-expand">â–¼</span>
                            </div>
                        </div>
                        <div class="story-cluster-perspectives">
                            <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.75rem;">
                                Coverage from different sources:
                            </div>
                            ${perspectivesHtml}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function toggleStoryCluster(index) {
            const cluster = document.querySelector(`.story-cluster[data-index="${index}"]`);
            if (cluster) {
                cluster.classList.toggle('expanded');
            }
        }
        
        function updateStats() {
            const articles = state.allArticles;
            const critical = articles.filter(a => a.priority_class === 'critical').length;
            const high = articles.filter(a => a.priority_class === 'high').length;
            const sourcesCited = new Set(articles.map(a => a.source_name)).size;
            
            document.getElementById('stat-total').textContent = articles.length.toLocaleString();
            document.getElementById('stat-critical').textContent = critical.toLocaleString();
            document.getElementById('stat-high').textContent = high.toLocaleString();
            document.getElementById('stat-sources-cited').textContent = sourcesCited.toLocaleString();
            const sourcesMonitored = state.sourcesInspected || sourcesCited;
            document.getElementById('stat-sources-monitored').textContent = sourcesMonitored.toLocaleString();
            
            // Calculate trend (compare with yesterday)
            updateStatsTrend(articles.length);
        }
        
        function updateStatsFromData(stats) {
            document.getElementById('stat-total').textContent = (stats.total || 0).toLocaleString();
            document.getElementById('stat-critical').textContent = (stats.critical || 0).toLocaleString();
            document.getElementById('stat-high').textContent = (stats.high || 0).toLocaleString();
            const sourcesCited = stats.sources_cited || stats.sources || 0;
            const sourcesInspected = stats.sources_inspected || sourcesCited;
            document.getElementById('stat-sources-cited').textContent = sourcesCited.toLocaleString();
            document.getElementById('stat-sources-monitored').textContent = sourcesInspected.toLocaleString();
            state.sourcesInspected = sourcesInspected;
        }
        
        function updateStatsTrend(currentTotal) {
            const stored = JSON.parse(localStorage.getItem('policyradar_stats') || '{}');
            const today = new Date().toISOString().split('T')[0];
            const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];
            
            const yesterdayTotal = stored[yesterday]?.total || currentTotal;
            const diff = ((currentTotal - yesterdayTotal) / yesterdayTotal * 100).toFixed(0);
            
            const trendEl = document.getElementById('stat-total-trend');
            if (diff > 0) {
                trendEl.className = 'stat-trend up';
                trendEl.textContent = `â†‘ ${diff}% vs yesterday`;
            } else if (diff < 0) {
                trendEl.className = 'stat-trend down';
                trendEl.textContent = `â†“ ${Math.abs(diff)}% vs yesterday`;
            } else {
                trendEl.textContent = '';
            }
            
            // Store today's stats
            stored[today] = { total: currentTotal };
            localStorage.setItem('policyradar_stats', JSON.stringify(stored));
        }
        
        function updateLastUpdated(timestamp) {
            if (!timestamp) return;
            const date = new Date(timestamp);
            const now = new Date();
            const diffMs = now - date;
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            const diffMins = Math.floor(diffMs / (1000 * 60));
            
            let text;
            if (diffMins < 60) {
                text = `Updated ${diffMins}m ago`;
            } else if (diffHours < 24) {
                text = `Updated ${diffHours}h ago`;
            } else {
                text = `Updated ${date.toLocaleDateString('en-IN', { month: 'short', day: 'numeric' })}`;
            }
            
            document.getElementById('last-updated').textContent = text;
        }
        
        // ========================================
        // KEYBOARD SHORTCUTS
        // ========================================
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', handleKeydown);
        }
        
        function handleKeydown(e) {
            // Don't trigger when typing in input
            if (['INPUT', 'TEXTAREA', 'SELECT'].includes(e.target.tagName)) {
                if (e.key === 'Escape') {
                    e.target.blur();
                }
                return;
            }
            
            switch (e.key) {
                case '/':
                    e.preventDefault();
                    document.getElementById('search-input').focus();
                    break;
                case 'j':
                    e.preventDefault();
                    navigateArticles(1);
                    break;
                case 'k':
                    e.preventDefault();
                    navigateArticles(-1);
                    break;
                case 'o':
                case 'Enter':
                    if (state.focusedArticleIndex >= 0) {
                        e.preventDefault();
                        openFocusedArticle();
                    }
                    break;
                case 't':
                    e.preventDefault();
                    const todayBtn = document.querySelector('.filter-btn[data-time="today"]');
                    if (todayBtn) setTimeFilter('today', todayBtn);
                    break;
                case 'h':
                    e.preventDefault();
                    const highBtn = document.querySelector('.filter-btn[data-priority="high"]');
                    if (highBtn) setPriorityFilter('high', highBtn);
                    break;
                case 'p':
                    e.preventDefault();
                    showPdfModal();
                    break;
                case 'r':
                    e.preventDefault();
                    showReadingListModal();
                    break;
                case 'n':
                    e.preventDefault();
                    showNewsletterExportModal();
                    break;
                case '?':
                    e.preventDefault();
                    showShortcutsHelp();
                    break;
                case 'Escape':
                    e.preventDefault();
                    if (document.querySelector('.modal-overlay.visible')) {
                        closeAllModals();
                    } else {
                        resetFilters();
                    }
                    break;
            }
        }
        
        function navigateArticles(direction) {
            const articles = document.querySelectorAll('.article-card');
            if (articles.length === 0) return;
            
            // Remove current focus
            articles.forEach(a => a.classList.remove('keyboard-focus'));
            
            // Calculate new index
            state.focusedArticleIndex = Math.max(0, Math.min(
                articles.length - 1,
                state.focusedArticleIndex + direction
            ));
            
            // Apply focus
            const article = articles[state.focusedArticleIndex];
            article.classList.add('keyboard-focus');
            article.scrollIntoView({ behavior: 'smooth', block: 'center' });
            article.focus();
            
            announce(`Article ${state.focusedArticleIndex + 1} of ${articles.length}`);
        }
        
        function openFocusedArticle() {
            const article = document.querySelector('.article-card.keyboard-focus');
            if (article) {
                const link = article.querySelector('.article-title a');
                if (link) window.open(link.href, '_blank');
            }
        }
        
        // ========================================
        // MODALS
        // ========================================
        function showPdfModal() {
            document.getElementById('pdf-article-count').textContent = state.filteredArticles.length;
            document.getElementById('pdf-modal').classList.add('visible');
            document.getElementById('pdf-modal').querySelector('.modal-close').focus();
        }
        
        function closePdfModal() {
            document.getElementById('pdf-modal').classList.remove('visible');
        }
        
        function showShortcutsHelp() {
            document.getElementById('shortcuts-modal').classList.add('visible');
            document.getElementById('shortcuts-modal').querySelector('.modal-close').focus();
        }
        
        function closeShortcutsModal() {
            document.getElementById('shortcuts-modal').classList.remove('visible');
        }
        
        function closeAllModals() {
            document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('visible'));
        }
        
        // ========================================
        // READING LIST MODAL
        // ========================================
        function showReadingListModal() {
            // Remove existing modal if present
            document.getElementById('reading-list-modal')?.remove();
            
            const items = Array.from(readingList.entries());
            
            const modal = document.createElement('div');
            modal.id = 'reading-list-modal';
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal" role="dialog" aria-modal="true" aria-labelledby="reading-list-title">
                    <div class="modal-header">
                        <h2 id="reading-list-title">ðŸ”– Reading List (${items.length})</h2>
                        <button class="modal-close" onclick="document.getElementById('reading-list-modal').remove()" aria-label="Close">Ã—</button>
                    </div>
                    <div class="modal-body">
                        ${items.length === 0 ? `
                            <p style="color: var(--text-muted); text-align: center; padding: 2rem 0;">
                                Your reading list is empty.<br>
                                Click ðŸ“‘ on any article to save it for later.
                            </p>
                        ` : `
                            <div style="display: flex; flex-direction: column; gap: 0.75rem; max-height: 400px; overflow-y: auto;">
                                ${items.map(([url, data]) => `
                                    <div style="display: flex; gap: 0.75rem; padding: 0.75rem; background: var(--bg-secondary); border-radius: 8px;">
                                        <div style="flex: 1; min-width: 0;">
                                            <a href="${escapeHtml(url)}" target="_blank" rel="noopener" 
                                               style="font-weight: 500; color: var(--text-primary); text-decoration: none; display: block; margin-bottom: 0.25rem;">
                                                ${escapeHtml(data.title || 'Untitled')}
                                            </a>
                                            <div style="font-size: 0.75rem; color: var(--text-muted);">
                                                ${escapeHtml(data.source || '')} â€¢ Saved ${formatDate(data.savedAt)}
                                            </div>
                                        </div>
                                        <button onclick="removeFromReadingList('${escapeHtml(url)}')" 
                                                style="background: none; border: none; cursor: pointer; color: var(--text-muted); padding: 0.25rem;"
                                                title="Remove from reading list">
                                            âœ•
                                        </button>
                                    </div>
                                `).join('')}
                            </div>
                            <div style="margin-top: 1rem; display: flex; gap: 0.5rem;">
                                <button class="btn btn-secondary" onclick="clearReadingList()">Clear All</button>
                            </div>
                        `}
                    </div>
                </div>
            `;
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
            
            document.body.appendChild(modal);
            modal.classList.add('visible');
        }
        
        function removeFromReadingList(url) {
            readingList.delete(url);
            saveReadingList();
            updateBookmarkButtons();
            showReadingListModal(); // Refresh modal
        }
        
        function clearReadingList() {
            if (confirm('Clear all items from your reading list?')) {
                readingList.clear();
                saveReadingList();
                updateBookmarkButtons();
                showReadingListModal(); // Refresh modal
                showToast('Reading list cleared');
            }
        }
        
        // ========================================
        // NEWSLETTER EXPORT MODAL
        // ========================================
        function showNewsletterExportModal() {
            // Remove existing modal if present
            document.getElementById('newsletter-modal')?.remove();
            
            const articles = state.filteredArticles.slice(0, 25);
            
            const modal = document.createElement('div');
            modal.id = 'newsletter-modal';
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal" role="dialog" aria-modal="true" aria-labelledby="newsletter-title" style="max-width: 700px;">
                    <div class="modal-header">
                        <h2 id="newsletter-title">ðŸ“° Export for Newsletter</h2>
                        <button class="modal-close" onclick="document.getElementById('newsletter-modal').remove()" aria-label="Close">Ã—</button>
                    </div>
                    <div class="modal-body">
                        <p style="color: var(--text-muted); margin-bottom: 1rem;">
                            Export the top ${articles.length} articles for use with Claude or other AI tools to generate your newsletter.
                        </p>
                        
                        <div style="margin-bottom: 1rem;">
                            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                <input type="radio" name="export-format" value="markdown" checked>
                                <span>Markdown (recommended for Claude)</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; margin-top: 0.5rem;">
                                <input type="radio" name="export-format" value="plain">
                                <span>Plain Text</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; margin-top: 0.5rem;">
                                <input type="radio" name="export-format" value="json">
                                <span>JSON (for programmatic use)</span>
                            </label>
                        </div>
                        
                        <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                            <button class="btn btn-primary" onclick="copyNewsletterExport()">
                                ðŸ“‹ Copy to Clipboard
                            </button>
                            <button class="btn btn-secondary" onclick="downloadNewsletterExport()">
                                ðŸ’¾ Download File
                            </button>
                        </div>
                        
                        <details>
                            <summary style="cursor: pointer; color: var(--accent-primary);">Preview export</summary>
                            <pre id="newsletter-preview" style="
                                margin-top: 0.5rem;
                                padding: 1rem;
                                background: var(--bg-secondary);
                                border-radius: 8px;
                                font-size: 0.75rem;
                                overflow: auto;
                                max-height: 300px;
                                white-space: pre-wrap;
                            ">${escapeHtml(generateNewsletterExport('markdown'))}</pre>
                        </details>
                    </div>
                </div>
            `;
            
            // Update preview on format change
            modal.querySelectorAll('input[name="export-format"]').forEach(input => {
                input.addEventListener('change', () => {
                    const preview = modal.querySelector('#newsletter-preview');
                    if (preview) {
                        preview.textContent = generateNewsletterExport(input.value);
                    }
                });
            });
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
            
            document.body.appendChild(modal);
            modal.classList.add('visible');
        }
        
        function generateNewsletterExport(format = 'markdown') {
            const articles = state.filteredArticles.slice(0, 25);
            const today = new Date().toLocaleDateString('en-IN', { 
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
            });
            
            if (format === 'json') {
                return JSON.stringify({
                    generated: new Date().toISOString(),
                    count: articles.length,
                    articles: articles.map(a => ({
                        title: a.title,
                        source: a.source_name,
                        url: a.url,
                        date: a.publication_date,
                        category: a.category,
                        summary: a.summary,
                        priority: a.priority_class
                    }))
                }, null, 2);
            }
            
            if (format === 'plain') {
                let text = `PolicyRadar Daily Briefing\n${today}\n${articles.length} articles\n\n`;
                articles.forEach((a, i) => {
                    text += `${i + 1}. ${a.title}\n`;
                    text += `   Source: ${a.source_name} | ${a.category}\n`;
                    text += `   ${a.url}\n`;
                    if (a.summary) text += `   ${a.summary.substring(0, 150)}...\n`;
                    text += '\n';
                });
                return text;
            }
            
            // Markdown format
            let md = `# PolicyRadar Daily Briefing\n\n**${today}** | ${articles.length} articles\n\n---\n\n`;
            
            // Group by category
            const byCategory = {};
            articles.forEach(a => {
                const cat = a.category || 'Policy News';
                if (!byCategory[cat]) byCategory[cat] = [];
                byCategory[cat].push(a);
            });
            
            for (const [category, catArticles] of Object.entries(byCategory)) {
                md += `## ${category}\n\n`;
                catArticles.forEach(a => {
                    const priority = a.priority_class === 'critical' ? 'ðŸ”´ ' : a.priority_class === 'high' ? 'ðŸŸ  ' : '';
                    md += `### ${priority}${a.title}\n\n`;
                    md += `**${a.source_name}** | ${formatDate(a.publication_date)}\n\n`;
                    if (a.summary) md += `${a.summary}\n\n`;
                    md += `[Read more](${a.url})\n\n---\n\n`;
                });
            }
            
            return md;
        }
        
        function getSelectedExportFormat() {
            return document.querySelector('input[name="export-format"]:checked')?.value || 'markdown';
        }
        
        function copyNewsletterExport() {
            const format = getSelectedExportFormat();
            const content = generateNewsletterExport(format);
            navigator.clipboard.writeText(content).then(() => {
                showToast('Copied to clipboard!');
            }).catch(() => {
                showToast('Failed to copy');
            });
        }
        
        function downloadNewsletterExport() {
            const format = getSelectedExportFormat();
            const content = generateNewsletterExport(format);
            const ext = format === 'json' ? 'json' : format === 'plain' ? 'txt' : 'md';
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `policyradar-briefing-${new Date().toISOString().split('T')[0]}.${ext}`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('Download started!');
        }
        
        // Close modals on backdrop click
        document.querySelectorAll('.modal-overlay').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('visible');
                }
            });
        });
        
        // ========================================
        // PDF EXPORT
        // ========================================
        async function downloadPdf() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const articles = state.filteredArticles;
            const today = new Date().toLocaleDateString('en-IN', { 
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
            });
            
            // Title
            doc.setFontSize(20);
            doc.setTextColor(37, 99, 235);
            doc.text('PolicyRadar Daily Briefing', 105, 20, { align: 'center' });
            
            doc.setFontSize(10);
            doc.setTextColor(100);
            doc.text(`${today} | ${articles.length} articles`, 105, 28, { align: 'center' });
            
            let y = 40;
            const margin = 15;
            const pageWidth = 180;
            const pageHeight = 275;
            
            // Group by category
            const byCategory = {};
            articles.forEach(a => {
                const cat = a.category || 'Policy News';
                if (!byCategory[cat]) byCategory[cat] = [];
                byCategory[cat].push(a);
            });
            
            for (const [category, catArticles] of Object.entries(byCategory)) {
                if (y > pageHeight - 60) {
                    doc.addPage();
                    y = 25;
                }
                
                // Category header
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.setTextColor(37, 99, 235);
                doc.text(category, margin, y);
                doc.setFont(undefined, 'normal');
                y += 8;
                
                for (const article of catArticles.slice(0, 30)) {
                    if (y > pageHeight - 35) {
                        doc.addPage();
                        y = 25;
                    }
                    
                    // Priority indicator
                    doc.setFontSize(9);
                    if (article.priority_class === 'critical') {
                        doc.setTextColor(220, 53, 69);
                        doc.text('[!!]', margin, y);
                    } else if (article.priority_class === 'high') {
                        doc.setTextColor(245, 158, 11);
                        doc.text('[!]', margin, y);
                    } else {
                        doc.setTextColor(100);
                        doc.text('[-]', margin, y);
                    }
                    
                    // Title
                    doc.setTextColor(30);
                    const titleLines = doc.splitTextToSize(article.title, pageWidth - 15);
                    doc.text(titleLines, margin + 12, y);
                    y += titleLines.length * 4.5;
                    
                    // Source and date
                    doc.setFontSize(8);
                    doc.setTextColor(100);
                    doc.text(`${article.source_name} | ${formatDate(article.publication_date)}`, margin + 12, y);
                    y += 4;
                    
                    // URL
                    doc.setTextColor(37, 99, 235);
                    doc.setFontSize(7);
                    const url = article.url;
                    const maxUrlWidth = pageWidth - 15;
                    
                    if (doc.getTextWidth(url) > maxUrlWidth) {
                        const urlLines = doc.splitTextToSize(url, maxUrlWidth);
                        doc.text(urlLines[0], margin + 12, y);
                        doc.link(margin + 12, y - 2.5, doc.getTextWidth(urlLines[0]), 3, { url });
                        y += 3;
                    } else {
                        doc.text(url, margin + 12, y);
                        doc.link(margin + 12, y - 2.5, doc.getTextWidth(url), 3, { url });
                        y += 3;
                    }
                    
                    y += 4;
                }
                
                y += 6;
            }
            
            // Footer on all pages
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                
                // Watermark
                doc.setFontSize(50);
                doc.setTextColor(240, 240, 240);
                doc.text('policyradar.in', 105, 150, { align: 'center', angle: 45 });
                
                // Footer
                doc.setFontSize(8);
                doc.setTextColor(150);
                doc.text(`PolicyRadar | policyradar.in | Page ${i} of ${pageCount}`, 105, 290, { align: 'center' });
            }
            
            doc.save(`PolicyRadar_${new Date().toISOString().split('T')[0]}.pdf`);
            closePdfModal();
            showToast('PDF downloaded successfully!');
        }
        
        // ========================================
        // SHARING
        // ========================================
        async function shareArticle(event, url, title) {
            event.stopPropagation();
            
            const shareData = {
                title: title,
                text: `${title} via PolicyRadar`,
                url: url,
            };
            
            if (navigator.share) {
                try {
                    await navigator.share(shareData);
                } catch (err) {
                    if (err.name !== 'AbortError') {
                        copyToClipboard(url);
                    }
                }
            } else {
                copyToClipboard(url);
            }
        }
        
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast('Link copied to clipboard!');
            }).catch(() => {
                showToast('Failed to copy link');
            });
        }
        
        // ========================================
        // READING LIST
        // ========================================
        const readingList = new Map();
        
        function initReadingList() {
            try {
                const stored = localStorage.getItem('policyradar_reading_list');
                if (stored) {
                    const parsed = JSON.parse(stored);
                    Object.entries(parsed).forEach(([url, data]) => {
                        readingList.set(url, data);
                    });
                }
            } catch (e) {
                console.warn('Failed to load reading list:', e);
            }
            updateBookmarkButtons();
        }
        
        function saveReadingList() {
            try {
                const obj = Object.fromEntries(readingList);
                localStorage.setItem('policyradar_reading_list', JSON.stringify(obj));
            } catch (e) {
                console.warn('Failed to save reading list:', e);
            }
        }
        
        function toggleReadingList(event, url, title, source) {
            event.stopPropagation();
            
            if (readingList.has(url)) {
                readingList.delete(url);
                showToast('Removed from reading list');
            } else {
                readingList.set(url, {
                    title: title,
                    source: source,
                    savedAt: new Date().toISOString()
                });
                showToast('Added to reading list');
            }
            
            saveReadingList();
            updateBookmarkButtons();
        }
        
        function updateBookmarkButtons() {
            document.querySelectorAll('.bookmark-btn').forEach(btn => {
                const url = btn.dataset.url;
                if (readingList.has(url)) {
                    btn.textContent = 'ðŸ”–';
                    btn.title = 'Remove from reading list';
                    btn.classList.add('bookmarked');
                } else {
                    btn.textContent = 'ðŸ“‘';
                    btn.title = 'Save to reading list';
                    btn.classList.remove('bookmarked');
                }
            });
        }
        
        // ========================================
        // THEME
        // ========================================
        function initTheme() {
            // Check both possible localStorage keys for cross-page sync
            const saved = localStorage.getItem('theme') || localStorage.getItem('policyradar-theme');
            
            if (saved === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
            } else if (saved === 'light') {
                document.documentElement.removeAttribute('data-theme');
            } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
            
            // Sync to both keys for cross-page compatibility
            if (saved) {
                localStorage.setItem('theme', saved);
                localStorage.setItem('policyradar-theme', saved);
            }
        }
        
        function toggleTheme() {
            const current = document.documentElement.getAttribute('data-theme');
            const newTheme = current === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            // Sync both localStorage keys
            localStorage.setItem('theme', newTheme);
            localStorage.setItem('policyradar-theme', newTheme);
        }
        
        // Listen for system preference changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
            if (!localStorage.getItem('theme') && !localStorage.getItem('policyradar-theme')) {
                document.documentElement.setAttribute('data-theme', e.matches ? 'dark' : 'light');
            }
        });
        
        // ========================================
        // UTILITIES
        // ========================================
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function formatDate(dateStr) {
            if (!dateStr) return '';
            return new Date(dateStr).toLocaleDateString('en-IN', { month: 'short', day: 'numeric' });
        }
        
        function truncate(text, maxLength) {
            if (!text || text.length <= maxLength) return text;
            return text.substring(0, maxLength).trim() + '...';
        }
        
        function showError(message) {
            document.getElementById('articles-grid').innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">âš ï¸</div>
                    <h3 class="empty-state-title">Something went wrong</h3>
                    <p class="empty-state-description">${escapeHtml(message)}</p>
                    <div class="empty-state-actions">
                        <button class="btn btn-primary" onclick="location.reload()">Refresh page</button>
                    </div>
                </div>
            `;
        }
        
        function showToast(message) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            container.appendChild(toast);
            
            setTimeout(() => toast.remove(), 3000);
        }
        
        function announce(message) {
            const announcer = document.getElementById('announcements');
            announcer.textContent = message;
        }
        
        // Mobile filter state (separate from desktop for preview)
        const mobileFilterState = {
            domain: null,
            subcategory: null,
            sourceType: null,
            time: null
        };

        function toggleMobileFilters() {
            const sheet = document.getElementById('mobile-filter-sheet');
            const backdrop = document.getElementById('mobile-filter-backdrop');
            if (sheet) {
                const isExpanded = sheet.classList.toggle('expanded');
                if (backdrop) backdrop.classList.toggle('visible', isExpanded);
            }
        }

        function setMobileDomainFilter(domain, element) {
            mobileFilterState.domain = domain || null;
            mobileFilterState.subcategory = null; // Reset subcategory

            // Update active states
            document.querySelectorAll('#mobile-domain-filters .mobile-filter-chip').forEach(chip => {
                chip.classList.toggle('active', chip.dataset.domain === domain);
            });

            // Show/hide subcategory section
            const subcategorySection = document.getElementById('mobile-subcategory-section');
            const subcategoryFilters = document.getElementById('mobile-subcategory-filters');

            if (domain && SUBCATEGORIES[domain]) {
                subcategorySection.style.display = 'block';
                const categories = SUBCATEGORIES[domain];
                const counts = {};
                categories.forEach(cat => {
                    counts[cat] = state.allArticles.filter(a => a.category === cat).length;
                });

                subcategoryFilters.innerHTML = `
                    <button class="mobile-filter-chip active" data-category="" onclick="setMobileSubcategoryFilter('', this)">All</button>
                    ${categories.map(cat => `
                        <button class="mobile-filter-chip" data-category="${escapeHtml(cat)}" onclick="setMobileSubcategoryFilter('${escapeHtml(cat)}', this)">
                            ${escapeHtml(cat)} <span style="opacity: 0.7">(${counts[cat] || 0})</span>
                        </button>
                    `).join('')}
                `;
            } else {
                subcategorySection.style.display = 'none';
            }

            updateMobileFilterCount();
        }

        function setMobileSubcategoryFilter(category, element) {
            mobileFilterState.subcategory = category || null;

            document.querySelectorAll('#mobile-subcategory-filters .mobile-filter-chip').forEach(chip => {
                chip.classList.toggle('active', chip.dataset.category === category);
            });

            updateMobileFilterCount();
        }

        function setMobileSourceTypeFilter(sourceType, element) {
            mobileFilterState.sourceType = sourceType || null;

            document.querySelectorAll('#mobile-source-type-filters .mobile-filter-chip').forEach(chip => {
                chip.classList.toggle('active', chip.dataset.sourceType === sourceType);
            });

            updateMobileFilterCount();
        }

        function setMobileTimeFilter(time, element) {
            mobileFilterState.time = time || null;

            document.querySelectorAll('#mobile-time-filters .mobile-filter-chip').forEach(chip => {
                chip.classList.toggle('active', chip.dataset.time === time);
            });

            updateMobileFilterCount();
        }

        function updateMobileFilterCount() {
            let count = 0;
            if (mobileFilterState.domain) count++;
            if (mobileFilterState.subcategory) count++;
            if (mobileFilterState.sourceType) count++;
            if (mobileFilterState.time) count++;

            const countEl = document.getElementById('mobile-filter-count');
            const clearBtn = document.getElementById('mobile-filter-clear');
            const navBadge = document.getElementById('active-filter-count');

            if (count > 0) {
                if (countEl) {
                    countEl.textContent = count;
                    countEl.style.display = 'inline';
                }
                if (clearBtn) clearBtn.style.display = 'block';
                if (navBadge) {
                    navBadge.textContent = count;
                    navBadge.style.display = 'flex';
                }
            } else {
                if (countEl) countEl.style.display = 'none';
                if (clearBtn) clearBtn.style.display = 'none';
                if (navBadge) navBadge.style.display = 'none';
            }
        }

        function applyMobileFilters() {
            // Apply mobile filters to main state
            state.filters.domain = mobileFilterState.domain;
            currentSelectedCategory = mobileFilterState.subcategory;
            state.filters.sourceType = mobileFilterState.sourceType;

            // Apply time filter
            if (mobileFilterState.time === 'today') {
                state.filters.startDate = new Date().toISOString().split('T')[0];
            } else if (mobileFilterState.time === 'week') {
                const weekAgo = new Date();
                weekAgo.setDate(weekAgo.getDate() - 7);
                state.filters.startDate = weekAgo.toISOString().split('T')[0];
            } else {
                state.filters.startDate = null;
            }

            // Sync desktop UI with new filters
            document.querySelectorAll('.domain-pill').forEach(pill => {
                pill.classList.toggle('active', pill.dataset.domain === (state.filters.domain || ''));
            });
            document.querySelectorAll('.source-type-pill').forEach(pill => {
                pill.classList.toggle('active', pill.dataset.sourceType === (state.filters.sourceType || ''));
            });

            state.currentPage = 1;
            applyFiltersAndRender();

            // Collapse the sheet and backdrop
            const sheet = document.getElementById('mobile-filter-sheet');
            const backdrop = document.getElementById('mobile-filter-backdrop');
            if (sheet) sheet.classList.remove('expanded');
            if (backdrop) backdrop.classList.remove('visible');

            // Scroll to top of results
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Override clearAllFilters to also reset mobile state
        const originalClearAllFilters = clearAllFilters;
        clearAllFilters = function() {
            mobileFilterState.domain = null;
            mobileFilterState.subcategory = null;
            mobileFilterState.sourceType = null;
            mobileFilterState.time = null;

            // Reset mobile UI
            document.querySelectorAll('#mobile-domain-filters .mobile-filter-chip').forEach(chip => {
                chip.classList.toggle('active', !chip.dataset.domain);
            });
            document.querySelectorAll('#mobile-source-type-filters .mobile-filter-chip').forEach(chip => {
                chip.classList.toggle('active', !chip.dataset.sourceType);
            });
            document.querySelectorAll('#mobile-time-filters .mobile-filter-chip').forEach(chip => {
                chip.classList.toggle('active', !chip.dataset.time);
            });
            document.getElementById('mobile-subcategory-section').style.display = 'none';

            updateMobileFilterCount();
            originalClearAllFilters();

            // Collapse sheet and backdrop after clearing
            const sheet = document.getElementById('mobile-filter-sheet');
            const backdrop = document.getElementById('mobile-filter-backdrop');
            if (sheet) sheet.classList.remove('expanded');
            if (backdrop) backdrop.classList.remove('visible');
        };
        
        // Expose functions globally
        window.applyFiltersAndRender = applyFiltersAndRender;
        window.escapeHtml = escapeHtml;
        window.showToast = showToast;
        window.renderArticleCard = renderArticleCard;
        window.CONFIG = CONFIG;
        window.state = state;
    </script>
</body>
</html>
