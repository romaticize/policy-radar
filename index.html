<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PolicyRadar - Indian Policy Intelligence</title>
    <meta name="description" content="PolicyRadar aggregates policy news from 270+ Indian sources including government, think tanks, and media.">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üì°</text></svg>">
    <style>
        :root {
            --bg: #ffffff;
            --text: #1a1a2e;
            --text-muted: #666;
            --border: #e0e0e0;
            --card-bg: #fff;
            --accent: #2563eb;
            --accent-light: #dbeafe;
            --critical: #dc2626;
            --critical-bg: #fef2f2;
            --high: #ca8a04;
            --high-bg: #fefce8;
            --medium: #16a34a;
            --medium-bg: #f0fdf4;
            --trending-bg: #f8fafc;
            --trending-border: #e2e8f0;
        }
        .dark {
            --bg: #0f172a;
            --text: #e2e8f0;
            --text-muted: #94a3b8;
            --border: #334155;
            --card-bg: #1e293b;
            --accent: #3b82f6;
            --accent-light: #1e3a5f;
            --critical-bg: #450a0a;
            --high-bg: #422006;
            --medium-bg: #052e16;
            --trending-bg: #1e293b;
            --trending-border: #334155;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
        }
        header {
            background: var(--card-bg);
            border-bottom: 1px solid var(--border);
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent);
            text-decoration: none;
        }
        .header-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        #lastUpdated {
            font-size: 0.85rem;
            color: var(--text-muted);
        }
        .theme-toggle {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.25rem;
        }
        main {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem;
        }

        /* Trending Topics Section */
        .trending-section {
            background: var(--trending-bg);
            border: 1px solid var(--trending-border);
            border-radius: 12px;
            padding: 1rem 1.25rem;
            margin-bottom: 1.5rem;
        }
        .trending-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
            font-weight: 600;
            font-size: 1rem;
        }
        .trending-pills {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        .topic-pill {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 0.4rem 0.85rem;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }
        .topic-pill:hover {
            background: var(--accent-light);
            border-color: var(--accent);
        }
        .topic-pill.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }
        .topic-count {
            background: var(--accent-light);
            color: var(--accent);
            padding: 0.1rem 0.4rem;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .topic-pill.active .topic-count {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        /* Filter Bar */
        .filter-bar {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }
        .filter-toggle {
            display: none;
            width: 100%;
            padding: 0.75rem;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            color: var(--text);
            margin-bottom: 0.5rem;
        }
        .filter-content {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: flex-start;
        }
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .filter-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
        }
        .search-input {
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.9rem;
            width: 200px;
            background: var(--bg);
            color: var(--text);
        }
        .btn-group {
            display: flex;
            gap: 0.25rem;
        }
        .btn {
            padding: 0.4rem 0.75rem;
            border: 1px solid var(--border);
            background: var(--bg);
            color: var(--text);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }
        .btn:hover { background: var(--accent-light); }
        .btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }
        .priority-filters {
            display: flex;
            gap: 0.5rem;
        }
        .priority-check {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            cursor: pointer;
            font-size: 0.9rem;
        }
        .priority-check input { cursor: pointer; }
        .category-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            max-width: 600px;
        }
        .category-chip {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.3rem 0.6rem;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 15px;
            font-size: 0.8rem;
            cursor: pointer;
        }
        .category-chip:hover { background: var(--accent-light); }
        .category-chip.active {
            background: var(--accent);
            color: white;
        }
        .category-chip input { display: none; }
        .chip-count {
            font-size: 0.7rem;
            opacity: 0.7;
        }
        select {
            padding: 0.4rem 0.6rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--bg);
            color: var(--text);
            font-size: 0.85rem;
            cursor: pointer;
        }

        /* Stats */
        .stats {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            color: var(--text-muted);
        }
        .stat-item { display: flex; align-items: center; gap: 0.25rem; }

        /* Articles Grid */
        .articles-container {
            display: grid;
            gap: 1rem;
        }
        .category-section {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
        }
        .category-header {
            background: var(--accent-light);
            padding: 0.75rem 1rem;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .category-count {
            font-size: 0.8rem;
            color: var(--text-muted);
        }
        .articles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1rem;
            padding: 1rem;
        }
        .article-card {
            padding: 1rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg);
            border-left: 4px solid var(--medium);
            transition: box-shadow 0.2s;
        }
        .article-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .article-card.critical { border-left-color: var(--critical); background: var(--critical-bg); }
        .article-card.high { border-left-color: var(--high); background: var(--high-bg); }
        .article-card.medium { border-left-color: var(--medium); background: var(--medium-bg); }
        .article-title {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }
        .article-title a {
            color: var(--text);
            text-decoration: none;
        }
        .article-title a:hover { color: var(--accent); }
        .article-meta {
            font-size: 0.8rem;
            color: var(--text-muted);
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        .article-summary {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: 0.5rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .priority-badge {
            display: inline-block;
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        .priority-badge.critical { background: var(--critical); color: white; }
        .priority-badge.high { background: var(--high); color: white; }

        /* Loading/Empty States */
        .loading, .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-muted);
        }
        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 0.5rem;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        footer {
            text-align: center;
            padding: 2rem;
            color: var(--text-muted);
            font-size: 0.85rem;
            border-top: 1px solid var(--border);
            margin-top: 2rem;
        }
        footer a { color: var(--accent); }

        /* Mobile */
        @media (max-width: 768px) {
            .filter-toggle { display: block; }
            .filter-content { display: none; flex-direction: column; }
            .filter-content.show { display: flex; }
            .search-input { width: 100%; }
            .category-chips { max-width: 100%; }
            .articles-grid { grid-template-columns: 1fr; }
            .trending-pills { gap: 0.4rem; }
            .topic-pill { padding: 0.3rem 0.65rem; font-size: 0.8rem; }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <a href="/" class="logo">üì° PolicyRadar</a>
            <div class="header-right">
                <span id="lastUpdated">Loading...</span>
                <button class="theme-toggle" onclick="toggleTheme()" title="Toggle dark mode">üåô</button>
            </div>
        </div>
    </header>

    <main>
        <!-- Trending Topics Section -->
        <section class="trending-section" id="trendingSection" style="display: none;">
            <div class="trending-header">
                <span>üî•</span>
                <span>Trending Topics</span>
            </div>
            <div class="trending-pills" id="trendingPills">
                <!-- Populated by JS -->
            </div>
        </section>

        <!-- Filter Bar -->
        <div class="filter-bar">
            <button class="filter-toggle" onclick="toggleFilters()">
                <span id="filterSummary">‚öôÔ∏è Filters | Month ‚Ä¢ All categories</span> ‚ñº
            </button>
            <div class="filter-content" id="filterContent">
                <div class="filter-group">
                    <span class="filter-label">Search</span>
                    <input type="text" class="search-input" id="searchInput" placeholder="Search articles...">
                </div>
                <div class="filter-group">
                    <span class="filter-label">Timeline</span>
                    <div class="btn-group">
                        <button class="btn" data-timeline="today">Today</button>
                        <button class="btn" data-timeline="week">Week</button>
                        <button class="btn active" data-timeline="month">Month</button>
                        <button class="btn" data-timeline="all">All</button>
                    </div>
                </div>
                <div class="filter-group">
                    <span class="filter-label">Priority</span>
                    <div class="priority-filters">
                        <label class="priority-check"><input type="checkbox" id="criticalCheck" checked> üî¥</label>
                        <label class="priority-check"><input type="checkbox" id="highCheck" checked> üü°</label>
                        <label class="priority-check"><input type="checkbox" id="mediumCheck" checked> üü¢</label>
                    </div>
                </div>
                <div class="filter-group">
                    <span class="filter-label">Sort</span>
                    <select id="sortSelect">
                        <option value="recent">üìÖ Recent</option>
                        <option value="relevant">‚≠ê Relevant</option>
                    </select>
                </div>
                <div class="filter-group">
                    <span class="filter-label">Categories</span>
                    <div class="category-chips" id="categoryChips">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats -->
        <div class="stats" id="stats">
            <div class="stat-item" id="articleCount">Loading...</div>
        </div>

        <!-- Articles -->
        <div class="articles-container" id="articlesContainer">
            <div class="loading">Loading policy updates...</div>
        </div>
    </main>

    <footer>
        ¬© <span id="year"></span> PolicyRadar ‚Ä¢ <a href="https://github.com/romaticize/policy-radar">GitHub</a>
    </footer>

    <script>
        let allArticles = [];
        let trendingTopics = [];
        let categories = new Set();
        let selectedCategories = new Set();
        let selectedTopic = null;
        let topicArticleUrls = new Set();

        // Theme
        function toggleTheme() {
            document.body.classList.toggle('dark');
            localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
        }
        if (localStorage.getItem('theme') === 'dark' || 
            (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.body.classList.add('dark');
        }

        // Filter toggle
        function toggleFilters() {
            document.getElementById('filterContent').classList.toggle('show');
        }

        // Load data
        async function loadData() {
            try {
                const response = await fetch('data/public_data.json');
                const data = await response.json();
                
                allArticles = data.articles || [];
                trendingTopics = data.trending_topics || [];
                
                // Update last updated
                if (data.last_updated) {
                    const date = new Date(data.last_updated);
                    document.getElementById('lastUpdated').textContent = 
                        `Updated: ${date.toLocaleDateString()} ${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
                }

                // Extract categories
                allArticles.forEach(a => categories.add(a.category));
                
                renderTrendingTopics();
                renderCategoryChips();
                applyFilters();
            } catch (e) {
                document.getElementById('articlesContainer').innerHTML = 
                    '<div class="empty-state">Could not load data.</div>';
            }
        }

        // Render Trending Topics
        function renderTrendingTopics() {
            const section = document.getElementById('trendingSection');
            const container = document.getElementById('trendingPills');
            
            if (!trendingTopics || trendingTopics.length === 0) {
                section.style.display = 'none';
                return;
            }
            
            section.style.display = 'block';
            container.innerHTML = trendingTopics.map(topic => `
                <button class="topic-pill ${selectedTopic === topic.topic ? 'active' : ''}" 
                        onclick="filterByTopic('${topic.topic.replace(/'/g, "\\'")}')">
                    ${topic.topic}
                    <span class="topic-count">${topic.count}</span>
                </button>
            `).join('');
        }

        // Filter by trending topic
        function filterByTopic(topicName) {
            if (selectedTopic === topicName) {
                // Deselect
                selectedTopic = null;
                topicArticleUrls.clear();
            } else {
                // Select topic
                selectedTopic = topicName;
                topicArticleUrls.clear();
                const topic = trendingTopics.find(t => t.topic === topicName);
                if (topic && topic.articles) {
                    topic.articles.forEach(a => topicArticleUrls.add(a.url));
                }
            }
            renderTrendingTopics();
            applyFilters();
        }

        // Render category chips
        function renderCategoryChips() {
            const container = document.getElementById('categoryChips');
            const categoryCounts = {};
            allArticles.forEach(a => {
                categoryCounts[a.category] = (categoryCounts[a.category] || 0) + 1;
            });
            
            container.innerHTML = Array.from(categories).sort().map(cat => `
                <label class="category-chip ${selectedCategories.size === 0 || selectedCategories.has(cat) ? 'active' : ''}" 
                       onclick="toggleCategory('${cat}')">
                    <input type="checkbox" ${selectedCategories.size === 0 || selectedCategories.has(cat) ? 'checked' : ''}>
                    ${cat} <span class="chip-count">(${categoryCounts[cat] || 0})</span>
                </label>
            `).join('');
        }

        function toggleCategory(cat) {
            if (selectedCategories.has(cat)) {
                selectedCategories.delete(cat);
            } else {
                if (selectedCategories.size === 0) {
                    // First selection: add all except this one
                    categories.forEach(c => { if (c !== cat) selectedCategories.add(c); });
                } else {
                    selectedCategories.add(cat);
                }
            }
            if (selectedCategories.size === categories.size) {
                selectedCategories.clear(); // All selected = none selected (show all)
            }
            renderCategoryChips();
            applyFilters();
        }

        // Apply all filters
        function applyFilters() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const timeline = document.querySelector('.btn[data-timeline].active')?.dataset.timeline || 'month';
            const showCritical = document.getElementById('criticalCheck').checked;
            const showHigh = document.getElementById('highCheck').checked;
            const showMedium = document.getElementById('mediumCheck').checked;
            const sort = document.getElementById('sortSelect').value;

            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
            const monthAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);

            let filtered = allArticles.filter(article => {
                // Topic filter
                if (selectedTopic && topicArticleUrls.size > 0) {
                    if (!topicArticleUrls.has(article.url)) return false;
                }

                // Search
                if (search && !article.title.toLowerCase().includes(search) && 
                    !(article.summary || '').toLowerCase().includes(search)) return false;

                // Timeline
                const articleDate = new Date(article.publication_date);
                if (timeline === 'today' && articleDate < today) return false;
                if (timeline === 'week' && articleDate < weekAgo) return false;
                if (timeline === 'month' && articleDate < monthAgo) return false;

                // Priority
                const priority = article.priority_class || 'medium';
                if (priority === 'critical' && !showCritical) return false;
                if (priority === 'high' && !showHigh) return false;
                if (priority === 'medium' && !showMedium) return false;

                // Category
                if (selectedCategories.size > 0 && !selectedCategories.has(article.category)) return false;

                return true;
            });

            // Sort
            if (sort === 'relevant') {
                filtered.sort((a, b) => (b.relevance_score || 0) - (a.relevance_score || 0));
            } else {
                filtered.sort((a, b) => new Date(b.publication_date) - new Date(a.publication_date));
            }

            // Update stats
            document.getElementById('articleCount').textContent = `${filtered.length} articles`;
            if (selectedTopic) {
                document.getElementById('articleCount').textContent += ` ‚Ä¢ Topic: ${selectedTopic}`;
            }

            // Render
            renderArticles(filtered);
            updateFilterSummary(timeline);
        }

        function updateFilterSummary(timeline) {
            const catText = selectedCategories.size === 0 ? 'All categories' : 
                            selectedCategories.size === 1 ? Array.from(selectedCategories)[0] :
                            `${selectedCategories.size} categories`;
            document.getElementById('filterSummary').textContent = 
                `‚öôÔ∏è Filters | ${timeline.charAt(0).toUpperCase() + timeline.slice(1)} ‚Ä¢ ${catText}`;
        }

        // Render articles grouped by category
        function renderArticles(articles) {
            const container = document.getElementById('articlesContainer');
            
            if (articles.length === 0) {
                container.innerHTML = '<div class="empty-state">üîç No articles match your filters.</div>';
                return;
            }

            // Group by category
            const grouped = {};
            articles.forEach(a => {
                if (!grouped[a.category]) grouped[a.category] = [];
                grouped[a.category].push(a);
            });

            // Category priority order (higher = shown first)
            const categoryOrder = {
                'Constitutional & Legal': 10,
                'Governance & Administration': 9,
                'Economic Policy': 8,
                'Technology Policy': 7,
                'Healthcare Policy': 6,
                'Social Policy': 5,
                'Defence & Security': 4,
                'Education Policy': 3,
                'Environmental Policy': 2,
                'Foreign Policy': 1,
                'Infrastructure & Transport': 0,
                'Agricultural Policy': 0,
                'Policy News': -1
            };

            container.innerHTML = Object.entries(grouped)
                .sort(([a], [b]) => (categoryOrder[b] || 0) - (categoryOrder[a] || 0))
                .map(([category, articles]) => `
                    <section class="category-section">
                        <div class="category-header">
                            <span>${category}</span>
                            <span class="category-count">${articles.length} articles</span>
                        </div>
                        <div class="articles-grid">
                            ${articles.map(a => renderArticle(a)).join('')}
                        </div>
                    </section>
                `).join('');
        }

        function renderArticle(article) {
            const priority = article.priority_class || 'medium';
            const date = new Date(article.publication_date).toLocaleDateString();
            const priorityBadge = priority === 'critical' ? '<span class="priority-badge critical">üî• TOP</span>' : 
                                  priority === 'high' ? '<span class="priority-badge high">HIGH</span>' : '';
            
            return `
                <article class="article-card ${priority}">
                    <h3 class="article-title">
                        ${priorityBadge}
                        <a href="${article.url}" target="_blank" rel="noopener">${article.title}</a>
                    </h3>
                    <div class="article-meta">
                        <span>${article.source_name}</span>
                        <span>‚Ä¢</span>
                        <span>${date}</span>
                    </div>
                    ${article.summary ? `<p class="article-summary">${article.summary}</p>` : ''}
                </article>
            `;
        }

        // Event listeners
        document.getElementById('searchInput').addEventListener('input', applyFilters);
        document.querySelectorAll('.btn[data-timeline]').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.btn[data-timeline]').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                applyFilters();
            });
        });
        ['criticalCheck', 'highCheck', 'mediumCheck'].forEach(id => {
            document.getElementById(id).addEventListener('change', applyFilters);
        });
        document.getElementById('sortSelect').addEventListener('change', applyFilters);

        // Init
        document.getElementById('year').textContent = new Date().getFullYear();
        loadData();
    </script>
</body>
</html>
