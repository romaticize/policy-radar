<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PolicyRadar - Topic Explorer</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #13111C;
            --bg-secondary: #1a1825;
            --bg-card: #1e1b2e;
            --bg-elevated: #252236;
            --text-primary: #ffffff;
            --text-secondary: #a5a3b3;
            --text-muted: #6b6880;
            --border-color: #2d2a3d;
            --accent-primary: #8b7cf7;
            --accent-secondary: #a78bfa;
            --accent-light: rgba(139, 124, 247, 0.15);
        }
        
        [data-theme="light"] {
            --bg-primary: #f5f7fa;
            --bg-secondary: #ffffff;
            --bg-card: #ffffff;
            --bg-elevated: #f0f2f5;
            --text-primary: #1a1a2e;
            --text-secondary: #4b5563;
            --text-muted: #9ca3af;
            --border-color: #e2e5eb;
            --accent-primary: #6366f1;
            --accent-secondary: #818cf8;
            --accent-light: rgba(99, 102, 241, 0.1);
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }
        
        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            height: 56px;
            padding: 0 20px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo { font-size: 1rem; font-weight: 700; color: var(--accent-primary); }
        
        .header-controls { display: flex; gap: 8px; align-items: center; }
        
        .btn {
            padding: 7px 14px;
            font-size: 0.8125rem;
            font-weight: 500;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.15s;
            text-decoration: none;
            border: 1px solid var(--border-color);
            background: var(--bg-card);
            color: var(--text-secondary);
        }
        
        .btn:hover { background: var(--accent-light); color: var(--accent-primary); border-color: var(--accent-primary); }
        .btn-primary { background: var(--accent-primary); color: white; border-color: var(--accent-primary); }
        
        .toolbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 20px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
        }
        
        .toolbar-left { display: flex; align-items: center; gap: 12px; }
        
        .back-btn {
            padding: 6px 12px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 0.8125rem;
            cursor: pointer;
        }
        
        .back-btn:hover:not(:disabled) { background: var(--accent-primary); color: white; }
        .back-btn:disabled { opacity: 0.4; cursor: not-allowed; }
        
        .breadcrumb { display: flex; align-items: center; gap: 6px; font-size: 0.8125rem; }
        .breadcrumb-item { color: var(--text-muted); cursor: pointer; padding: 4px 8px; border-radius: 4px; }
        .breadcrumb-item:hover { background: var(--bg-card); color: var(--text-primary); }
        .breadcrumb-item.active { color: var(--accent-primary); font-weight: 600; }
        .breadcrumb-sep { color: var(--text-muted); opacity: 0.5; }
        
        .view-switcher { display: flex; background: var(--bg-card); padding: 3px; border-radius: 8px; gap: 2px; }
        .view-btn { padding: 6px 14px; font-size: 0.75rem; font-weight: 500; color: var(--text-muted); background: transparent; border: none; border-radius: 6px; cursor: pointer; }
        .view-btn:hover { color: var(--text-primary); }
        .view-btn.active { color: var(--accent-primary); background: var(--bg-elevated); }
        
        .stats-bar { display: flex; gap: 24px; padding: 16px 20px; background: var(--bg-card); border-bottom: 1px solid var(--border-color); }
        .stat-value { font-size: 1.25rem; font-weight: 700; color: var(--accent-primary); }
        .stat-label { font-size: 0.625rem; color: var(--text-muted); text-transform: uppercase; }
        
        .main-content { padding: 16px; min-height: calc(100vh - 200px); }
        
        .galaxy-container {
            position: relative;
            width: 100%;
            height: 55vh;
            min-height: 360px;
            background: var(--bg-card);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }
        
        .orbit { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); border: 1px dashed var(--border-color); border-radius: 50%; opacity: 0.3; }
        .orbit-1 { width: 220px; height: 220px; }
        .orbit-2 { width: 350px; height: 350px; }
        .orbit-3 { width: 480px; height: 480px; }
        
        .central-node {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 80px; height: 80px;
            background: linear-gradient(135deg, var(--accent-primary), #a855f7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.7rem;
            text-align: center;
            color: white;
            z-index: 10;
        }
        
        .topic-node {
            position: absolute;
            padding: 6px 12px;
            background: var(--bg-elevated);
            border: 2px solid var(--border-color);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.7rem;
            font-weight: 600;
            z-index: 5;
        }
        
        .topic-node:hover { transform: scale(1.05); }
        .topic-count { font-size: 0.6rem; color: var(--text-muted); margin-left: 4px; }
        
        .tree-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 14px; }
        .tree-card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; padding: 16px; }
        .tree-card:hover { border-color: var(--accent-primary); }
        .tree-card-header { display: flex; justify-content: space-between; margin-bottom: 12px; }
        .tree-card-title { font-weight: 600; cursor: pointer; }
        .tree-card-title:hover { color: var(--accent-primary); }
        .tree-card-count { font-size: 0.6875rem; color: var(--text-muted); background: var(--bg-elevated); padding: 2px 8px; border-radius: 10px; }
        .tree-keywords { display: flex; flex-wrap: wrap; gap: 6px; }
        
        .keyword-cloud { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; padding: 16px 0; }
        .keyword-chip { padding: 8px 14px; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 20px; cursor: pointer; font-size: 0.75rem; font-weight: 500; }
        .keyword-chip:hover { border-color: var(--accent-primary); background: var(--accent-light); }
        .keyword-chip.size-xl { font-size: 1.125rem; padding: 10px 20px; font-weight: 700; color: var(--accent-primary); }
        .keyword-chip.size-lg { font-size: 0.9375rem; padding: 8px 16px; font-weight: 600; }
        .keyword-chip.size-sm { font-size: 0.6875rem; padding: 6px 10px; color: var(--text-secondary); }
        
        .topic-header { text-align: center; margin-bottom: 24px; padding-bottom: 20px; border-bottom: 1px solid var(--border-color); }
        .topic-header h2 { font-size: 1.5rem; margin-bottom: 4px; }
        .topic-header p { color: var(--text-muted); }
        
        .article-list { display: flex; flex-direction: column; gap: 10px; max-width: 700px; margin: 0 auto; }
        .article-card { padding: 14px; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 10px; }
        .article-card:hover { border-color: var(--accent-primary); }
        /* Fix #24: Article source font minimum 11px (P2) */
        .article-source { font-size: 0.6875rem; font-weight: 600; color: var(--accent-primary); text-transform: uppercase; }
        .article-title { font-size: 0.875rem; font-weight: 500; margin: 4px 0; }
        .article-title a { color: var(--text-primary); text-decoration: none; }
        .article-title a:hover { color: var(--accent-primary); }
        .article-summary { font-size: 0.75rem; color: var(--text-secondary); }
        .article-meta { display: flex; gap: 12px; margin-top: 6px; font-size: 0.6875rem; color: var(--text-muted); }
        
        .hidden { display: none !important; }
        
        /* ========================================
           UI/UX FIXES - P0 & P1 PRIORITY
           ======================================== */
        
        /* Fix #15: Galaxy View Mobile Handling (P0) */
        @media (max-width: 640px) {
            .galaxy-container {
                display: none;
            }
            
            /* Show notice when galaxy is hidden */
            .mobile-galaxy-notice {
                display: block;
                text-align: center;
                padding: 24px;
                background: var(--bg-card);
                border-radius: 16px;
                border: 1px solid var(--border-color);
                margin-bottom: 16px;
            }
            
            .mobile-galaxy-notice p {
                color: var(--text-muted);
                font-size: 0.875rem;
                margin-bottom: 12px;
            }
        }
        
        @media (min-width: 641px) {
            .mobile-galaxy-notice {
                display: none;
            }
        }
        
        /* Scale orbits proportionally on tablet */
        @media (min-width: 641px) and (max-width: 1024px) {
            .orbit-1 { width: 30vw; height: 30vw; max-width: 220px; max-height: 220px; }
            .orbit-2 { width: 45vw; height: 45vw; max-width: 350px; max-height: 350px; }
            .orbit-3 { width: 60vw; height: 60vw; max-width: 480px; max-height: 480px; }
        }
        
        /* Fix #16: Center Policy Universe Properly (P0) */
        .galaxy-container {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        @media (max-width: 640px) {
            .galaxy-container {
                display: none;
            }
        }
        
        /* Fix #18: Stats Bar Responsive (P1) */
        @media (max-width: 480px) {
            .stats-bar {
                gap: 12px;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .stat-value {
                font-size: 1rem;
            }
        }
        
        /* Fix #19: View Switcher Touch Targets (P1) */
        @media (hover: none) and (pointer: coarse) {
            .view-btn {
                min-height: 44px;
                padding: 10px 16px;
            }
            
            .btn {
                min-height: 44px;
                min-width: 44px;
            }
            
            .back-btn {
                min-height: 44px;
                min-width: 44px;
            }
            
            .breadcrumb-item {
                min-height: 44px;
                padding: 10px 12px;
            }
            
            .keyword-chip {
                min-height: 44px;
            }
            
            .tree-card {
                min-height: 44px;
            }
        }
        
        /* Fix #20: Breadcrumb Keyboard Accessibility (P1) */
        .breadcrumb-item {
            cursor: pointer;
            background: none;
            border: none;
            font-size: inherit;
            font-family: inherit;
        }
        
        .breadcrumb-item:focus-visible {
            outline: 2px solid var(--accent-primary);
            outline-offset: 2px;
        }
        
        /* Fix #23: Back Button Disabled State (P2) */
        .back-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        
        .back-btn:disabled:hover {
            background: var(--bg-card);
            color: var(--text-primary);
        }
        
        /* Fix #25: Galaxy Container Height (P2) */
        .galaxy-container {
            min-height: 360px;
            max-height: 80vh;
        }
        
        /* Fix #27: Light Mode Text Contrast (P2) */
        [data-theme="light"] {
            --text-muted: #6b7280;
        }
        
        /* Fix #41: Standardized Focus Indicators (P1) */
        *:focus-visible {
            outline: 2px solid var(--accent-primary);
            outline-offset: 2px;
        }
        
        .btn:focus-visible,
        .view-btn:focus-visible,
        .keyword-chip:focus-visible {
            box-shadow: 0 0 0 4px var(--accent-light);
        }
        
        /* Fix #42: Reduced Motion Support (P1) */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
            
            .topic-node:hover {
                transform: none;
            }
        }
        
        /* Fix: Loading state skeleton */
        .loading-skeleton {
            text-align: center;
            padding: 48px;
            color: var(--text-muted);
        }
        
        .loading-spinner-inline {
            width: 24px;
            height: 24px;
            border: 2px solid var(--border-color);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 0.7s linear infinite;
            margin: 0 auto 12px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">üî≠ PolicyRadar Topic Explorer</div>
        <div class="header-controls">
            <button class="btn" onclick="toggleTheme()" id="theme-btn">‚òÄÔ∏è Light Mode</button>
            <a href="knowledge-graph.html" class="btn">üï∏Ô∏è Graph</a>
            <a href="index.html" class="btn btn-primary">‚Üê Dashboard</a>
        </div>
    </header>
    
    <div class="toolbar">
        <div class="toolbar-left">
            <button class="back-btn" id="back-btn" onclick="goBack()" disabled>‚Üê Back</button>
            <div class="breadcrumb" id="breadcrumb"><span class="breadcrumb-item active">All Topics</span></div>
        </div>
        <div class="view-switcher">
            <button class="view-btn active" data-view="galaxy" onclick="setView('galaxy')">üåå Galaxy</button>
            <button class="view-btn" data-view="tree" onclick="setView('tree')">üå≥ Categories</button>
            <button class="view-btn" data-view="cloud" onclick="setView('cloud')">‚òÅÔ∏è Keywords</button>
        </div>
    </div>
    
    <div class="stats-bar">
        <div><div class="stat-value" id="stat-topics">-</div><div class="stat-label">Categories</div></div>
        <div><div class="stat-value" id="stat-keywords">-</div><div class="stat-label">Keywords</div></div>
        <div><div class="stat-value" id="stat-articles">-</div><div class="stat-label">Articles</div></div>
        <div><div class="stat-value" id="stat-sources">-</div><div class="stat-label">Sources</div></div>
    </div>
    
    <main class="main-content">
        <!-- Mobile Galaxy Notice (P0) -->
        <div class="mobile-galaxy-notice" id="mobile-galaxy-notice">
            <p>üåå Galaxy view works best on larger screens</p>
            <button class="btn" onclick="setView('tree')">View Categories Instead</button>
        </div>
        
        <div class="galaxy-container" id="galaxy-view">
            <div class="orbit orbit-1"></div>
            <div class="orbit orbit-2"></div>
            <div class="orbit orbit-3"></div>
            <div class="central-node">Policy<br>Universe</div>
            <div id="topic-nodes"></div>
        </div>
        <div class="tree-grid hidden" id="tree-view"></div>
        <div class="keyword-cloud hidden" id="cloud-view"></div>
        <div class="hidden" id="topic-keywords-view">
            <div class="topic-header" id="topic-header"></div>
            <div class="keyword-cloud" id="topic-keywords"></div>
        </div>
        <div class="article-list hidden" id="article-list"></div>
    </main>
    
    <script>
        const TOPIC_COLORS = {
            'Economic Policy': '#3b82f6', 'Trade & Industry': '#8b5cf6',
            'Constitutional & Legal': '#ec4899', 'Technology Policy': '#06b6d4',
            'Healthcare Policy': '#10b981', 'Defence & Security': '#f97316',
            'Governance & Administration': '#ef4444', 'Politics': '#f97316',
            'Education Policy': '#8b5cf6', 'Environmental Policy': '#22c55e',
            'Infrastructure & Transport': '#a855f7', 'Agricultural Policy': '#84cc16',
            'Energy Policy': '#eab308', 'Foreign Policy': '#6366f1',
            'Consumer Affairs': '#ec4899', 'Policy News': '#64748b'
        };
        
        // ============================================================
        // SUSTAINABLE KEYWORD EXTRACTION SYSTEM
        // Same as knowledge-graph.html - uses patterns, not word lists
        // ============================================================
        
        const KeywordExtractor = {
            PLACE_SUFFIX_PATTERN: /^.{2,}(pur|pura|abad|garh|nagar|ganj|wadi|puram|patnam|bad|khand|vihar)$/,
            REPORTING_VERB_PATTERN: /^(says?|said|told?|tells?|ask(?:s|ed|ing)?|add(?:s|ed|ing)?|not(?:es?|ed|ing)|claim(?:s|ed|ing)?|alleg(?:es?|ed|ing)|announc(?:es?|ed|ing)|report(?:s|ed|ing)?|reveal(?:s|ed|ing)?|launch(?:es?|ed|ing)?|propos(?:es?|ed|ing)?|seek(?:s|ing)?|sought|call(?:s|ed|ing)?|urg(?:es?|ed|ing)|warn(?:s|ed|ing)?|declar(?:es?|ed|ing)|stat(?:es?|ed|ing)|confirm(?:s|ed|ing)?|den(?:y|ies|ied|ying)|admit(?:s|ted|ting)?|argu(?:es?|ed|ing)|believ(?:es?|ed|ing)|expect(?:s|ed|ing)?|hop(?:es?|ed|ing)|fear(?:s|ed|ing)?|demand(?:s|ed|ing)?|order(?:s|ed|ing)?|direct(?:s|ed|ing)?|pass(?:es|ed|ing)?|approv(?:es?|ed|ing)|impos(?:es?|ed|ing)|deliver(?:s|ed|ing)?|clear(?:s|ed|ing)?|review(?:s|ed|ing)?|uphold(?:s|ing)?|upheld|defer(?:s|red|ring)?|issu(?:es?|ed|ing)|fil(?:es?|ed|ing)|mov(?:es?|ed|ing)|grant(?:s|ed|ing)?|reject(?:s|ed|ing)?|dismiss(?:es|ed|ing)?|allow(?:s|ed|ing)?|ban(?:s|ned|ning)?|block(?:s|ed|ing)?|boost(?:s|ed|ing)?|slash(?:es|ed|ing)?|hik(?:es?|ed|ing)|scraps?|scrap(?:s|ped|ping)?)$/,
            ACTION_VERB_PATTERN: /^(get(?:s|ting)?|got|make(?:s|ing)?|made|tak(?:es?|ing)|took|taken|giv(?:es?|ing)|gave|given|come(?:s|ing)?|came|go(?:es|ing)?|went|gone|know(?:s|ing)?|knew|known|think(?:s|ing)?|thought|see(?:s|ing)?|saw|seen|want(?:s|ed|ing)?|use[ds]?|using|find(?:s|ing)?|found|put(?:s|ting)?|keep(?:s|ing)?|kept|let(?:s|ting)?|begin(?:s|ning)?|began|begun|set(?:s|ting)?|show(?:s|ed|ing)?|shown|bring(?:s|ing)?|brought|turn(?:s|ed|ing)?|start(?:s|ed|ing)?|run(?:s|ning)?|ran|meet(?:s|ing)?|met|pay(?:s|ing)?|paid|hear(?:s|ing)?|heard|play(?:s|ed|ing)?|stand(?:s|ing)?|stood|leav(?:es?|ing)|left|watch(?:es|ed|ing)?|feel(?:s|ing)?|felt|becom(?:es?|ing)|became|look(?:s|ed|ing)?|build(?:s|ing)?|built|face[ds]?|facing|join(?:s|ed|ing)?|hit(?:s|ting)?|pick(?:s|ed|ing)?|back(?:s|ed|ing)?|name[ds]?|naming|help(?:s|ed|ing)?|need(?:s|ed|ing)?|creat(?:es?|ed|ing)|form(?:s|ed|ing)?|hold(?:s|ing)?|held|open(?:s|ed|ing)?|clos(?:es?|ed|ing)|includ(?:es?|ed|ing)|continu(?:es?|ed|ing)|chang(?:es?|ed|ing)|provid(?:es?|ed|ing)|receiv(?:es?|ed|ing)|remain(?:s|ed|ing)?|rais(?:es?|ed|ing)|follow(?:s|ed|ing)?|requir(?:es?|ed|ing)|decid(?:es?|ed|ing)|return(?:s|ed|ing)?|explain(?:s|ed|ing)?|develop(?:s|ed|ing)?|support(?:s|ed|ing)?|present(?:s|ed|ing)?|discuss(?:es|ed|ing)?|tr(?:y|ies|ied|ying)|win(?:s|ning)?|won|los(?:es?|ing)|lost|liv(?:es?|ed|ing)|d(?:ie[ds]?|ying)|spend(?:s|ing)?|spent|grow(?:s|ing)?|grew|grown|stop(?:s|ped|ping)?|stay(?:s|ed|ing)?|fall(?:s|ing)?|fell|fallen|lead(?:s|ing)?|led|speak(?:s|ing)?|spoke|spoken|accept(?:s|ed|ing)?|carr(?:y|ies|ied|ying)|happen(?:s|ed|ing)?|writ(?:es?|ing)|wrote|written|sit(?:s|ting)?|sat|appear(?:s|ed|ing)?|cover(?:s|ed|ing)?|produc(?:es?|ed|ing)|represent(?:s|ed|ing)?|serv(?:es?|ed|ing)|appl(?:y|ies|ied|ying)|invest(?:s|ed|ing)?|shar(?:es?|ed|ing)|buy(?:s|ing)?|bought|sell(?:s|ing)?|sold|send(?:s|ing)?|sent|arrest(?:s|ed|ing)?|search(?:es|ed|ing)?|raid(?:s|ed|ing)?|push(?:es|ed|ing)?|pull(?:s|ed|ing)?)$/,
            GENERIC_MODIFIER_PATTERN: /^(major|minor|first|second|third|fourth|fifth|last|next|previous|current|recent|recently|early|late|soon|later|earlier|new|old|big|small|large|huge|great|good|better|best|bad|worse|worst|high|low|higher|lower|highest|lowest|top|full|empty|complete|total|entire|whole|final|initial|basic|simple|complex|easy|hard|difficult|strong|weak|fast|slow|quick|long|short|likely|unlikely|possible|impossible|necessary|available|ready|clear|real|true|false|right|wrong|free|special|general|specific|particular|certain|various|different|similar|same|other|important|significant|critical|crucial|essential|primary|secondary|political|national|international|local|global|foreign|domestic|regional|public|private|social|economic|financial|official|legal|civic)$/,
            GENERIC_NOUN_PATTERN: /^(government|minister|ministry|official|authority|department|committee|commission|council|agency|board|office|leader|member|people|person|citizen|country|nation|state|union|centre|center|action|issue|matter|party|group|team|system|level|area|region|zone|number|point|place|result|effect|impact|reason|cause|problem|solution|question|answer|decision|agreement|meeting|session|report|study|survey|review|analysis|detail|record|source|benefit|challenge|opportunity|concern|interest|target|effort|attempt|measure|scheme|project|program|initiative|mission|vision|statement|comment|response|message|service|sector|market|industry|company|business|growth|development|progress|process|reform|change|increase|decrease|crisis|situation|condition|status|event|incident|case|order|notice|rule|guideline|norm|right|freedom|power|role|position|world|society|community)$/,
            TIME_PATTERN: /^(year|years|month|months|week|weeks|day|days|today|yesterday|tomorrow|time|times|hour|hours|minute|minutes|second|seconds|morning|evening|night|monday|tuesday|wednesday|thursday|friday|saturday|sunday|january|february|march|april|june|july|august|september|october|november|december|annual|quarterly|daily|weekly|monthly|yearly|winter|summer|spring|autumn)$/,
            NUMBER_PATTERN: /^(one|two|three|four|five|six|seven|eight|nine|ten|eleven|twelve|hundred|thousand|million|billion|crore|lakh|percent|percentage|half|quarter|double|triple|single|multiple|several|many|much|few|little|more|most|less|least)$/,
            FILLER_PATTERN: /^(also|just|only|even|still|already|yet|ever|never|always|often|sometimes|usually|actually|really|certainly|definitely|probably|possibly|perhaps|maybe|obviously|clearly|apparently|however|therefore|moreover|furthermore|nevertheless|meanwhile|otherwise|instead|despite|regardless|whether|hence|thus|accordingly|basically|essentially|generally|normally|typically)$/,
            POLICY_INDICATORS: ['report', 'committee', 'commission', 'panel', 'act', 'bill', 'scheme', 'policy', 'tribunal', 'authority', 'board', 'council', 'mission', 'yojana', 'abhiyan', 'ordinance', 'amendment', 'framework', 'guidelines'],
            
            extractAcronyms(originalTitle) {
                const matches = originalTitle.match(/\b[A-Z]{2,6}\b/g) || [];
                const COMMON_CAPS = new Set(['THE', 'A', 'AN', 'IN', 'ON', 'AT', 'TO', 'FOR', 'OF', 'BY', 'AS', 'IS', 'IT', 'PM', 'CM', 'MP', 'AM']);
                return matches.filter(a => !COMMON_CAPS.has(a)).map(a => a.toLowerCase());
            },
            
            extractPolicyPhrases(originalTitle) {
                const phrases = [];
                const indicatorPattern = this.POLICY_INDICATORS.join('|');
                const regex = new RegExp(`\\b([A-Z][a-z]+(?:\\s+[A-Z][a-z]+)?)\\s+(${indicatorPattern})\\b`, 'gi');
                let match;
                while ((match = regex.exec(originalTitle)) !== null) {
                    phrases.push(match[0].toLowerCase().replace(/\s+/g, '-'));
                }
                const acronymRegex = new RegExp(`\\b([A-Z]{2,6})\\s+(${indicatorPattern})\\b`, 'gi');
                while ((match = acronymRegex.exec(originalTitle)) !== null) {
                    phrases.push(match[0].toLowerCase().replace(/\s+/g, '-'));
                }
                return phrases;
            },
            
            passesStructuralFilters(word) {
                if (word.length < 5) return false;
                if (this.PLACE_SUFFIX_PATTERN.test(word)) return false;
                if (this.REPORTING_VERB_PATTERN.test(word)) return false;
                if (this.ACTION_VERB_PATTERN.test(word)) return false;
                if (this.GENERIC_MODIFIER_PATTERN.test(word)) return false;
                if (this.GENERIC_NOUN_PATTERN.test(word)) return false;
                if (this.TIME_PATTERN.test(word)) return false;
                if (this.NUMBER_PATTERN.test(word)) return false;
                if (this.FILLER_PATTERN.test(word)) return false;
                return true;
            },
            
            extract(article) {
                const title = article.title || '';
                const keywords = [];
                keywords.push(...this.extractAcronyms(title));
                keywords.push(...this.extractPolicyPhrases(title));
                const words = title.toLowerCase().match(/\b[a-z]{5,}\b/g) || [];
                words.forEach(word => {
                    if (this.passesStructuralFilters(word)) keywords.push(word);
                });
                return [...new Set(keywords)];
            },
            
            calculateSpecificity(categoryDistribution) {
                const counts = Object.values(categoryDistribution);
                if (counts.length === 0) return 0;
                const total = counts.reduce((a, b) => a + b, 0);
                const max = Math.max(...counts);
                return max / total;
            },
            
            filterBySpecificity(keywordMap, threshold = 0.3) {
                const filtered = {};
                Object.entries(keywordMap).forEach(([keyword, data]) => {
                    const specificity = this.calculateSpecificity(data.categoryDistribution);
                    if (specificity >= threshold || keyword.includes('-') || data.isAcronym) {
                        filtered[keyword] = { ...data, specificity };
                    }
                });
                return filtered;
            }
        };
        
        let state = { articles: [], topicMap: {}, keywordMap: {}, currentView: 'galaxy', history: [], currentTopic: null, currentKeyword: null };
        let isDarkMode = true;
        
        function initTheme() {
            // Check both possible localStorage keys for cross-page sync
            const saved = localStorage.getItem('theme') || localStorage.getItem('policyradar-theme');
            
            if (saved === 'light') {
                document.documentElement.setAttribute('data-theme', 'light');
                isDarkMode = false;
                document.getElementById('theme-btn').textContent = 'üåô Dark Mode';
            } else if (saved === 'dark') {
                document.documentElement.removeAttribute('data-theme');
                isDarkMode = true;
                document.getElementById('theme-btn').textContent = '‚òÄÔ∏è Light Mode';
            } else if (window.matchMedia('(prefers-color-scheme: light)').matches) {
                document.documentElement.setAttribute('data-theme', 'light');
                isDarkMode = false;
                document.getElementById('theme-btn').textContent = 'üåô Dark Mode';
            }
            
            // Sync to both keys for cross-page compatibility
            if (saved) {
                localStorage.setItem('theme', saved);
                localStorage.setItem('policyradar-theme', saved);
            }
            
            // Auto-switch to tree view on mobile
            if (window.innerWidth < 641) {
                setView('tree');
            }
        }
        
        function toggleTheme() {
            isDarkMode = !isDarkMode;
            document.getElementById('theme-btn').textContent = isDarkMode ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
            const newTheme = isDarkMode ? 'dark' : 'light';
            if (isDarkMode) {
                document.documentElement.removeAttribute('data-theme');
            } else {
                document.documentElement.setAttribute('data-theme', 'light');
            }
            // Sync both localStorage keys
            localStorage.setItem('theme', newTheme);
            localStorage.setItem('policyradar-theme', newTheme);
        }
        
        // Listen for system preference changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
            if (!localStorage.getItem('theme') && !localStorage.getItem('policyradar-theme')) {
                isDarkMode = e.matches;
                if (e.matches) {
                    document.documentElement.removeAttribute('data-theme');
                } else {
                    document.documentElement.setAttribute('data-theme', 'light');
                }
                document.getElementById('theme-btn').textContent = isDarkMode ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
            }
        });
        
        // Auto-switch to tree view on mobile resize
        window.addEventListener('resize', () => {
            if (window.innerWidth < 641 && state.currentView === 'galaxy') {
                setView('tree');
            }
        });
        
        document.addEventListener('DOMContentLoaded', () => { initTheme(); loadData(); });
        
        async function loadData() {
            try {
                const response = await fetch('data/public_data.json');
                const data = await response.json();
                state.articles = data.articles || [];
                buildMaps();
                updateStats();
                renderCurrentView();
            } catch (e) { console.error(e); }
        }
        
        function buildMaps() {
            state.topicMap = {};
            const rawKeywordMap = {};
            
            state.articles.forEach(art => {
                const cat = art.category || 'Policy News';
                if (!state.topicMap[cat]) state.topicMap[cat] = { articles: [], keywords: {} };
                state.topicMap[cat].articles.push(art);
                
                KeywordExtractor.extract(art).forEach(kw => {
                    state.topicMap[cat].keywords[kw] = (state.topicMap[cat].keywords[kw] || 0) + 1;
                    
                    if (!rawKeywordMap[kw]) {
                        rawKeywordMap[kw] = { articles: [], categoryDistribution: {}, isAcronym: false };
                    }
                    rawKeywordMap[kw].articles.push(art);
                    rawKeywordMap[kw].categoryDistribution[cat] = (rawKeywordMap[kw].categoryDistribution[cat] || 0) + 1;
                    if (/^[a-z]{2,6}$/.test(kw) && art.title.includes(kw.toUpperCase())) {
                        rawKeywordMap[kw].isAcronym = true;
                    }
                });
            });
            
            // Apply specificity filter
            const filtered = KeywordExtractor.filterBySpecificity(rawKeywordMap, 0.3);
            state.keywordMap = {};
            Object.entries(filtered).forEach(([kw, data]) => {
                state.keywordMap[kw] = data.articles;
            });
        }
        
        function updateStats() {
            document.getElementById('stat-topics').textContent = Object.keys(state.topicMap).length;
            document.getElementById('stat-keywords').textContent = Object.keys(state.keywordMap).length;
            document.getElementById('stat-articles').textContent = state.articles.length.toLocaleString();
            document.getElementById('stat-sources').textContent = new Set(state.articles.map(a => a.source_name)).size;
        }
        
        function setView(view) {
            state.currentView = view;
            document.querySelectorAll('.view-btn').forEach(b => b.classList.toggle('active', b.dataset.view === view));
            if (state.currentTopic || state.currentKeyword) { state.history = []; state.currentTopic = null; state.currentKeyword = null; updateBreadcrumb(); }
            renderCurrentView();
        }
        
        function renderCurrentView() {
            ['galaxy-view','tree-view','cloud-view','topic-keywords-view','article-list'].forEach(id => document.getElementById(id).classList.add('hidden'));
            if (state.currentKeyword) renderArticles();
            else if (state.currentTopic) renderTopicKeywords();
            else if (state.currentView === 'galaxy') renderGalaxy();
            else if (state.currentView === 'tree') renderTree();
            else if (state.currentView === 'cloud') renderCloud();
        }
        
        function renderGalaxy() {
            const c = document.getElementById('galaxy-view'); c.classList.remove('hidden');
            const n = document.getElementById('topic-nodes'); n.innerHTML = '';
            const topics = Object.entries(state.topicMap).sort((a,b) => b[1].articles.length - a[1].articles.length);
            const cx = c.offsetWidth/2, cy = c.offsetHeight/2;
            topics.forEach(([t, d], i) => {
                const angle = (i/topics.length)*2*Math.PI - Math.PI/2;
                const r = 95 + (i%3)*70;
                const x = cx + r*Math.cos(angle), y = cy + r*Math.sin(angle);
                const node = document.createElement('div');
                node.className = 'topic-node';
                node.style.cssText = `left:${x}px;top:${y}px;transform:translate(-50%,-50%);border-color:${TOPIC_COLORS[t]||'#8b7cf7'};color:${TOPIC_COLORS[t]||'#8b7cf7'}`;
                node.innerHTML = `${esc(t)}<span class="topic-count">${d.articles.length}</span>`;
                node.onclick = () => selectTopic(t);
                n.appendChild(node);
            });
        }
        
        function renderTree() {
            const c = document.getElementById('tree-view'); c.classList.remove('hidden');
            c.innerHTML = Object.entries(state.topicMap).sort((a,b) => b[1].articles.length - a[1].articles.length).map(([t,d]) => {
                const kws = Object.entries(d.keywords).filter(([k,c]) => c>=2 && state.keywordMap[k]).sort((a,b) => b[1]-a[1]).slice(0,6);
                return `<div class="tree-card"><div class="tree-card-header"><div class="tree-card-title" style="color:${TOPIC_COLORS[t]||'#8b7cf7'}" onclick="selectTopic('${esc(t)}')">${esc(t)}</div><div class="tree-card-count">${d.articles.length}</div></div><div class="tree-keywords">${kws.map(([k])=>`<span class="keyword-chip size-sm" onclick="selectKeyword('${esc(k)}','${esc(t)}')">${esc(k)}</span>`).join('')}</div></div>`;
            }).join('');
        }
        
        function renderCloud() {
            const c = document.getElementById('cloud-view'); c.classList.remove('hidden');
            const kws = Object.entries(state.keywordMap).map(([k,a])=>({k,c:a.length})).filter(x=>x.c>=3).sort((a,b)=>b.c-a.c).slice(0,50);
            const max = kws[0]?.c || 1;
            c.innerHTML = kws.map(({k,c})=>{
                let sz='size-sm'; if(c>max*0.6)sz='size-xl'; else if(c>max*0.4)sz='size-lg'; else if(c>max*0.2)sz='';
                return `<span class="keyword-chip ${sz}" onclick="selectKeyword('${esc(k)}')">${esc(k)} (${c})</span>`;
            }).join('');
        }
        
        function selectTopic(t) { state.history.push({topic:state.currentTopic,keyword:state.currentKeyword}); state.currentTopic=t; state.currentKeyword=null; updateBreadcrumb(); renderCurrentView(); }
        
        function renderTopicKeywords() {
            const c = document.getElementById('topic-keywords-view'); c.classList.remove('hidden');
            const d = state.topicMap[state.currentTopic];
            document.getElementById('topic-header').innerHTML = `<h2 style="color:${TOPIC_COLORS[state.currentTopic]||'#8b7cf7'}">${esc(state.currentTopic)}</h2><p>${d.articles.length} articles</p>`;
            const kws = Object.entries(d.keywords).filter(([k,c])=>c>=2 && state.keywordMap[k]).sort((a,b)=>b[1]-a[1]).slice(0,40);
            const max = kws[0]?.[1] || 1;
            document.getElementById('topic-keywords').innerHTML = kws.map(([k,c])=>{
                let sz='size-sm'; if(c>max*0.6)sz='size-xl'; else if(c>max*0.4)sz='size-lg'; else if(c>max*0.2)sz='';
                return `<span class="keyword-chip ${sz}" onclick="selectKeyword('${esc(k)}','${esc(state.currentTopic)}')">${esc(k)} (${c})</span>`;
            }).join('');
        }
        
        function selectKeyword(k,t=null) { state.history.push({topic:state.currentTopic,keyword:state.currentKeyword}); if(t)state.currentTopic=t; state.currentKeyword=k; updateBreadcrumb(); renderCurrentView(); }
        
        function renderArticles() {
            const c = document.getElementById('article-list'); c.classList.remove('hidden');
            let arts = state.keywordMap[state.currentKeyword] || [];
            if (state.currentTopic) arts = arts.filter(a => a.category === state.currentTopic);
            arts = arts.sort((a,b) => (b.relevance_score||0) - (a.relevance_score||0));
            c.innerHTML = `<div class="topic-header"><h2>"${esc(state.currentKeyword)}"</h2><p>${arts.length} articles${state.currentTopic?` in ${state.currentTopic}`:''}</p></div>${arts.slice(0,30).map(a=>`<div class="article-card"><div class="article-source">${esc(a.source_name)}</div><div class="article-title"><a href="${esc(a.url)}" target="_blank">${esc(a.title)}</a></div>${a.summary?`<div class="article-summary">${esc(a.summary.slice(0,180))}...</div>`:''}<div class="article-meta"><span>${esc(a.category||'Policy News')}</span></div></div>`).join('')}`;
        }
        
        function goBack() { if(!state.history.length)return; const p=state.history.pop(); state.currentTopic=p.topic; state.currentKeyword=p.keyword; updateBreadcrumb(); renderCurrentView(); }
        
        function updateBreadcrumb() {
            document.getElementById('back-btn').disabled = !state.history.length;
            let h = `<span class="breadcrumb-item ${!state.currentTopic?'active':''}" onclick="navigateToRoot()">All Topics</span>`;
            if (state.currentTopic) h += `<span class="breadcrumb-sep">‚Ä∫</span><span class="breadcrumb-item ${!state.currentKeyword?'active':''}" onclick="navigateToTopic()">${esc(state.currentTopic)}</span>`;
            if (state.currentKeyword) h += `<span class="breadcrumb-sep">‚Ä∫</span><span class="breadcrumb-item active">${esc(state.currentKeyword)}</span>`;
            document.getElementById('breadcrumb').innerHTML = h;
        }
        
        function navigateToRoot() { state.history=[]; state.currentTopic=null; state.currentKeyword=null; updateBreadcrumb(); renderCurrentView(); }
        function navigateToTopic() { state.currentKeyword=null; updateBreadcrumb(); renderCurrentView(); }
        function esc(s) { if(!s)return''; const d=document.createElement('div'); d.textContent=s; return d.innerHTML; }
    </script>
</body>
</html>
