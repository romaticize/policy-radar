<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PolicyRadar - Topic Explorer</title>
    <style>
        :root {
            --bg-dark: #0a0a1a;
            --bg-card: #12122a;
            --text-primary: #e8e8f0;
            --text-secondary: #8888aa;
            --accent-1: #6366f1;
            --accent-2: #8b5cf6;
            --accent-3: #ec4899;
            --accent-4: #14b8a6;
            --accent-5: #f59e0b;
            --glow-1: rgba(99, 102, 241, 0.4);
            --glow-2: rgba(139, 92, 246, 0.4);
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Header */
        .header {
            padding: 1.5rem 2rem;
            background: linear-gradient(180deg, rgba(99,102,241,0.1) 0%, transparent 100%);
            border-bottom: 1px solid rgba(255,255,255,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .header-subtitle {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }
        
        .back-btn {
            padding: 0.5rem 1rem;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            color: var(--text-primary);
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
        }
        
        .back-btn:hover {
            background: rgba(255,255,255,0.1);
        }
        
        /* Main container */
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        /* Breadcrumb navigation */
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 2rem;
            font-size: 0.875rem;
        }
        
        .breadcrumb-item {
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .breadcrumb-item:hover {
            color: var(--text-primary);
            background: rgba(255,255,255,0.05);
        }
        
        .breadcrumb-item.active {
            color: var(--accent-1);
            font-weight: 600;
        }
        
        .breadcrumb-separator {
            color: var(--text-secondary);
            opacity: 0.5;
        }
        
        /* Stats bar */
        .stats-bar {
            display: flex;
            gap: 2rem;
            margin-bottom: 2rem;
            padding: 1rem 1.5rem;
            background: var(--bg-card);
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.05);
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Galaxy visualization container */
        .galaxy-container {
            position: relative;
            width: 100%;
            height: 70vh;
            min-height: 500px;
            background: radial-gradient(ellipse at center, rgba(99,102,241,0.05) 0%, transparent 70%);
            border-radius: 16px;
            overflow: hidden;
        }
        
        /* Central node */
        .central-node {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.875rem;
            text-align: center;
            padding: 1rem;
            cursor: pointer;
            box-shadow: 0 0 60px var(--glow-1), 0 0 100px var(--glow-2);
            animation: pulse 3s ease-in-out infinite;
            z-index: 10;
            transition: all 0.3s;
        }
        
        .central-node:hover {
            transform: translate(-50%, -50%) scale(1.1);
            box-shadow: 0 0 80px var(--glow-1), 0 0 120px var(--glow-2);
        }
        
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 60px var(--glow-1), 0 0 100px var(--glow-2); }
            50% { box-shadow: 0 0 80px var(--glow-1), 0 0 140px var(--glow-2); }
        }
        
        /* Orbit rings */
        .orbit {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 50%;
            pointer-events: none;
        }
        
        .orbit-1 { width: 300px; height: 300px; }
        .orbit-2 { width: 500px; height: 500px; }
        .orbit-3 { width: 700px; height: 700px; }
        
        /* Topic nodes */
        .topic-node {
            position: absolute;
            padding: 0.75rem 1.25rem;
            background: var(--bg-card);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            z-index: 5;
        }
        
        .topic-node:hover {
            transform: scale(1.1);
            border-color: var(--accent-1);
            box-shadow: 0 0 30px var(--glow-1);
        }
        
        .topic-node.active {
            background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
            border-color: transparent;
        }
        
        .topic-name {
            font-weight: 600;
            font-size: 0.875rem;
        }
        
        .topic-count {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-left: 0.5rem;
        }
        
        .topic-node.active .topic-count {
            color: rgba(255,255,255,0.7);
        }
        
        /* Connection lines */
        .connection-line {
            position: absolute;
            height: 2px;
            background: linear-gradient(90deg, var(--accent-1), transparent);
            transform-origin: left center;
            opacity: 0.3;
            pointer-events: none;
            z-index: 1;
        }
        
        /* Keyword cloud */
        .keyword-cloud {
            display: none;
            flex-wrap: wrap;
            gap: 0.75rem;
            justify-content: center;
            padding: 2rem;
            animation: fadeIn 0.3s ease;
        }
        
        .keyword-cloud.visible {
            display: flex;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .keyword-chip {
            padding: 0.5rem 1rem;
            background: var(--bg-card);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.875rem;
        }
        
        .keyword-chip:hover {
            border-color: var(--accent-1);
            background: rgba(99,102,241,0.1);
        }
        
        .keyword-chip.size-lg {
            font-size: 1rem;
            padding: 0.625rem 1.25rem;
            font-weight: 600;
        }
        
        .keyword-chip.size-md {
            font-size: 0.875rem;
        }
        
        .keyword-chip.size-sm {
            font-size: 0.75rem;
            padding: 0.375rem 0.75rem;
            color: var(--text-secondary);
        }
        
        /* Article list */
        .article-list {
            display: none;
            flex-direction: column;
            gap: 1rem;
            padding: 1rem 0;
            animation: fadeIn 0.3s ease;
        }
        
        .article-list.visible {
            display: flex;
        }
        
        .article-card {
            padding: 1.25rem;
            background: var(--bg-card);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 12px;
            transition: all 0.2s;
        }
        
        .article-card:hover {
            border-color: rgba(255,255,255,0.1);
            transform: translateX(4px);
        }
        
        .article-source {
            font-size: 0.75rem;
            color: var(--accent-1);
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .article-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }
        
        .article-title a {
            color: var(--text-primary);
            text-decoration: none;
        }
        
        .article-title a:hover {
            color: var(--accent-1);
        }
        
        .article-summary {
            font-size: 0.875rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }
        
        .article-meta {
            display: flex;
            gap: 1rem;
            margin-top: 0.75rem;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        /* Sunburst/Radial tree visualization */
        .sunburst-container {
            width: 100%;
            height: 70vh;
            min-height: 600px;
        }
        
        .sunburst-container svg {
            width: 100%;
            height: 100%;
        }
        
        /* Instructions */
        .instructions {
            text-align: center;
            padding: 1rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }
        
        .instructions span {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            background: rgba(255,255,255,0.05);
            border-radius: 4px;
            margin: 0 0.25rem;
        }
        
        /* View toggle */
        .view-toggle {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        .view-btn {
            padding: 0.5rem 1rem;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
        }
        
        .view-btn:hover {
            background: rgba(255,255,255,0.1);
            color: var(--text-primary);
        }
        
        .view-btn.active {
            background: var(--accent-1);
            border-color: var(--accent-1);
            color: white;
        }
        
        /* Loading */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 400px;
            color: var(--text-secondary);
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255,255,255,0.1);
            border-top-color: var(--accent-1);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .galaxy-container { height: 50vh; }
            .central-node { width: 80px; height: 80px; font-size: 0.75rem; }
            .orbit-1 { width: 200px; height: 200px; }
            .orbit-2 { width: 320px; height: 320px; }
            .orbit-3 { width: 440px; height: 440px; }
            .topic-node { padding: 0.5rem 0.75rem; font-size: 0.75rem; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div>
            <div class="logo">üî≠ PolicyRadar Topic Explorer</div>
            <div class="header-subtitle">Interactive Knowledge Graph</div>
        </div>
        <div style="display: flex; gap: 0.5rem;">
            <a href="index.html" class="back-btn">üìä Dashboard</a>
            <a href="knowledge-graph.html" class="back-btn">üï∏Ô∏è Force Graph</a>
        </div>
    </header>
    
    <div class="container">
        <div class="breadcrumb" id="breadcrumb">
            <span class="breadcrumb-item active" onclick="navigateTo('root')">All Topics</span>
        </div>
        
        <div class="stats-bar" id="stats-bar">
            <div class="stat">
                <div class="stat-value" id="stat-topics">-</div>
                <div class="stat-label">Topic Clusters</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="stat-keywords">-</div>
                <div class="stat-label">Keywords</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="stat-articles">-</div>
                <div class="stat-label">Articles</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="stat-sources">-</div>
                <div class="stat-label">Sources</div>
            </div>
        </div>
        
        <div class="view-toggle">
            <button class="view-btn active" onclick="setView('galaxy')" data-view="galaxy">üåå Galaxy View</button>
            <button class="view-btn" onclick="setView('tree')" data-view="tree">üå≥ Tree View</button>
            <button class="view-btn" onclick="setView('cloud')" data-view="cloud">‚òÅÔ∏è Cloud View</button>
        </div>
        
        <div class="instructions">
            Click on <span>topics</span> to explore keywords ‚Üí Click on <span>keywords</span> to see articles
        </div>
        
        <!-- Galaxy View -->
        <div class="galaxy-container" id="galaxy-view">
            <div class="orbit orbit-1"></div>
            <div class="orbit orbit-2"></div>
            <div class="orbit orbit-3"></div>
            <div class="central-node" id="central-node">Policy Universe</div>
            <div id="topic-nodes"></div>
            <div id="connection-lines"></div>
        </div>
        
        <!-- Keyword Cloud (shown when topic selected) -->
        <div class="keyword-cloud" id="keyword-cloud"></div>
        
        <!-- Article List (shown when keyword selected) -->
        <div class="article-list" id="article-list"></div>
    </div>
    
    <script>
        // Configuration
        const CONFIG = {
            dataUrl: 'data/public_data.json'
        };
        
        // State
        let state = {
            articles: [],
            topicMap: {},
            keywordMap: {},
            currentView: 'galaxy',
            currentLevel: 'root', // root, topic, keyword
            currentTopic: null,
            currentKeyword: null
        };
        
        // Topic definitions with colors
        const TOPIC_COLORS = {
            'Economic Policy': '#6366f1',
            'Trade & Industry': '#8b5cf6',
            'Constitutional & Legal': '#ec4899',
            'Technology': '#14b8a6',
            'Healthcare': '#10b981',
            'Defence': '#f59e0b',
            'Governance': '#ef4444',
            'Politics': '#f97316',
            'Policy News': '#64748b'
        };
        
        // Initialize
        document.addEventListener('DOMContentLoaded', loadData);
        
        async function loadData() {
            try {
                const response = await fetch(CONFIG.dataUrl);
                const data = await response.json();
                state.articles = data.articles || [];
                
                buildTopicMap();
                buildKeywordMap();
                updateStats();
                renderGalaxy();
            } catch (error) {
                console.error('Failed to load data:', error);
                document.getElementById('galaxy-view').innerHTML = 
                    '<div class="loading"><p>Failed to load data. Please refresh.</p></div>';
            }
        }
        
        function buildTopicMap() {
            state.topicMap = {};
            
            state.articles.forEach(article => {
                const category = article.category || 'Policy News';
                if (!state.topicMap[category]) {
                    state.topicMap[category] = {
                        articles: [],
                        keywords: new Set()
                    };
                }
                state.topicMap[category].articles.push(article);
                
                // Extract keywords from title
                const keywords = extractKeywords(article.title);
                keywords.forEach(kw => state.topicMap[category].keywords.add(kw));
            });
        }
        
        function buildKeywordMap() {
            state.keywordMap = {};
            
            state.articles.forEach(article => {
                const keywords = extractKeywords(article.title + ' ' + (article.summary || ''));
                keywords.forEach(kw => {
                    if (!state.keywordMap[kw]) {
                        state.keywordMap[kw] = [];
                    }
                    state.keywordMap[kw].push(article);
                });
            });
        }
        
        function extractKeywords(text) {
            const stopWords = new Set([
                // Common English stop words
                'the', 'a', 'an', 'and', 'or', 'but', 'in', 'on', 'at', 'to', 'for',
                'of', 'with', 'by', 'from', 'as', 'is', 'was', 'are', 'were', 'be',
                'have', 'has', 'had', 'do', 'does', 'did', 'will', 'would', 'could',
                'should', 'may', 'might', 'must', 'shall', 'can', 'need', 'dare',
                'ought', 'used', 'being', 'been', 'am', 'isn', 'aren', 'wasn', 'weren',
                'haven', 'hasn', 'hadn', 'doesn', 'didn', 'won', 'wouldn', 'couldn',
                'shouldn', 'mightn', 'mustn', 'that', 'this', 'these', 'those',
                'it', 'its', 'they', 'them', 'their', 'theirs', 'he', 'him', 'his',
                'she', 'her', 'hers', 'we', 'us', 'our', 'ours', 'you', 'your', 'yours',
                'i', 'me', 'my', 'mine', 'who', 'whom', 'whose', 'which', 'what',
                'where', 'when', 'why', 'how', 'all', 'each', 'every', 'both', 'few',
                'more', 'most', 'other', 'some', 'such', 'no', 'nor', 'not', 'only',
                'own', 'same', 'so', 'than', 'too', 'very', 'just', 'also', 'now',
                'here', 'there', 'then', 'once', 'if', 'unless', 'until', 'while',
                'although', 'though', 'because', 'since', 'after', 'before', 'during',
                'about', 'into', 'through', 'above', 'below', 'up', 'down', 'out',
                'off', 'over', 'under', 'again', 'further', 'any', 'another',
                // News/report words
                'says', 'said', 'saying', 'say', 'told', 'tell', 'tells', 'telling',
                'according', 'report', 'reports', 'reported', 'reporting', 'news',
                'new', 'latest', 'update', 'updates', 'updated', 'story', 'stories',
                'article', 'read', 'reads', 'click', 'here', 'more', 'view', 'views',
                'announces', 'announced', 'announcing', 'announcement', 'reveal',
                'reveals', 'revealed', 'unveils', 'unveiled', 'launches', 'launched',
                'introduces', 'introduced', 'proposes', 'proposed', 'seeks', 'sought',
                'plans', 'planned', 'planning', 'aims', 'aimed', 'aiming', 'targets',
                // Generic verbs
                'get', 'gets', 'got', 'getting', 'make', 'makes', 'made', 'making',
                'take', 'takes', 'took', 'taken', 'taking', 'come', 'comes', 'came',
                'coming', 'go', 'goes', 'went', 'gone', 'going', 'know', 'knows',
                'knew', 'known', 'knowing', 'think', 'thinks', 'thought', 'thinking',
                'see', 'sees', 'saw', 'seen', 'seeing', 'want', 'wants', 'wanted',
                'wanting', 'use', 'uses', 'used', 'using', 'find', 'finds', 'found',
                'finding', 'give', 'gives', 'gave', 'given', 'giving', 'put', 'puts',
                'putting', 'set', 'sets', 'setting', 'keep', 'keeps', 'kept', 'keeping',
                'let', 'lets', 'letting', 'begin', 'begins', 'began', 'begun', 'call',
                'calls', 'called', 'calling', 'try', 'tries', 'tried', 'trying',
                'ask', 'asks', 'asked', 'asking', 'work', 'works', 'worked', 'working',
                'seem', 'seems', 'seemed', 'seeming', 'feel', 'feels', 'felt', 'feeling',
                'become', 'becomes', 'became', 'becoming', 'leave', 'leaves', 'left',
                'show', 'shows', 'showed', 'shown', 'showing', 'move', 'moves', 'moved',
                'bring', 'brings', 'brought', 'turn', 'turns', 'turned', 'add', 'adds',
                'added', 'adding', 'raise', 'raises', 'raised', 'raising', 'allow',
                'allows', 'allowed', 'consider', 'considers', 'considered', 'expect',
                'expects', 'expected', 'continue', 'continues', 'continued', 'remain',
                'remains', 'remained', 'offer', 'offers', 'offered', 'receive',
                'receives', 'received', 'provide', 'provides', 'provided', 'create',
                'creates', 'created', 'send', 'sends', 'sent', 'build', 'builds',
                'built', 'run', 'runs', 'running', 'meet', 'meets', 'met', 'pay',
                'pays', 'paid', 'hear', 'hears', 'heard', 'play', 'plays', 'played',
                'agree', 'agrees', 'agreed', 'reach', 'reaches', 'reached', 'stand',
                'stands', 'stood', 'lose', 'loses', 'lost', 'win', 'wins', 'won',
                'claim', 'claims', 'claimed', 'drop', 'drops', 'dropped',
                // Time/place words
                'year', 'years', 'month', 'months', 'week', 'weeks', 'day', 'days',
                'today', 'yesterday', 'tomorrow', 'time', 'times', 'first', 'last',
                'next', 'previous', 'current', 'recent', 'recently', 'early', 'late',
                'soon', 'later', 'earlier', 'already', 'still', 'yet', 'ever', 'never',
                'always', 'often', 'sometimes', 'usually', 'long', 'short', 'near',
                'far', 'away', 'back', 'front', 'top', 'bottom', 'side', 'around',
                'across', 'along', 'behind', 'between', 'among', 'within', 'without',
                // Numbers and amounts
                'one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight', 'nine',
                'ten', 'hundred', 'thousand', 'million', 'billion', 'crore', 'lakh',
                'many', 'much', 'several', 'various', 'different', 'less', 'least',
                'little', 'big', 'small', 'large', 'high', 'low', 'great', 'good',
                'well', 'better', 'best', 'bad', 'worse', 'worst', 'old', 'young',
                'major', 'minor', 'full', 'half', 'double', 'single', 'whole', 'total',
                'entire', 'complete', 'key', 'main', 'special', 'important',
                // India/government generic
                'india', 'indian', 'indians', 'country', 'countries', 'nation',
                'national', 'state', 'states', 'central', 'government', 'govt',
                'minister', 'ministers', 'ministry', 'ministries', 'official',
                'officials', 'authority', 'authorities', 'department', 'public',
                'people', 'person', 'persons', 'citizen', 'citizens',
                // Legal generic
                'court', 'courts', 'supreme', 'high', 'bench', 'justice', 'judge',
                'judges', 'case', 'cases', 'order', 'orders', 'petition', 'plea',
                'hearing', 'verdict', 'ruling', 'law', 'laws', 'legal', 'act', 'acts',
                'section', 'rule', 'rules', 'policy', 'policies', 'bill', 'bills',
                // Action words
                'action', 'against', 'issue', 'issues', 'issued', 'matter', 'matters',
                'part', 'parts', 'place', 'places', 'point', 'points', 'way', 'ways',
                'end', 'ends', 'start', 'starts', 'started', 'help', 'helps', 'helped',
                'need', 'needs', 'needed', 'include', 'includes', 'included', 'hold',
                'holds', 'held', 'holding', 'face', 'faces', 'faced', 'facing',
                // Miscellaneous
                'like', 'likely', 'even', 'however', 'meanwhile', 'also', 'already',
                'following', 'follow', 'follows', 'followed', 'based', 'base',
                'despite', 'amid', 'among', 'per', 'via', 'versus', 'etc', 'including',
                // More common news words
                'centre', 'center', 'party', 'parties', 'election', 'elections', 'vote',
                'votes', 'voting', 'congress', 'house', 'senate', 'parliament',
                'video', 'photo', 'image', 'picture', 'media', 'press', 'paper',
                'release', 'releases', 'released', 'statement', 'statements',
                'world', 'global', 'local', 'foreign', 'domestic', 'international',
                'north', 'south', 'east', 'west', 'region', 'regions', 'district',
                'city', 'cities', 'town', 'towns', 'village', 'villages', 'area', 'areas',
                'project', 'projects', 'program', 'programs', 'scheme', 'schemes',
                'system', 'systems', 'service', 'services', 'product', 'products',
                'decision', 'decisions', 'change', 'changes', 'reform', 'reforms',
                'measure', 'measures', 'process', 'processes', 'procedure', 'procedures',
                'review', 'reviews', 'survey', 'surveys', 'meeting', 'meetings',
                'conference', 'conferences', 'summit', 'agreement', 'agreements',
                'contract', 'contracts', 'treaty', 'talks', 'discussions', 'negotiations',
                'security', 'safety', 'protection', 'rights', 'right', 'development',
                'growth', 'progress', 'future', 'past', 'present', 'situation',
                'condition', 'conditions', 'status', 'position', 'performance',
                'result', 'results', 'outcome', 'outcomes', 'problem', 'problems',
                'challenge', 'challenges', 'opportunity', 'opportunities', 'benefit',
                'benefits', 'advantage', 'focus', 'focuses', 'priority', 'priorities',
                'target', 'targets', 'message', 'messages', 'comment', 'comments',
                'response', 'responses', 'question', 'questions', 'answer', 'answers',
                'request', 'requests', 'proposal', 'proposals', 'option', 'options',
                'choice', 'choices', 'percent', 'percentage', 'increase', 'increases',
                'decrease', 'decreases', 'higher', 'lower', 'rising', 'falling',
                'biggest', 'largest', 'smallest', 'record', 'records', 'data', 'details',
                'information', 'fact', 'facts', 'leader', 'leaders', 'chief', 'head',
                'board', 'council', 'committee', 'commission', 'agency', 'body',
                'unit', 'office', 'bureau', 'company', 'companies', 'firm', 'firms',
                'business', 'businesses', 'industry', 'industries', 'sector', 'sectors',
                'market', 'markets', 'share', 'shares', 'stock', 'stocks', 'price',
                'prices', 'rate', 'rates', 'profit', 'profits', 'loss', 'losses',
                'revenue', 'sales', 'deal', 'deals', 'fund', 'funds', 'investment',
                'quarter', 'fiscal', 'financial', 'annual', 'monthly', 'daily'
            ]);
            
            const words = text.toLowerCase().match(/\b[a-z]{6,}\b/g) || [];
            return words.filter(w => !stopWords.has(w) && w.length >= 6);
        }
        
        function updateStats() {
            document.getElementById('stat-topics').textContent = Object.keys(state.topicMap).length;
            document.getElementById('stat-keywords').textContent = Object.keys(state.keywordMap).length;
            document.getElementById('stat-articles').textContent = state.articles.length;
            
            const sources = new Set(state.articles.map(a => a.source_name));
            document.getElementById('stat-sources').textContent = sources.size;
        }
        
        function renderTree() {
            const container = document.getElementById('galaxy-view');
            container.style.display = 'block';
            document.getElementById('keyword-cloud').classList.remove('visible');
            document.getElementById('article-list').classList.remove('visible');
            
            // Build tree structure
            const topics = Object.entries(state.topicMap)
                .sort((a, b) => b[1].articles.length - a[1].articles.length);
            
            let html = '<div style="padding: 2rem; display: flex; flex-wrap: wrap; gap: 1.5rem; justify-content: center;">';
            
            topics.forEach(([topic, data]) => {
                const color = TOPIC_COLORS[topic] || '#6366f1';
                const topKeywords = getTopKeywords(data.articles, 6);
                
                html += `
                    <div style="background: var(--bg-card); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 1rem; min-width: 200px; max-width: 280px;">
                        <div style="font-weight: 700; color: ${color}; margin-bottom: 0.5rem; cursor: pointer;" onclick="selectTopic('${escapeHtml(topic)}')">${escapeHtml(topic)}</div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.75rem;">${data.articles.length} articles</div>
                        <div style="display: flex; flex-wrap: wrap; gap: 0.375rem;">
                            ${topKeywords.map(kw => `<span class="keyword-chip size-sm" onclick="selectKeyword('${escapeHtml(kw)}', '${escapeHtml(topic)}')">${escapeHtml(kw)}</span>`).join('')}
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        function getTopKeywords(articles, limit) {
            const counts = {};
            articles.forEach(a => {
                extractKeywords(a.title).forEach(kw => {
                    counts[kw] = (counts[kw] || 0) + 1;
                });
            });
            return Object.entries(counts)
                .filter(([kw, count]) => count >= 3)
                .sort((a, b) => b[1] - a[1])
                .slice(0, limit)
                .map(([kw]) => kw);
        }
        
        function setView(view) {
            state.currentView = view;
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.view === view);
            });
            
            if (state.currentLevel === 'root') {
                if (view === 'galaxy') renderGalaxy();
                else if (view === 'tree') renderTree();
                else if (view === 'cloud') renderCloud();
            }
        }
        
        function renderGalaxy() {
            const container = document.getElementById('galaxy-view');
            container.style.display = 'block';
            document.getElementById('keyword-cloud').classList.remove('visible');
            document.getElementById('article-list').classList.remove('visible');
            
            const nodesContainer = document.getElementById('topic-nodes');
            const linesContainer = document.getElementById('connection-lines');
            nodesContainer.innerHTML = '';
            linesContainer.innerHTML = '';
            
            const topics = Object.entries(state.topicMap)
                .sort((a, b) => b[1].articles.length - a[1].articles.length);
            
            const centerX = container.offsetWidth / 2;
            const centerY = container.offsetHeight / 2;
            
            topics.forEach(([topic, data], index) => {
                const angle = (index / topics.length) * 2 * Math.PI - Math.PI / 2;
                const radius = 150 + (index % 3) * 100;
                
                const x = centerX + radius * Math.cos(angle);
                const y = centerY + radius * Math.sin(angle);
                
                const node = document.createElement('div');
                node.className = 'topic-node';
                node.style.left = `${x}px`;
                node.style.top = `${y}px`;
                node.style.transform = 'translate(-50%, -50%)';
                node.style.borderColor = TOPIC_COLORS[topic] || '#6366f1';
                node.innerHTML = `
                    <span class="topic-name">${escapeHtml(topic)}</span>
                    <span class="topic-count">${data.articles.length}</span>
                `;
                node.onclick = () => selectTopic(topic);
                nodesContainer.appendChild(node);
                
                // Draw connection line
                const line = document.createElement('div');
                line.className = 'connection-line';
                const dx = x - centerX;
                const dy = y - centerY;
                const length = Math.sqrt(dx * dx + dy * dy) - 60;
                const lineAngle = Math.atan2(dy, dx) * 180 / Math.PI;
                line.style.left = `${centerX}px`;
                line.style.top = `${centerY}px`;
                line.style.width = `${length}px`;
                line.style.transform = `rotate(${lineAngle}deg)`;
                line.style.background = `linear-gradient(90deg, ${TOPIC_COLORS[topic] || '#6366f1'}, transparent)`;
                linesContainer.appendChild(line);
            });
        }
        
        function renderCloud() {
            const container = document.getElementById('galaxy-view');
            container.style.display = 'none';
            
            const cloudContainer = document.getElementById('keyword-cloud');
            cloudContainer.classList.add('visible');
            document.getElementById('article-list').classList.remove('visible');
            
            // Get top keywords
            const keywordCounts = Object.entries(state.keywordMap)
                .map(([kw, articles]) => ({ keyword: kw, count: articles.length }))
                .filter(k => k.count >= 4)
                .sort((a, b) => b.count - a.count)
                .slice(0, 50);
            
            const maxCount = keywordCounts[0]?.count || 1;
            
            cloudContainer.innerHTML = keywordCounts.map(({ keyword, count }) => {
                const size = count > maxCount * 0.7 ? 'lg' : count > maxCount * 0.3 ? 'md' : 'sm';
                return `<span class="keyword-chip size-${size}" onclick="selectKeyword('${escapeHtml(keyword)}')">${escapeHtml(keyword)} (${count})</span>`;
            }).join('');
        }
        
        function selectTopic(topic) {
            state.currentLevel = 'topic';
            state.currentTopic = topic;
            
            updateBreadcrumb();
            
            const container = document.getElementById('galaxy-view');
            container.style.display = 'none';
            
            const cloudContainer = document.getElementById('keyword-cloud');
            cloudContainer.classList.add('visible');
            document.getElementById('article-list').classList.remove('visible');
            
            const topicData = state.topicMap[topic];
            
            // Count keywords within this topic
            const keywordCounts = {};
            topicData.articles.forEach(article => {
                const keywords = extractKeywords(article.title);
                keywords.forEach(kw => {
                    keywordCounts[kw] = (keywordCounts[kw] || 0) + 1;
                });
            });
            
            const sortedKeywords = Object.entries(keywordCounts)
                .filter(([kw, count]) => count >= 3)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 30);
            
            const maxCount = sortedKeywords[0]?.[1] || 1;
            
            cloudContainer.innerHTML = `
                <div style="width: 100%; text-align: center; margin-bottom: 1rem;">
                    <h3 style="color: ${TOPIC_COLORS[topic]}; margin-bottom: 0.5rem;">${escapeHtml(topic)}</h3>
                    <p style="color: var(--text-secondary); font-size: 0.875rem;">${topicData.articles.length} articles</p>
                </div>
                ${sortedKeywords.map(([kw, count]) => {
                    const size = count > maxCount * 0.7 ? 'lg' : count > maxCount * 0.3 ? 'md' : 'sm';
                    return `<span class="keyword-chip size-${size}" onclick="selectKeyword('${escapeHtml(kw)}', '${escapeHtml(topic)}')">${escapeHtml(kw)} (${count})</span>`;
                }).join('')}
            `;
        }
        
        function selectKeyword(keyword, topic = null) {
            state.currentLevel = 'keyword';
            state.currentKeyword = keyword;
            
            updateBreadcrumb();
            
            document.getElementById('galaxy-view').style.display = 'none';
            document.getElementById('keyword-cloud').classList.remove('visible');
            
            const listContainer = document.getElementById('article-list');
            listContainer.classList.add('visible');
            
            // Get articles matching this keyword
            let articles = state.keywordMap[keyword] || [];
            
            // If topic filter, also filter by category
            if (topic) {
                articles = articles.filter(a => a.category === topic);
            }
            
            // Sort by relevance
            articles = articles.sort((a, b) => (b.relevance_score || 0) - (a.relevance_score || 0));
            
            listContainer.innerHTML = `
                <div style="text-align: center; margin-bottom: 1rem;">
                    <h3 style="color: var(--accent-1);">Articles mentioning "${escapeHtml(keyword)}"</h3>
                    <p style="color: var(--text-secondary); font-size: 0.875rem;">${articles.length} articles found</p>
                </div>
                ${articles.slice(0, 20).map(article => `
                    <div class="article-card">
                        <div class="article-source">${escapeHtml(article.source_name)}</div>
                        <div class="article-title">
                            <a href="${escapeHtml(article.url)}" target="_blank">${escapeHtml(article.title)}</a>
                        </div>
                        ${article.summary ? `<div class="article-summary">${escapeHtml(article.summary.slice(0, 200))}...</div>` : ''}
                        <div class="article-meta">
                            <span>${escapeHtml(article.category || 'Policy News')}</span>
                            <span>${formatDate(article.publication_date)}</span>
                        </div>
                    </div>
                `).join('')}
            `;
        }
        
        function navigateTo(level) {
            if (level === 'root') {
                state.currentLevel = 'root';
                state.currentTopic = null;
                state.currentKeyword = null;
                
                document.getElementById('keyword-cloud').classList.remove('visible');
                document.getElementById('article-list').classList.remove('visible');
                
                if (state.currentView === 'galaxy') renderGalaxy();
                else if (state.currentView === 'cloud') renderCloud();
            } else if (level === 'topic' && state.currentTopic) {
                selectTopic(state.currentTopic);
            }
            
            updateBreadcrumb();
        }
        
        function updateBreadcrumb() {
            const container = document.getElementById('breadcrumb');
            let html = `<span class="breadcrumb-item ${state.currentLevel === 'root' ? 'active' : ''}" onclick="navigateTo('root')">All Topics</span>`;
            
            if (state.currentTopic) {
                html += `<span class="breadcrumb-separator">‚Ä∫</span>`;
                html += `<span class="breadcrumb-item ${state.currentLevel === 'topic' ? 'active' : ''}" onclick="navigateTo('topic')">${escapeHtml(state.currentTopic)}</span>`;
            }
            
            if (state.currentKeyword) {
                html += `<span class="breadcrumb-separator">‚Ä∫</span>`;
                html += `<span class="breadcrumb-item active">${escapeHtml(state.currentKeyword)}</span>`;
            }
            
            container.innerHTML = html;
        }
        
        function formatDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-IN', { month: 'short', day: 'numeric' });
        }
        
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
