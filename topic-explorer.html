<!DOCTYPE html>
<html lang="en-IN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Topic Explorer - PolicyRadar</title>
    <meta name="description" content="Explore trending policy topics and keywords across Indian government and regulatory news.">
    <link rel="canonical" href="https://policyradar.in/topic-explorer.html">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Topic Explorer - PolicyRadar">
    <meta property="og:description" content="Explore trending policy topics and keywords.">
    <meta property="og:type" content="website">
    
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ”­</text></svg>">
    
    <style>
        /* ========================================
           CSS CUSTOM PROPERTIES
           ======================================== */
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-card: #ffffff;
            --text-primary: #111827;
            --text-secondary: #374151;
            --text-muted: #6b7280;
            --border-color: #e5e7eb;
            --accent-primary: #2563eb;
            --accent-secondary: #3b82f6;
            --accent-glow: rgba(37, 99, 235, 0.15);
            
            /* Category Colors */
            --cat-finance: #2563eb;
            --cat-tax: #7c3aed;
            --cat-trade: #059669;
            --cat-digital: #0891b2;
            --cat-infra: #d97706;
            --cat-energy: #16a34a;
            --cat-labour: #dc2626;
            --cat-health: #db2777;
            --cat-education: #4f46e5;
            --cat-agri: #65a30d;
            --cat-corporate: #0284c7;
            --cat-governance: #7c2d12;
            
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.07);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.1);
            
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 16px;
            --radius-full: 9999px;
            
            --header-height: 64px;
        }
        
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-primary: #0f172a;
                --bg-secondary: #1e293b;
                --bg-card: #1e293b;
                --text-primary: #f1f5f9;
                --text-secondary: #cbd5e1;
                --text-muted: #94a3b8;
                --border-color: #334155;
                --accent-glow: rgba(59, 130, 246, 0.2);
            }
        }
        
        /* ========================================
           RESET & BASE
           ======================================== */
        *, *::before, *::after {
            box-sizing: border-box;
        }
        
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        /* ========================================
           HEADER
           ======================================== */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 1.5rem;
            z-index: 100;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .back-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            text-decoration: none;
            font-size: 0.875rem;
            transition: all 0.2s;
        }
        
        .back-btn:hover {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }
        
        .logo {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--accent-primary);
        }
        
        .header-center {
            flex: 1;
            max-width: 400px;
            margin: 0 1rem;
        }
        
        .search-container {
            position: relative;
        }
        
        .search-input {
            width: 100%;
            padding: 0.625rem 1rem 0.625rem 2.5rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 0.875rem;
            outline: none;
            transition: all 0.2s;
        }
        
        .search-input:focus {
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }
        
        .search-icon {
            position: absolute;
            left: 0.875rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            pointer-events: none;
        }
        
        .search-shortcut {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            padding: 0.125rem 0.375rem;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .view-toggle {
            display: flex;
            background: var(--bg-secondary);
            border-radius: var(--radius-sm);
            border: 1px solid var(--border-color);
            overflow: hidden;
        }
        
        .view-btn {
            padding: 0.5rem 0.75rem;
            border: none;
            background: transparent;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .view-btn.active {
            background: var(--accent-primary);
            color: white;
        }
        
        .view-btn:hover:not(.active) {
            background: var(--border-color);
        }
        
        .time-filter {
            display: flex;
            gap: 0.25rem;
            background: var(--bg-secondary);
            border-radius: var(--radius-sm);
            padding: 0.25rem;
            border: 1px solid var(--border-color);
        }
        
        .time-btn {
            padding: 0.375rem 0.625rem;
            border: none;
            background: transparent;
            color: var(--text-muted);
            font-size: 0.75rem;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .time-btn.active {
            background: var(--accent-primary);
            color: white;
        }
        
        /* ========================================
           MAIN CONTENT
           ======================================== */
        .main {
            margin-top: var(--header-height);
            min-height: calc(100vh - var(--header-height));
            padding: 1.5rem;
        }
        
        /* ========================================
           GALAXY VIEW (Desktop)
           ======================================== */
        .galaxy-view {
            display: none;
            position: relative;
            width: 100%;
            height: calc(100vh - var(--header-height) - 1rem);
            overflow: hidden;
        }
        
        .galaxy-view.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .galaxy-container {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: 1400px;
        }
        
        .galaxy-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 0.875rem;
            text-align: center;
            box-shadow: 0 0 60px var(--accent-glow);
            z-index: 10;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .galaxy-center:hover {
            transform: translate(-50%, -50%) scale(1.05);
        }
        
        .orbit {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 1px dashed var(--border-color);
            border-radius: 50%;
            pointer-events: none;
            opacity: 0.4;
        }
        
        .orbit-1 { border-color: rgba(37, 99, 235, 0.3); }
        .orbit-2 { border-color: rgba(37, 99, 235, 0.2); }
        .orbit-3 { border-color: rgba(37, 99, 235, 0.15); }
        
        .topic-node {
            position: absolute;
            transform: translate(-50%, -50%);
            padding: 0.5rem 1rem;
            background: var(--bg-card);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-full);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            z-index: 5;
            box-shadow: var(--shadow-sm);
        }
        
        .topic-node:hover {
            transform: translate(-50%, -50%) scale(1.1);
            box-shadow: var(--shadow-lg);
            z-index: 20;
        }
        
        .topic-node.highlighted {
            border-color: var(--accent-primary);
            background: var(--accent-glow);
        }
        
        .topic-node .count {
            display: inline-block;
            margin-left: 0.5rem;
            padding: 0.125rem 0.375rem;
            background: var(--accent-primary);
            color: white;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
        }
        
        /* Category-specific colors */
        .topic-node[data-category="Finance & Banking"] { border-color: var(--cat-finance); }
        .topic-node[data-category="Taxation"] { border-color: var(--cat-tax); }
        .topic-node[data-category="Trade & Commerce"] { border-color: var(--cat-trade); }
        .topic-node[data-category="Digital & Technology"] { border-color: var(--cat-digital); }
        .topic-node[data-category="Infrastructure"] { border-color: var(--cat-infra); }
        .topic-node[data-category="Energy & Environment"] { border-color: var(--cat-energy); }
        .topic-node[data-category="Labour & Employment"] { border-color: var(--cat-labour); }
        .topic-node[data-category="Healthcare"] { border-color: var(--cat-health); }
        .topic-node[data-category="Education"] { border-color: var(--cat-education); }
        .topic-node[data-category="Agriculture"] { border-color: var(--cat-agri); }
        .topic-node[data-category="Corporate & Securities"] { border-color: var(--cat-corporate); }
        .topic-node[data-category="Governance & Politics"] { border-color: var(--cat-governance); }
        
        /* ========================================
           CARD VIEW (Mobile-friendly)
           ======================================== */
        .card-view {
            display: none;
        }
        
        .card-view.active {
            display: block;
        }
        
        .category-section {
            margin-bottom: 2rem;
        }
        
        .category-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border-color);
        }
        
        .category-icon {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-sm);
            font-size: 1rem;
        }
        
        .category-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .category-count {
            margin-left: auto;
            padding: 0.25rem 0.5rem;
            background: var(--bg-secondary);
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        
        .topics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 0.75rem;
        }
        
        .topic-card {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.875rem 1rem;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .topic-card:hover {
            border-color: var(--accent-primary);
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }
        
        .topic-card.highlighted {
            border-color: var(--accent-primary);
            background: var(--accent-glow);
        }
        
        .topic-name {
            font-weight: 500;
            color: var(--text-primary);
        }
        
        .topic-count {
            padding: 0.25rem 0.5rem;
            background: var(--bg-secondary);
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-weight: 600;
        }
        
        /* ========================================
           DETAIL PANEL
           ======================================== */
        .detail-panel {
            position: fixed;
            top: var(--header-height);
            right: -400px;
            width: 400px;
            max-width: 90vw;
            height: calc(100vh - var(--header-height));
            background: var(--bg-card);
            border-left: 1px solid var(--border-color);
            box-shadow: var(--shadow-lg);
            z-index: 50;
            transition: right 0.3s ease;
            overflow-y: auto;
        }
        
        .detail-panel.open {
            right: 0;
        }
        
        .detail-header {
            position: sticky;
            top: 0;
            background: var(--bg-card);
            padding: 1.25rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .detail-title {
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .detail-close {
            padding: 0.5rem;
            border: none;
            background: var(--bg-secondary);
            border-radius: var(--radius-sm);
            cursor: pointer;
            color: var(--text-muted);
            transition: all 0.2s;
        }
        
        .detail-close:hover {
            background: var(--accent-primary);
            color: white;
        }
        
        .detail-content {
            padding: 1.25rem;
        }
        
        .detail-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .stat-card {
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-primary);
        }
        
        .stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
        }
        
        .detail-section {
            margin-bottom: 1.5rem;
        }
        
        .detail-section-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-bottom: 0.75rem;
        }
        
        .related-topics {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .related-tag {
            padding: 0.375rem 0.75rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            font-size: 0.8125rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .related-tag:hover {
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }
        
        .article-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .article-item {
            padding: 0.75rem;
            background: var(--bg-secondary);
            border-radius: var(--radius-sm);
            border: 1px solid var(--border-color);
        }
        
        .article-item-title {
            font-weight: 500;
            color: var(--text-primary);
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }
        
        .article-item-title a {
            color: inherit;
            text-decoration: none;
        }
        
        .article-item-title a:hover {
            color: var(--accent-primary);
        }
        
        .article-item-meta {
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        
        .view-all-btn {
            display: block;
            width: 100%;
            padding: 0.75rem;
            margin-top: 1rem;
            background: var(--accent-primary);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            font-weight: 500;
            cursor: pointer;
            text-align: center;
            text-decoration: none;
            transition: background 0.2s;
        }
        
        .view-all-btn:hover {
            background: var(--accent-secondary);
        }
        
        /* ========================================
           OVERLAY
           ======================================== */
        .overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 40;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        
        .overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        
        /* ========================================
           LOADING STATE
           ======================================== */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 50vh;
            gap: 1rem;
        }
        
        .spinner {
            width: 48px;
            height: 48px;
            border: 4px solid var(--border-color);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* ========================================
           CATEGORY LEGEND
           ======================================== */
        .legend {
            position: fixed;
            bottom: 1.5rem;
            left: 1.5rem;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 1rem;
            box-shadow: var(--shadow-md);
            max-width: 300px;
            z-index: 30;
        }
        
        .legend-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-bottom: 0.75rem;
        }
        
        .legend-items {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.375rem;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        
        /* ========================================
           MOBILE RESPONSIVE
           ======================================== */
        @media (max-width: 768px) {
            .header {
                flex-wrap: wrap;
                height: auto;
                padding: 0.75rem 1rem;
                gap: 0.75rem;
            }
            
            .header-center {
                order: 3;
                width: 100%;
                max-width: none;
                margin: 0;
            }
            
            .search-shortcut {
                display: none;
            }
            
            .time-filter {
                display: none;
            }
            
            .legend {
                display: none;
            }
            
            .main {
                padding: 1rem;
            }
            
            .galaxy-view {
                display: none !important;
            }
            
            .card-view {
                display: block !important;
            }
            
            .view-toggle {
                display: none;
            }
            
            .detail-panel {
                width: 100%;
                max-width: 100%;
            }
        }
        
        /* ========================================
           KEYBOARD FOCUS
           ======================================== */
        .topic-node:focus,
        .topic-card:focus {
            outline: 2px solid var(--accent-primary);
            outline-offset: 2px;
        }
        
        /* ========================================
           ACCESSIBILITY
           ======================================== */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        /* Skip link */
        .skip-link {
            position: absolute;
            top: -100%;
            left: 0;
            background: var(--accent-primary);
            color: white;
            padding: 0.5rem 1rem;
            z-index: 1000;
            transition: top 0.3s;
        }
        
        .skip-link:focus {
            top: 0;
        }
    </style>
</head>
<body>
    <!-- Skip Link -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Screen Reader Announcements -->
    <div id="sr-announcer" class="sr-only" aria-live="polite" aria-atomic="true"></div>
    
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <a href="/" class="back-btn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
                Back
            </a>
            <span class="logo">ðŸ”­ Topic Explorer</span>
        </div>
        
        <div class="header-center">
            <div class="search-container">
                <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"/>
                    <path d="M21 21l-4.35-4.35"/>
                </svg>
                <input type="text" id="search-input" class="search-input" placeholder="Search topics..." aria-label="Search topics">
                <span class="search-shortcut">/</span>
            </div>
        </div>
        
        <div class="header-right">
            <div class="time-filter" role="radiogroup" aria-label="Time filter">
                <button class="time-btn active" data-time="all" role="radio" aria-checked="true">All</button>
                <button class="time-btn" data-time="24h" role="radio" aria-checked="false">24h</button>
                <button class="time-btn" data-time="3d" role="radio" aria-checked="false">3d</button>
                <button class="time-btn" data-time="7d" role="radio" aria-checked="false">7d</button>
            </div>
            
            <div class="view-toggle" role="radiogroup" aria-label="View mode">
                <button class="view-btn active" data-view="galaxy" role="radio" aria-checked="true" title="Galaxy view">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <circle cx="12" cy="12" r="8" stroke-dasharray="4 2"/>
                    </svg>
                </button>
                <button class="view-btn" data-view="cards" role="radio" aria-checked="false" title="Card view">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7"/>
                        <rect x="14" y="3" width="7" height="7"/>
                        <rect x="14" y="14" width="7" height="7"/>
                        <rect x="3" y="14" width="7" height="7"/>
                    </svg>
                </button>
            </div>
        </div>
    </header>
    
    <!-- Main Content -->
    <main id="main-content" class="main">
        <!-- Loading State -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Loading topics...</p>
        </div>
        
        <!-- Galaxy View -->
        <div id="galaxy-view" class="galaxy-view" aria-label="Topic galaxy visualization">
            <div class="galaxy-container" id="galaxy-container">
                <div class="galaxy-center">
                    <span>PolicyRadar<br>Topics</span>
                </div>
                <!-- Orbit rings will be added dynamically -->
                <!-- Topic nodes will be added dynamically -->
            </div>
        </div>
        
        <!-- Card View -->
        <div id="card-view" class="card-view" role="list" aria-label="Topics by category">
            <!-- Category sections will be added dynamically -->
        </div>
    </main>
    
    <!-- Detail Panel -->
    <div id="detail-panel" class="detail-panel" role="dialog" aria-labelledby="detail-title" aria-hidden="true">
        <div class="detail-header">
            <h2 id="detail-title" class="detail-title">Topic Name</h2>
            <button class="detail-close" aria-label="Close panel">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 6L6 18M6 6l12 12"/>
                </svg>
            </button>
        </div>
        <div class="detail-content">
            <div class="detail-stats">
                <div class="stat-card">
                    <div class="stat-value" id="stat-articles">0</div>
                    <div class="stat-label">Articles</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-sources">0</div>
                    <div class="stat-label">Sources</div>
                </div>
            </div>
            
            <div class="detail-section">
                <h3 class="detail-section-title">Related Topics</h3>
                <div id="related-topics" class="related-topics">
                    <!-- Related tags added dynamically -->
                </div>
            </div>
            
            <div class="detail-section">
                <h3 class="detail-section-title">Recent Articles</h3>
                <div id="article-list" class="article-list">
                    <!-- Articles added dynamically -->
                </div>
                <a href="#" id="view-all-link" class="view-all-btn">View all articles â†’</a>
            </div>
        </div>
    </div>
    
    <!-- Overlay -->
    <div id="overlay" class="overlay"></div>
    
    <!-- Category Legend -->
    <div class="legend" id="legend">
        <div class="legend-title">Categories</div>
        <div class="legend-items" id="legend-items">
            <!-- Legend items added dynamically -->
        </div>
    </div>
    
    <!-- Policy Keywords Module - Inline for reliability -->
    <script>
        // ========================================
        // INLINE POLICY KEYWORDS EXTRACTION
        // ========================================
        const PolicyKeywords = (function() {
            // Known policy phrases and acronyms
            const POLICY_TERMS = new Set([
                // Regulators
                'rbi', 'sebi', 'irdai', 'pfrda', 'trai', 'cci', 'nclt', 'ngt', 'fssai', 'npci',
                // Policies
                'gst', 'pli', 'dpdp', 'fdi', 'fpi', 'upi', 'cbdc', 'ondc', 'aadhaar',
                // Schemes
                'pmay', 'pmjdy', 'mgnrega', 'mudra', 'msme', 'sez', 'eou',
                // Sectors
                'fintech', 'edtech', 'agritech', 'healthtech', 'semiconductor',
                // Institutions
                'nabard', 'sidbi', 'exim', 'niti', 'isro', 'drdo',
                // Terms
                'budget', 'fiscal', 'monetary', 'inflation', 'gdp', 'taxation',
                'tariff', 'export', 'import', 'trade', 'investment', 'equity',
                'bond', 'treasury', 'forex', 'rupee', 'dollar',
                'renewable', 'solar', 'wind', 'ev', 'electric', 'carbon', 'emission',
                'telecom', 'spectrum', 'broadband', '5g', 'digital', 'cyber',
                'pharma', 'healthcare', 'hospital', 'insurance', 'ayushman',
                'railway', 'highway', 'airport', 'port', 'metro', 'infrastructure',
                'startup', 'unicorn', 'ipo', 'merger', 'acquisition',
                'labour', 'employment', 'wage', 'epfo', 'esic',
                'agriculture', 'farmer', 'crop', 'msp', 'procurement',
                'education', 'university', 'iit', 'nit', 'aiims',
                'defence', 'military', 'navy', 'airforce', 'army',
                'parliament', 'lok sabha', 'rajya sabha', 'bill', 'act', 'amendment',
                'supreme court', 'high court', 'tribunal', 'arbitration',
                'election', 'voting', 'constituency', 'bjp', 'congress', 'aap',
            ]);
            
            // Multi-word phrases to detect
            const PHRASES = [
                'digital india', 'make in india', 'startup india', 'skill india',
                'atmanirbhar bharat', 'swachh bharat', 'ayushman bharat',
                'pli scheme', 'production linked incentive', 'gst council',
                'rbi mpc', 'monetary policy', 'fiscal deficit', 'union budget',
                'income tax', 'direct tax', 'indirect tax', 'corporate tax',
                'foreign investment', 'trade policy', 'export promotion',
                'green energy', 'renewable energy', 'electric vehicle', 'ev policy',
                'data protection', 'privacy bill', 'it act', 'cyber security',
                'labour code', 'minimum wage', 'social security',
                'smart city', 'metro rail', 'bullet train', 'dedicated freight',
                'niti aayog', 'finance ministry', 'commerce ministry',
                'reserve bank', 'stock exchange', 'mutual fund', 'credit rating',
            ];
            
            // Stopwords to filter out
            const STOPWORDS = new Set([
                'the', 'and', 'for', 'that', 'this', 'with', 'from', 'have', 'has',
                'been', 'will', 'would', 'could', 'should', 'may', 'might', 'can',
                'are', 'was', 'were', 'being', 'had', 'did', 'does', 'done',
                'its', 'their', 'they', 'them', 'these', 'those', 'which', 'what',
                'who', 'whom', 'whose', 'where', 'when', 'why', 'how',
                'all', 'each', 'every', 'both', 'few', 'more', 'most', 'other',
                'some', 'such', 'than', 'too', 'very', 'just', 'also', 'now',
                'only', 'own', 'same', 'into', 'over', 'after', 'before', 'under',
                'again', 'further', 'then', 'once', 'here', 'there', 'any', 'about',
                'said', 'says', 'according', 'reported', 'announced', 'stated',
                'year', 'years', 'month', 'months', 'day', 'days', 'week', 'time',
                'first', 'second', 'third', 'last', 'next', 'new', 'old',
                'india', 'indian', 'country', 'government', 'govt', 'minister',
                'crore', 'lakh', 'rupees', 'percent', 'per', 'cent',
                'company', 'companies', 'firm', 'firms', 'group', 'sector',
                'market', 'markets', 'growth', 'report', 'news', 'update',
                'amid', 'across', 'among', 'along', 'around', 'during', 'through',
                'set', 'case', 'cases', 'high', 'low', 'rise', 'fall', 'top',
                'january', 'february', 'march', 'april', 'june', 'july',
                'august', 'september', 'october', 'november', 'december',
                'monday', 'tuesday', 'wednesday', 'thursday', 'friday',
                'people', 'person', 'public', 'private', 'national', 'international',
                'global', 'world', 'state', 'states', 'central', 'local',
                'total', 'average', 'expected', 'likely', 'major', 'key',
                // Generic words that appeared in screenshots
                'trump', 'modi', 'china', 'grok', 'court', 'police', 'centre',
            ]);

            // Category mapping
            const CATEGORIES = {
                'rbi': 'Finance & Banking', 'sebi': 'Finance & Banking', 'npci': 'Finance & Banking',
                'nabard': 'Finance & Banking', 'sidbi': 'Finance & Banking', 'bank': 'Finance & Banking',
                'fintech': 'Finance & Banking', 'upi': 'Finance & Banking', 'cbdc': 'Finance & Banking',
                'ipo': 'Finance & Banking', 'equity': 'Finance & Banking', 'bond': 'Finance & Banking',
                
                'gst': 'Taxation', 'taxation': 'Taxation', 'income tax': 'Taxation', 'tax': 'Taxation',
                'fiscal': 'Taxation', 'budget': 'Taxation', 'tariff': 'Taxation',
                
                'trade': 'Trade & Commerce', 'export': 'Trade & Commerce', 'import': 'Trade & Commerce',
                'sez': 'Trade & Commerce', 'eou': 'Trade & Commerce', 'fta': 'Trade & Commerce',
                
                'digital': 'Digital & Technology', 'trai': 'Digital & Technology', 'telecom': 'Digital & Technology',
                'spectrum': 'Digital & Technology', '5g': 'Digital & Technology', 'cyber': 'Digital & Technology',
                'dpdp': 'Digital & Technology', 'semiconductor': 'Digital & Technology', 'it': 'Digital & Technology',
                
                'infrastructure': 'Infrastructure', 'railway': 'Infrastructure', 'highway': 'Infrastructure',
                'airport': 'Infrastructure', 'port': 'Infrastructure', 'metro': 'Infrastructure',
                'nhai': 'Infrastructure', 'smart city': 'Infrastructure',
                
                'renewable': 'Energy & Environment', 'solar': 'Energy & Environment', 'wind': 'Energy & Environment',
                'ev': 'Energy & Environment', 'carbon': 'Energy & Environment', 'ngt': 'Energy & Environment',
                'green': 'Energy & Environment', 'emission': 'Energy & Environment',
                
                'labour': 'Labour & Employment', 'employment': 'Labour & Employment', 'wage': 'Labour & Employment',
                'epfo': 'Labour & Employment', 'esic': 'Labour & Employment',
                
                'pharma': 'Healthcare', 'healthcare': 'Healthcare', 'hospital': 'Healthcare',
                'irdai': 'Healthcare', 'ayushman': 'Healthcare', 'fssai': 'Healthcare',
                
                'education': 'Education', 'university': 'Education', 'iit': 'Education',
                'nit': 'Education', 'aiims': 'Education', 'nep': 'Education',
                
                'agriculture': 'Agriculture', 'farmer': 'Agriculture', 'crop': 'Agriculture',
                'msp': 'Agriculture', 'nabard': 'Agriculture',
                
                'merger': 'Corporate & Securities', 'acquisition': 'Corporate & Securities',
                'cci': 'Corporate & Securities', 'nclt': 'Corporate & Securities',
                'ibbi': 'Corporate & Securities', 'startup': 'Corporate & Securities',
                
                'parliament': 'Governance & Politics', 'election': 'Governance & Politics',
                'bjp': 'Governance & Politics', 'congress': 'Governance & Politics',
                'bill': 'Governance & Politics', 'act': 'Governance & Politics',
            };

            function extractKeywords(text, options = {}) {
                const { maxKeywords = 15 } = options;
                if (!text) return [];
                
                const results = new Map();
                const lowerText = text.toLowerCase();
                
                // Step 1: Find multi-word phrases first
                PHRASES.forEach(phrase => {
                    const regex = new RegExp(phrase.replace(/\s+/g, '\\s+'), 'gi');
                    const matches = lowerText.match(regex);
                    if (matches) {
                        const key = phrase.toLowerCase();
                        if (!results.has(key)) {
                            results.set(key, {
                                keyword: phrase.split(' ').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' '),
                                count: matches.length,
                                category: CATEGORIES[key] || CATEGORIES[phrase.split(' ')[0]] || 'General',
                            });
                        }
                    }
                });
                
                // Step 2: Extract single words
                const words = lowerText
                    .replace(/[^\w\s]/g, ' ')
                    .split(/\s+/)
                    .filter(w => w.length >= 2 && !STOPWORDS.has(w) && !/^\d+$/.test(w));
                
                const wordCounts = {};
                words.forEach(w => {
                    wordCounts[w] = (wordCounts[w] || 0) + 1;
                });
                
                // Prioritize known policy terms
                Object.entries(wordCounts).forEach(([word, count]) => {
                    // Skip if part of already-found phrase
                    const isPartOfPhrase = Array.from(results.values()).some(
                        r => r.keyword.toLowerCase().includes(word)
                    );
                    if (isPartOfPhrase) return;
                    
                    // Only include known terms or high-frequency words
                    if (POLICY_TERMS.has(word) || (count >= 2 && word.length >= 3)) {
                        const key = word;
                        if (!results.has(key) && !STOPWORDS.has(word)) {
                            // Check if it's a meaningful term
                            const isPolicyTerm = POLICY_TERMS.has(word);
                            if (isPolicyTerm || count >= 3) {
                                results.set(key, {
                                    keyword: word.toUpperCase().length <= 5 && /^[A-Z]+$/i.test(word) ? 
                                        word.toUpperCase() : 
                                        word.charAt(0).toUpperCase() + word.slice(1),
                                    count: count,
                                    category: CATEGORIES[word] || 'General',
                                });
                            }
                        }
                    }
                });
                
                return Array.from(results.values())
                    .sort((a, b) => b.count - a.count)
                    .slice(0, maxKeywords);
            }
            
            return { extractKeywords };
        })();
    </script>
    
    <script>
        // ========================================
        // STATE
        // ========================================
        const state = {
            topics: [],
            articles: [],
            currentView: 'galaxy',
            selectedTopic: null,
            searchQuery: '',
            timeFilter: 'all',
        };
        
        const CATEGORY_CONFIG = {
            'Finance & Banking': { icon: 'ðŸ¦', color: '#2563eb' },
            'Taxation': { icon: 'ðŸ’°', color: '#7c3aed' },
            'Trade & Commerce': { icon: 'ðŸš¢', color: '#059669' },
            'Digital & Technology': { icon: 'ðŸ’»', color: '#0891b2' },
            'Infrastructure': { icon: 'ðŸ—ï¸', color: '#d97706' },
            'Energy & Environment': { icon: 'âš¡', color: '#16a34a' },
            'Labour & Employment': { icon: 'ðŸ‘·', color: '#dc2626' },
            'Healthcare': { icon: 'ðŸ¥', color: '#db2777' },
            'Education': { icon: 'ðŸŽ“', color: '#4f46e5' },
            'Agriculture': { icon: 'ðŸŒ¾', color: '#65a30d' },
            'Corporate & Securities': { icon: 'ðŸ“ˆ', color: '#0284c7' },
            'Governance & Politics': { icon: 'ðŸ›ï¸', color: '#7c2d12' },
            'General': { icon: 'ðŸ“‹', color: '#6b7280' },
        };
        
        // ========================================
        // INITIALIZATION
        // ========================================
        document.addEventListener('DOMContentLoaded', async () => {
            setupEventListeners();
            await loadData();
        });
        
        async function loadData() {
            try {
                const response = await fetch('/data/public_data.json');
                if (!response.ok) throw new Error('Failed to load data');
                
                const data = await response.json();
                state.articles = data.articles || [];
                
                // Extract and categorize topics
                state.topics = extractTopics(state.articles);
                
                // Hide loading, show content
                document.getElementById('loading').style.display = 'none';
                
                // Activate appropriate view FIRST so container is visible
                const initialView = window.innerWidth <= 768 ? 'cards' : 'galaxy';
                setView(initialView);
                
                // THEN render the views (so getBoundingClientRect works correctly)
                renderGalaxyView();
                renderCardView();
                renderLegend();
                
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('loading').innerHTML = `
                    <p style="color: var(--text-muted);">Failed to load topics. Please refresh.</p>
                `;
            }
        }
        
        function extractTopics(articles) {
            const topicMap = new Map();
            
            articles.forEach(article => {
                // Get keywords from title and summary
                const text = `${article.title || ''} ${article.summary || ''}`;
                
                // Use PolicyKeywords module if available
                let keywords = [];
                if (typeof PolicyKeywords !== 'undefined') {
                    keywords = PolicyKeywords.extractKeywords(text, {
                        maxKeywords: 10,
                        includeCategories: true,
                    });
                } else {
                    // Fallback: simple extraction
                    keywords = text.toLowerCase()
                        .split(/\s+/)
                        .filter(w => w.length > 4)
                        .slice(0, 5)
                        .map(w => ({ keyword: w, category: 'General' }));
                }
                
                keywords.forEach(kw => {
                    const key = kw.keyword.toLowerCase();
                    if (!topicMap.has(key)) {
                        topicMap.set(key, {
                            name: kw.keyword,
                            category: kw.category || 'General',
                            count: 0,
                            articles: [],
                            sources: new Set(),
                        });
                    }
                    
                    const topic = topicMap.get(key);
                    topic.count++;
                    topic.articles.push(article);
                    if (article.source_name) {
                        topic.sources.add(article.source_name);
                    }
                });
            });
            
            // Convert to array and sort by count
            return Array.from(topicMap.values())
                .sort((a, b) => b.count - a.count)
                .slice(0, 100); // Top 100 topics
        }
        
        // ========================================
        // GALAXY VIEW RENDERING
        // ========================================
        function renderGalaxyView() {
            const container = document.getElementById('galaxy-container');
            
            // Clear existing nodes (keep center)
            container.querySelectorAll('.orbit, .topic-node').forEach(el => el.remove());
            
            // Get container dimensions
            const rect = container.getBoundingClientRect();
            const containerWidth = rect.width || window.innerWidth;
            const containerHeight = rect.height || (window.innerHeight - 80);
            const centerX = containerWidth / 2;
            const centerY = containerHeight / 2;
            
            // Calculate orbit sizes based on available space (fit in viewport)
            const maxRadius = Math.min(containerWidth, containerHeight) * 0.42;
            const orbits = [
                maxRadius * 0.4,  // Inner orbit ~40% of max
                maxRadius * 0.7,  // Middle orbit ~70% of max  
                maxRadius * 1.0   // Outer orbit 100% of max
            ];
            
            // Create visible orbit rings
            orbits.forEach((radius, idx) => {
                const orbit = document.createElement('div');
                orbit.className = `orbit orbit-${idx + 1}`;
                orbit.style.width = `${radius * 2}px`;
                orbit.style.height = `${radius * 2}px`;
                container.appendChild(orbit);
            });
            
            // Filter topics
            let filteredTopics = filterTopicsByTime(state.topics);
            if (state.searchQuery) {
                filteredTopics = filteredTopics.filter(t => 
                    t.name.toLowerCase().includes(state.searchQuery.toLowerCase())
                );
            }
            
            // Place topics in orbits (8 inner, 10 middle, 12 outer = 30 total)
            const topTopics = filteredTopics.slice(0, 30);
            
            topTopics.forEach((topic, idx) => {
                let orbitIndex, radius, countInOrbit, indexInOrbit;
                
                if (idx < 8) {
                    orbitIndex = 0;
                    countInOrbit = 8;
                    indexInOrbit = idx;
                } else if (idx < 18) {
                    orbitIndex = 1;
                    countInOrbit = 10;
                    indexInOrbit = idx - 8;
                } else {
                    orbitIndex = 2;
                    countInOrbit = 12;
                    indexInOrbit = idx - 18;
                }
                
                radius = orbits[orbitIndex];
                const angle = (indexInOrbit / countInOrbit) * 2 * Math.PI - Math.PI / 2;
                
                const x = centerX + radius * Math.cos(angle);
                const y = centerY + radius * Math.sin(angle);
                
                const node = document.createElement('div');
                node.className = 'topic-node';
                node.setAttribute('data-category', topic.category);
                node.setAttribute('data-topic', topic.name);
                node.setAttribute('tabindex', '0');
                node.setAttribute('role', 'button');
                node.style.left = `${x}px`;
                node.style.top = `${y}px`;
                node.innerHTML = `
                    ${topic.name}
                    <span class="count">${topic.count}</span>
                `;
                
                node.addEventListener('click', () => showTopicDetail(topic));
                node.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        showTopicDetail(topic);
                    }
                });
                
                container.appendChild(node);
            });
        }
        
        // ========================================
        // CARD VIEW RENDERING
        // ========================================
        function renderCardView() {
            const container = document.getElementById('card-view');
            container.innerHTML = '';
            
            // Filter topics
            let filteredTopics = filterTopicsByTime(state.topics);
            if (state.searchQuery) {
                filteredTopics = filteredTopics.filter(t => 
                    t.name.toLowerCase().includes(state.searchQuery.toLowerCase())
                );
            }
            
            // Group by category
            const byCategory = {};
            filteredTopics.forEach(topic => {
                const cat = topic.category || 'General';
                if (!byCategory[cat]) byCategory[cat] = [];
                byCategory[cat].push(topic);
            });
            
            // Sort categories by total count
            const sortedCategories = Object.entries(byCategory)
                .sort((a, b) => {
                    const countA = a[1].reduce((sum, t) => sum + t.count, 0);
                    const countB = b[1].reduce((sum, t) => sum + t.count, 0);
                    return countB - countA;
                });
            
            // Render each category
            sortedCategories.forEach(([category, topics]) => {
                const config = CATEGORY_CONFIG[category] || CATEGORY_CONFIG['General'];
                
                const section = document.createElement('div');
                section.className = 'category-section';
                section.innerHTML = `
                    <div class="category-header">
                        <div class="category-icon" style="background: ${config.color}20; color: ${config.color}">
                            ${config.icon}
                        </div>
                        <h2 class="category-title">${category}</h2>
                        <span class="category-count">${topics.length} topics</span>
                    </div>
                    <div class="topics-grid">
                        ${topics.slice(0, 12).map(topic => `
                            <div class="topic-card" data-topic="${topic.name}" tabindex="0" role="listitem">
                                <span class="topic-name">${topic.name}</span>
                                <span class="topic-count">${topic.count}</span>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                container.appendChild(section);
            });
            
            // Add click handlers
            container.querySelectorAll('.topic-card').forEach(card => {
                card.addEventListener('click', () => {
                    const topicName = card.dataset.topic;
                    const topic = state.topics.find(t => t.name === topicName);
                    if (topic) showTopicDetail(topic);
                });
                card.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        card.click();
                    }
                });
            });
        }
        
        // ========================================
        // LEGEND
        // ========================================
        function renderLegend() {
            const container = document.getElementById('legend-items');
            container.innerHTML = '';
            
            Object.entries(CATEGORY_CONFIG).forEach(([name, config]) => {
                if (name === 'General') return;
                
                const item = document.createElement('div');
                item.className = 'legend-item';
                item.innerHTML = `
                    <span class="legend-dot" style="background: ${config.color}"></span>
                    ${name.split(' ')[0]}
                `;
                container.appendChild(item);
            });
        }
        
        // ========================================
        // DETAIL PANEL
        // ========================================
        function showTopicDetail(topic) {
            state.selectedTopic = topic;
            
            // Update panel content
            document.getElementById('detail-title').textContent = topic.name;
            document.getElementById('stat-articles').textContent = topic.count;
            document.getElementById('stat-sources').textContent = topic.sources?.size || 0;
            
            // Related topics (same category)
            const relatedContainer = document.getElementById('related-topics');
            const related = state.topics
                .filter(t => t.category === topic.category && t.name !== topic.name)
                .slice(0, 8);
            
            relatedContainer.innerHTML = related.map(t => `
                <span class="related-tag" data-topic="${t.name}">${t.name}</span>
            `).join('');
            
            relatedContainer.querySelectorAll('.related-tag').forEach(tag => {
                tag.addEventListener('click', () => {
                    const t = state.topics.find(x => x.name === tag.dataset.topic);
                    if (t) showTopicDetail(t);
                });
            });
            
            // Recent articles
            const articleContainer = document.getElementById('article-list');
            const recentArticles = (topic.articles || [])
                .sort((a, b) => new Date(b.publication_date) - new Date(a.publication_date))
                .slice(0, 5);
            
            articleContainer.innerHTML = recentArticles.map(article => `
                <div class="article-item">
                    <div class="article-item-title">
                        <a href="${article.url}" target="_blank" rel="noopener">${article.title}</a>
                    </div>
                    <div class="article-item-meta">
                        ${article.source_name} Â· ${formatDate(article.publication_date)}
                    </div>
                </div>
            `).join('') || '<p style="color: var(--text-muted)">No articles found.</p>';
            
            // View all link
            document.getElementById('view-all-link').href = `/?q=${encodeURIComponent(topic.name)}`;
            
            // Highlight topic in view
            highlightTopic(topic.name);
            
            // Show panel
            document.getElementById('detail-panel').classList.add('open');
            document.getElementById('detail-panel').setAttribute('aria-hidden', 'false');
            document.getElementById('overlay').classList.add('visible');
            
            // Announce for screen readers
            announce(`Showing details for ${topic.name}: ${topic.count} articles from ${topic.sources?.size || 0} sources`);
        }
        
        function closeDetailPanel() {
            document.getElementById('detail-panel').classList.remove('open');
            document.getElementById('detail-panel').setAttribute('aria-hidden', 'true');
            document.getElementById('overlay').classList.remove('visible');
            
            // Remove highlight
            document.querySelectorAll('.topic-node.highlighted, .topic-card.highlighted').forEach(el => {
                el.classList.remove('highlighted');
            });
            
            state.selectedTopic = null;
        }
        
        function highlightTopic(name) {
            // Remove existing highlights
            document.querySelectorAll('.topic-node.highlighted, .topic-card.highlighted').forEach(el => {
                el.classList.remove('highlighted');
            });
            
            // Add highlight
            document.querySelectorAll(`[data-topic="${name}"]`).forEach(el => {
                el.classList.add('highlighted');
            });
        }
        
        // ========================================
        // VIEW SWITCHING
        // ========================================
        function setView(view) {
            state.currentView = view;
            
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.view === view);
                btn.setAttribute('aria-checked', btn.dataset.view === view);
            });
            
            document.getElementById('galaxy-view').classList.toggle('active', view === 'galaxy');
            document.getElementById('card-view').classList.toggle('active', view === 'cards');
            document.getElementById('legend').style.display = view === 'galaxy' ? 'block' : 'none';
        }
        
        // ========================================
        // TIME FILTERING
        // ========================================
        function filterTopicsByTime(topics) {
            if (state.timeFilter === 'all') return topics;
            
            const now = new Date();
            const cutoffs = {
                '24h': 1,
                '3d': 3,
                '7d': 7,
            };
            const days = cutoffs[state.timeFilter] || 7;
            const cutoff = new Date(now - days * 24 * 60 * 60 * 1000);
            
            // Filter articles in each topic
            return topics.map(topic => ({
                ...topic,
                articles: topic.articles.filter(a => {
                    const date = new Date(a.publication_date);
                    return date >= cutoff;
                }),
                count: topic.articles.filter(a => {
                    const date = new Date(a.publication_date);
                    return date >= cutoff;
                }).length
            })).filter(t => t.count > 0)
              .sort((a, b) => b.count - a.count);
        }
        
        function setTimeFilter(time) {
            state.timeFilter = time;
            
            document.querySelectorAll('.time-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.time === time);
                btn.setAttribute('aria-checked', btn.dataset.time === time);
            });
            
            renderGalaxyView();
            renderCardView();
        }
        
        // ========================================
        // SEARCH
        // ========================================
        function handleSearch(query) {
            state.searchQuery = query;
            renderGalaxyView();
            renderCardView();
        }
        
        // ========================================
        // EVENT LISTENERS
        // ========================================
        function setupEventListeners() {
            // Search
            const searchInput = document.getElementById('search-input');
            let searchTimeout;
            searchInput.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    handleSearch(e.target.value);
                }, 300);
            });
            
            // View toggle
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', () => setView(btn.dataset.view));
            });
            
            // Time filter
            document.querySelectorAll('.time-btn').forEach(btn => {
                btn.addEventListener('click', () => setTimeFilter(btn.dataset.time));
            });
            
            // Detail panel close
            document.querySelector('.detail-close').addEventListener('click', closeDetailPanel);
            document.getElementById('overlay').addEventListener('click', closeDetailPanel);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                // Focus search on /
                if (e.key === '/' && document.activeElement !== searchInput) {
                    e.preventDefault();
                    searchInput.focus();
                }
                
                // Close panel on Escape
                if (e.key === 'Escape') {
                    if (document.getElementById('detail-panel').classList.contains('open')) {
                        closeDetailPanel();
                    } else if (document.activeElement === searchInput) {
                        searchInput.blur();
                        searchInput.value = '';
                        handleSearch('');
                    }
                }
                
                // Toggle view with v
                if (e.key === 'v' && !['INPUT', 'TEXTAREA'].includes(document.activeElement.tagName)) {
                    setView(state.currentView === 'galaxy' ? 'cards' : 'galaxy');
                }
            });
            
            // Resize handler
            window.addEventListener('resize', () => {
                if (state.currentView === 'galaxy') {
                    renderGalaxyView();
                }
            });
        }
        
        // ========================================
        // UTILITIES
        // ========================================
        function formatDate(dateStr) {
            if (!dateStr) return '';
            try {
                const date = new Date(dateStr);
                return date.toLocaleDateString('en-IN', { 
                    month: 'short', 
                    day: 'numeric' 
                });
            } catch {
                return '';
            }
        }
        
        function announce(message) {
            const announcer = document.getElementById('sr-announcer');
            announcer.textContent = message;
        }
    </script>
</body>
</html>
